<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Message validation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="message-validation" class="article toc2 toc-left">
<div id="header">
<h1>Message validation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#xml-message-validation">XML message validation</a>
<ul class="sectlevel2">
<li><a href="#xml-payload-validation">XML payload validation</a></li>
<li><a href="#xml-header-validation">XML header validation</a></li>
</ul>
</li>
<li><a href="#xml-ignore">Ignore XML elements</a>
<ul class="sectlevel2">
<li><a href="#customize-xml-parser-and-serializer">Customize XML parser and serializer</a></li>
<li><a href="#groovy-xml-validation">Groovy XML validation</a></li>
</ul>
</li>
<li><a href="#xml-schema-validation">XML schema validation</a>
<ul class="sectlevel2">
<li><a href="#xsd-schema-repositories">XSD schema repositories</a></li>
<li><a href="#wsdl-schemas">WSDL schemas</a></li>
<li><a href="#schema-location-patterns">Schema location patterns</a></li>
<li><a href="#schema-collections">Schema collections</a></li>
<li><a href="#schema-mapping-strategy">Schema mapping strategy</a></li>
<li><a href="#target-namespace-mapping-strategy">Target Namespace Mapping Strategy</a></li>
<li><a href="#root-qname-mapping-strategy">Root QName Mapping Strategy</a></li>
<li><a href="#schema-mapping-strategy-chain">Schema mapping strategy chain</a></li>
<li><a href="#schema-definition-overruling">Schema definition overruling</a></li>
<li><a href="#dtd-validation">DTD validation</a></li>
</ul>
</li>
<li><a href="#json-message-validation">JSON message validation</a></li>
<li><a href="#xhtml-message-validation">XHTML message validation</a></li>
<li><a href="#plain-text-message-validation">Plain text message validation</a></li>
<li><a href="#binary-message-validation">Binary message validation</a></li>
<li><a href="#gzip-message-validation">Gzip message validation</a></li>
<li><a href="#java-dsl-validation-callbacks">Java DSL validation callbacks</a></li>
<li><a href="#customize-message-validators">Customize message validators</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When Citrus receives a message from external applications it is time to verify the message content. This message validation includes syntax rules as well as semantic values that need to be compared to an expected behavior. Citrus provides powerful message validation capabilities. Each incoming message is validated with syntax and semantics. The tester is able to define expected message headers and payloads. Citrus message validator implementations will compare the messages and report differences as test failure. With the upcoming sections we have a closer look at message validation of XML messages with XPath and XML schema validation and further message formats like JSON and plaintext.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xml-message-validation">XML message validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XML is a very common message format especially in the SOAP WebServices and JMS messaging world. Citrus provides XML message validator implementations that are able to compare XML message structures. The validator will notice differences in the XML message structure and supports XML namespaces, attributes and XML schema validation. The default XML message validator implementation is active by default and can be overwritten with a custom implementation using the bean id <strong>defaultXmlMessageValidator</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXmlMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.xml.DomXmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default XML message validator is very powerful when it comes to compare XML structures. The validator supports namespaces with different prefixes and attributes als well as namespace qualified attributes. See the following sections for a detailed description of all capabilities.</p>
</div>
<div class="sect2">
<h3 id="xml-payload-validation">XML payload validation</h3>
<div class="paragraph">
<p>Once Citrus has received a message the tester can validate the message contents in various ways. First of all the tester can compare the whole message payload to a predefined control message template.</p>
</div>
<div class="paragraph">
<p>The receiving action offers following elements for control message templates:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;payload&gt;</dt>
<dd>
<p>Defines the message payload as nested XML message template. The whole message payload is defined inside the test case.</p>
</dd>
<dt class="hdlist1">&lt;data&gt;</dt>
<dd>
<p>Defines an inline XML message template as nested CDATA. Slightly different to the payload variation as we define the whole message payload inside the test case as CDATA section.</p>
</dd>
<dt class="hdlist1">&lt;resource&gt;</dt>
<dd>
<p>Defines an expected XML message template via external file resources. This time the payload is loaded at runtime from the external file.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Both ways inline payload definition or external file resource give us a control message template that the test case expects to arrive. Citrus uses this control template for extended message comparison. All elements, namespaces, attributes and node values are validated in this comparison. When using XML message payloads Citrus will navigate through the whole XML structure validating each element and its content. Same with JSON payloads.</p>
</div>
<div class="paragraph">
<p>Only in case received message and control message are equal to each other as expected the message validation will pass. In case differences occur Citrus gives detailed error messages and the test case fails.</p>
</div>
<div class="paragraph">
<p>The control message template is not necessarily very static. Citrus supports various ways to add dynamic message content on the one side and on the other side Citrus can ignore some elements that are not part of message comparison (e.g. when generated content or timestamps are part of the message content). The tester can enrich the expected message template with test variables or ignore expressions so we get a more robust validation mechanism. We will talk about this in the next sections to come.</p>
</div>
<div class="paragraph">
<p>When using the Citrus Java DSL you will face a verbose message payload definition. This is because Java does not support multiline character sequence values as Strings. We have to use verbose String concatenation when constructing XML message payload contents for instance. In addition to that reserved characters like quotes must be escaped and line breaks must be explicitly added. All these impediments let me suggest to use external file resources in Java DSL when dealing with large complex message payload data. Here is an example:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/message/data/TestRequest.xml</span><span class="delimiter">&quot;</span></span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xml-header-validation">XML header validation</h3>
<div class="paragraph">
<p>Now that we have validated the message payload in various ways we are now interested in validating the message header. This is simple as you have to define the header name and the control value that you expect. Just add the following header validation to your receiving action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GetCustomer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestTag</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${requestTag}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Message headers are represented as name-value pairs. Each expected header element identified by its name has to be present in the received message. In addition to that the header value is compared to the given control value. If a header entry is not found by its name or the value does not fit accordingly Citrus will raise validation errors and the test case will fail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes message headers may not apply to the name-value pair pattern. For example SOAP headers can also contain XML fragments. Citrus supports these kind of headers too. Please see the SOAP chapter for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xml-ignore">Ignore XML elements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some elements in the message payload might not apply for validation at all. Just think of communication timestamps an dynamic values inside a message:</p>
</div>
<div class="paragraph">
<p>The timestamp value in our next example will dynamically change from test run to test run and is hardly predictable for the tester, so lets ignore it in validation.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;TestMessage&gt;</span>
            <span class="tag">&lt;MessageId&gt;</span>${messageId}<span class="tag">&lt;/MessageId&gt;</span>
            <span class="tag">&lt;Timestamp&gt;</span>2001-12-17T09:30:47.0Z<span class="tag">&lt;/Timestamp&gt;</span>
            <span class="tag">&lt;VersionId&gt;</span>@ignore@<span class="tag">&lt;/VersionId&gt;</span>
        <span class="tag">&lt;/TestMessage&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;ignore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/Timestamp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although we have given a static timestamp value in the payload data the element is ignored during validation as the ignore XPath expression matches the element. In addition to that we also ignored the version id element in this example. This time with an inline <strong>@ignore@</strong> expression. This is for those of you that do not like XPath. As a result the ignored message elements are automatically skipped when Citrus compares and validates message contents and do not break the test case.</p>
</div>
<div class="paragraph">
<p>When using the Java DSL the <strong>@ignore@</strong> placeholder as well as XPath expressions can be used seamlessly. Here is an example of that:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/message/data/TestRequest.xml</span><span class="delimiter">&quot;</span></span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>)
        .ignore(<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/Timestamp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can use the inline <strong>@ignore@</strong> placeholder in an external file resource, too.</p>
</div>
<div class="sect2">
<h3 id="customize-xml-parser-and-serializer">Customize XML parser and serializer</h3>
<div class="paragraph">
<p>When working with XML data format parsing and serializing is a common task. XML structures are parsed to a DOM (Document Object Model) representation in order
to process elements, attributes and text nodes. Also DOM node objects get serialized to a String message payload representation. The XML parser and serializer is customizable
to a certain level. By default Citrus uses the <a href="https://www.w3.org/TR/2004/REC-DOM-Level-3-LS-20040407/">DOM Level 3 Load and Save</a> implementation with following settings:</p>
</div>
<div class="hdlist">
<div class="title">Parser settings</div>
<table>
<tr>
<td class="hdlist1">
cdata-sections
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
split-cdata-sections
</td>
<td class="hdlist2">
<p><strong>false</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
validate-if-schema
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
element-content-whitespace
</td>
<td class="hdlist2">
<p><strong>false</strong></p>
</td>
</tr>
</table>
</div>
<div class="hdlist">
<div class="title">Serializer settings</div>
<table>
<tr>
<td class="hdlist1">
format-pretty-print
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
split-cdata-sections
</td>
<td class="hdlist2">
<p><strong>false</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
element-content-whitespace
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The parameters are also described in <a href="https://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMConfiguration">W3C DOM configuration</a> documentation. We can customize the default settings by adding
a <em>XmlConfigurer</em> Spring bean to the Citrus application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xmlConfigurer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.XmlConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parseSettings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validate-if-schema</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serializeSettings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">comments</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format-pretty-print</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This configuration is of global nature. All XML processing operations will be affected with this configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="groovy-xml-validation">Groovy XML validation</h3>
<div class="paragraph">
<p>With the Groovy XmlSlurper you can easily validate XML message payloads without having to deal directly with XML. People who do not want to deal with XPath may also like this validation alternative. The tester directly navigates through the message elements and uses simple code assertions in order to control the message content. Here is an example how to validate messages with Groovy script:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                assert root.children().size() == <span class="integer">4</span>
                assert root.MessageId.text() == <span class="string"><span class="delimiter">'</span><span class="content">${messageId}</span><span class="delimiter">'</span></span>
                assert root.CorrelationId.text() == <span class="string"><span class="delimiter">'</span><span class="content">${correlationId}</span><span class="delimiter">'</span></span>
                assert root.User.text() == <span class="string"><span class="delimiter">'</span><span class="content">HelloService</span><span class="delimiter">'</span></span>
                assert root.Text.text() == <span class="string"><span class="delimiter">'</span><span class="content">Hello </span><span class="delimiter">'</span></span> + context.getVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>)</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span>)
        .validateScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">assert root.MessageId.text() == '${messageId}';</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">assert root.CorrelationId.text() == '${correlationId}';</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation, </span><span class="delimiter">&quot;</span></span>sayHello<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .header(</span><span class="delimiter">&quot;</span></span>CorrelationId<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">$</span>{correlationId}<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .timeout(5000L);
}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy XmlSlurper validation script goes right into the message-tag instead of a XML control template or XPath validation. The Groovy script supports Java <strong><em>assert</em></strong> statements for message element validation. Citrus automatically injects the root element <strong><em>root</em></strong> to the validation script. This is the Groovy XmlSlurper object and the start of element navigation. Based on this root element you can access child elements and attributes with a dot notated syntax. Just use the element names separated by a simple dot. Very easy! If you need the list of child elements use the <strong><em>children()</em></strong> function on any element. With the <strong><em>text()</em></strong> function you get access to the element&#8217;s text-value. The <strong><em>size()</em></strong> is very useful for validating the number of child elements which completes the basic validation statements.</p>
</div>
<div class="paragraph">
<p>As you can see from the example, we may use test variables within the validation script, too. Citrus has also injected the actual test context to the validation script. The test context object holds all test variables. So you can also access variables with <strong><em>context.getVariable("user")</em></strong> for instance. On the test context you can also set new variable values with <strong><em>context.setVariable("user", "newUserName")</em></strong> .</p>
</div>
<div class="paragraph">
<p>There is even more object injection for the validation script. With the automatically added object <strong><em>receivedMessage</em></strong> You have access to the Citrus message object for this receive action. This enables you to do whatever you want with the message payload or header.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                assert receivedMessage.getPayload(String.<span class="reserved">class</span>).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>)
                assert receivedMessage.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">sayHello</span><span class="delimiter">'</span></span>

                context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">request_payload</span><span class="delimiter">&quot;</span></span>, receivedMessage.getPayload(String.<span class="reserved">class</span>))</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above shows some power of the validation script. We can access the message payload, we can access the message header. With test context access we can also save the whole message payload as a new test variable for later usage in the test.</p>
</div>
<div class="paragraph">
<p>In general Groovy code inside the XML test case definition or as part of the Java DSL code is not very comfortable to maintain. You do not have code syntax assist or code completion. This is why we can also use external file resources for the validation scripts. The syntax looks like follows:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:validationScript.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="inline">        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">validate&gt;
    &lt;</span><span class="delimiter">/</span><span class="modifier">m</span></span>essage&gt;
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">receive&gt;</span></span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span>)
        .validateScript(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">validationScript.groovy</span><span class="delimiter">&quot;</span></span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation, </span><span class="delimiter">&quot;</span></span>sayHello<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .header(</span><span class="delimiter">&quot;</span></span>CorrelationId<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">$</span>{correlationId}<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .timeout(5000L);
}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We referenced some external file resource <strong><em>validationScript.groovy</em></strong> . This file content is loaded at runtime and is used as script body. Now that we have a normal groovy file we can use the code completion and syntax highlighting of our favorite Groovy editor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the Groovy validation script in combination with other validation types like XML tree comparison and XPath validation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For further information on the Groovy XmlSlurper please see the official Groovy website and documentation
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xml-schema-validation">XML schema validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several possibilities to describe the structure of XML documents. The two most popular ways are DTD (Document type definition) and XSD (XML Schema definition). Once a XML document has decided to be classified using a schema definition the structure of the document has to fit the predefined rules inside the schema definition. XML document instances are valid only in case they meet all these structure rules defined in the schema definition. Currently Citrus can validate XML documents using the schema languages DTD and XSD.</p>
</div>
<div class="sect2">
<h3 id="xsd-schema-repositories">XSD schema repositories</h3>
<div class="paragraph">
<p>Citrus tries to validate all incoming XML messages against a schema definition in order to ensure that all rules are fulfilled. As a consequence the message receiving actions in Citrus do have to know the XML schema definition (*.xsd) file resources that belong to our project. Therefore Citrus introduces a central schema repository component which holds all available XML schema files for a project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:schemas&gt;</span>
        <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelAgencySchema</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/TravelAgencySchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalArilineSchema</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/RoyalAirlineSchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartArilineSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartArilineSchema</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/SmartAirlineSchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the schema repository is a simple XML component defined inside the Spring application context. The repository can hold nested schema definitions defined by some identifier and a file location for the xsd schema file. Schema definitions can also be referenced by its identifier for usage in several schema repository instances.</p>
</div>
<div class="paragraph">
<p>By convention the default schema repository component is defined in the Citrus Spring application context with the id <strong>schemaRepository</strong> . Spring application context is then able to inject the schema repository into all message receiving test actions at runtime. The receiving test action consolidates the repository for a matching schema definition file in order to validate the incoming XML document structure.</p>
</div>
<div class="paragraph">
<p>The connection between incoming XML messages and xsd schema files in the repository is done by a mapping strategy which we will discuss later in this chapter. By default Citrus picks the right schema based on the target namespace that is defined inside the schema definition. The target namespace of the schema definition has to match the namespace of the root element in the received XML message. With this mapping strategy you will not have to wire XML messages and schema files manually all is done automatically by the Citrus schema repository at runtime. All you need to do is to register all available schema definition files regardless of which target namespace or nature inside the Citrus schema repository.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
XMl schema validation is mandatory in Citrus. This means that Citrus always tries to find a matching schema definition inside the schema repository in order to perform syntax validation on incoming schema qualified XML messages. A classified XML message is defined by its namespace definitions. Consequently you will get validation errors in case no matching schema definition file is found inside the schema repository. So if you explicitly do not want to validate the XML schema for some reason you have to disable the validation explicitly in your test with <strong>schema-validation="false"</strong> .
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;validate&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ns1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mandatory schema validation might sound annoying to you but in our opinion it is very important to validate the structure of the received XML messages, so disabling the schema validation should not be the standard for all tests. Disabling automatic schema validation should only apply to very special situations. So please try to put all available schema definitions to the schema repository and you will be fine.</p>
</div>
</div>
<div class="sect2">
<h3 id="wsdl-schemas">WSDL schemas</h3>
<div class="paragraph">
<p>In SOAP WebServices world the WSDL (WebService Schema Definition Language) defines the structure an nature of the XML messages exchanged across the interface. Often the WSDL files do hold the XML schema definitions as nested elements. In Citrus you can directly set the WSDL file as location of a schema definition like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">arilineWsdl</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/AirlineSchema.wsdl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus is able to find the nested schema definitions inside the WSDL file in order to build a valid schema file for the schema repository. So incoming XML messages that refer to the WSDL file can be validated for syntax rules.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-location-patterns">Schema location patterns</h3>
<div class="paragraph">
<p>Setting all schemas one by one in a schema repository can be verbose and uncomfortable, especially when dealing with lots of xsd and wsdl files. The schema repository also supports location pattern expressions. See this example to see how it works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:locations&gt;</span>
    <span class="tag">&lt;citrus:location</span>
        <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/*.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:locations&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The schema repository searches for all files matching the resource path location pattern and adds them as schema instances to the repository. Of course this also works with WSDL files.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-collections">Schema collections</h3>
<div class="paragraph">
<p>Sometimes a schema definition is separated into multiple files. This is a problem for the Citrus schema repository as the schema mapping strategy then is not able to pick the right file for validation, in particular when working with target namespace values as key for the schema mapping strategy. As a solution for this problem you have to put all schemas with the same target namespace value into a schema collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-collection</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flightbookingSchemaCollection</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/BaseTypes.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/AirlineSchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-collection&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both schema definitions <strong>BaseTypes.xsd</strong> and <strong>AirlineSchema.xsd</strong> share the same target namespace and therefore need to be combined in schema collection component. The schema collection can be referenced in any schema repository as normal schema definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flightbookingSchemaCollection</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-mapping-strategy">Schema mapping strategy</h3>
<div class="paragraph">
<p>The schema repository in Citrus holds one to many schema definition files and dynamically picks up the right one according to the validated message payload. The repository needs to have some strategy for deciding which schema definition to choose. See the following schema mapping strategies and decide which of them is suitable for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="target-namespace-mapping-strategy">Target Namespace Mapping Strategy</h3>
<div class="paragraph">
<p>This is the default schema mapping strategy. Schema definitions usually define some target namespace which is valid for all elements and types inside the schema file. The target namespace is also used as root namespace in XML message payloads. According to this information Citrus can pick up the right schema definition file in the schema repository. You can set the schema mapping strategy as property in the configuration files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">schema-mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>sayHello.xsd</strong> schema file defines a target namespace (<a href="http://consol.de/schemas/sayHello.xsd)">http://consol.de/schemas/sayHello.xsd)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xs:schema</span> <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unqualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;/xs:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incoming request messages should also have the target namespace set in the root element and this is how Citrus matches the right schema file in the repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;HelloRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;MessageId&gt;</span>123456789<span class="tag">&lt;/MessageId&gt;</span>
   <span class="tag">&lt;CorrelationId&gt;</span>1000<span class="tag">&lt;/CorrelationId&gt;</span>
   <span class="tag">&lt;User&gt;</span>Christoph<span class="tag">&lt;/User&gt;</span>
   <span class="tag">&lt;Text&gt;</span>Hello Citrus<span class="tag">&lt;/Text&gt;</span>
<span class="tag">&lt;/HelloRequest&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="root-qname-mapping-strategy">Root QName Mapping Strategy</h3>
<div class="paragraph">
<p>The next possibility for mapping incoming request messages to a schema definition is via the XML root element QName. Each XML message payload starts with a root element that usually declares the type of a XML message. According to this root element you can set up mappings in the schema repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">schema-mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;map&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodbyeRequest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/map&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayGoodbye.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines two root qname mappings - one for <strong>HelloRequest</strong> and one for <strong>GoodbyeRequest</strong> message types. An incoming message of type &lt;HelloRequest&gt; is then mapped to the respective schema and so on. With this dedicated mappings you are able to control which schema is used on a XML request, regardless of target namespace definitions.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-mapping-strategy-chain">Schema mapping strategy chain</h3>
<div class="paragraph">
<p>Let&#8217;s discuss the possibility to combine several schema mapping strategies in a logical chain. You can define more than one mapping strategy that are evaluated in sequence. The first strategy to find a proper schema definition file in the repository wins.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">schema-mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.SchemaMappingStrategyChain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">strategies</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So the schema mapping chain uses both <strong>RootQNameSchemaMappingStrategy</strong> and <strong>TargetNamespaceSchemaMappingStrategy</strong> in combination. In case the first root qname strategy fails to find a proper mapping the next target namespace strategy comes in and tries to find a proper schema.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-definition-overruling">Schema definition overruling</h3>
<div class="paragraph">
<p>Now it is time to talk about schema definition settings on test action level. We have learned before that Citrus tries to automatically find a matching schema definition in some schema repository. There comes a time where you as a tester just have to pick the right schema definition by yourself. You can overrule all schema mapping strategies in Citrus by directly setting the desired schema in your receiving message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;validate&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ns1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the tester explicitly sets a schema definition in the receive action (schema="helloSchema"). The attribute value refers to named schema bean somewhere in the application context. This overrules all schema mapping strategies used in the central schema repository as the given schema is directly used for validation. This feature is helpful when dealing with different schema versions at the same time where the schema repository can not help you anymore.</p>
</div>
<div class="paragraph">
<p>Another possibility would be to set a custom schema repository at this point. This means you can have more than one schema repository in your Citrus project and you pick the right one by yourself in the receive action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialSchemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;validate&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ns1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>schema-repository</strong> attribute refers to a Citrus schema repository component which is defined somewhere in the Spring application context.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In case you have several schema repositories in your project do always define a default repository (name="schemaRepository"). This helps Citrus to always find at least one repository to interact with.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dtd-validation">DTD validation</h3>
<div class="paragraph">
<p>XML DTD (Document type definition) is another way to validate the structure of a XML document. Many people say that DTD is deprecated and XML schema is the much more efficient way to describe the rules of a XML structure. We do not disagree with that, but we also know that legacy systems might still use DTD. So in order to avoid validation errors we have to deal with DTD validation as well.</p>
</div>
<div class="paragraph">
<p>First thing you can do about DTD validation is to specify an inline DTD in your expected message template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;!DOCTYPE root [
                &lt;!ELEMENT root (message)&gt;
                &lt;!ELEMENT message (text)&gt;
                &lt;!ELEMENT text (#PCDATA)&gt;
                ]&gt;
            &lt;root&gt;
                &lt;message&gt;
                    &lt;text&gt;Hello TestFramework!&lt;/text&gt;
                &lt;/message&gt;
            &lt;/root&gt;
        <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;data</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The system under test may also send the message with a inline DTD definition. So validation will succeed.</p>
</div>
<div class="paragraph">
<p>In most cases the DTD is referenced as external .dtd file resource. You can do this in your expected message template as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;!DOCTYPE root SYSTEM
                         &quot;com/consol/citrus/validation/example.dtd&quot;&gt;
            &lt;root&gt;
                &lt;message&gt;
                    &lt;text&gt;Hello TestFramework!&lt;/text&gt;
                &lt;/message&gt;
            &lt;/root&gt;
        <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;data</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-message-validation">JSON message validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Message formats such as JSON have become very popular, in particular when speaking of RESTful WebServices and JavaScript using JSON as the message format to go for. Citrus is able to expect and validate JSON messages as we will see in the next sections.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default Citrus will use XML message formats when sending and receiving messages. This also reflects to the message validation logic Citrus uses for incoming messages. So by default Citrus will try to parse the incoming message as XML DOM element tree. In case we would like to enable JSON message validation we have to tell Citrus that we expect a JSON message right now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And this is quite easy. Citrus has a JSON message validator implementation active by default and immediately as we mark an incoming message as JSON data this message validator will jump in.</p>
</div>
<div class="paragraph">
<p>Citrus provides several default message validator implementations for JOSN message format:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">com.consol.citrus.validation.json.JsonTextMessageValidator</dt>
<dd>
<p>Basic JSON message validator implementation compares JSON objects (expected and received). The order of JSON entries can differ as specified in JSON protocol. Tester defines an expected control JSON object with test variables and ignored entries. JSONArray as well as nested JSONObjects are supported, too. The JSON validator offers two different modes to operate. By default <strong>strict</strong> mode is set and the validator will also check the exact amount of control object fields to match. No additional fields in received JSON data structure will be accepted. In <strong>soft</strong> mode validator allows additional fields in received JSON data structure so the control JSON object can be a partial subset in which case only the control fields are validated. Additional fields in the received JSON data structure are ignored then.</p>
</dd>
<dt class="hdlist1">com.consol.citrus.validation.script.GroovyJsonMessageValidator</dt>
<dd>
<p>Extended groovy message validator provides specific JSON slurper support. With JSON slurper the tester can validate the JSON message payload with closures for instance.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can overwrite this default message validators for JSON by placing a bean into the Spring Application context. The bean uses a default name as identifier. Then your custom bean will overwrite the default validator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.json.JsonTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.script.GroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how you can customize the message validators used for JSON message data.</p>
</div>
<div class="paragraph">
<p>We have mentioned before that Citrus is working with XML by default. This is why we have to tell Citrus that the message that we are receiving uses the JSON message format. We have to tell the test case receiving action that we expect a different format other than XML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          {
            &quot;type&quot; : &quot;read&quot;,
            &quot;mbean&quot; : &quot;java.lang:type=Memory&quot;,
            &quot;attribute&quot; : &quot;HeapMemoryUsage&quot;,
            &quot;path&quot; : &quot;@equalsIgnoreCase('USED')@&quot;,
            &quot;value&quot; : &quot;${heapUsage}&quot;,
            &quot;timestamp&quot; : &quot;@ignore@&quot;
          }
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message receiving action in our test case specifies a message format type <strong>type="json"</strong> . This tells Citrus to look for some message validator implementation capable of validating JSON messages. As we have added the proper message validator to the Spring application context Citrus will pick the right validator and JSON message validation is performed on this message. As you can see you we can use the usual test variables and the ignore element syntax here, too. Citrus is able to handle different JSON element orders when comparing received and expected JSON object. We can also use JSON arrays and nested objects. The default JSON message validator implementation in Citrus is very powerful in comparing JSON objects.</p>
</div>
<div class="paragraph">
<p>Instead of defining an expected message payload template we can also use Groovy validation scripts. Lets have a look at the Groovy JSON message validator example. As usual the default Groovy JSON message validator is active by default. But the special Groovy message validator implementation will only jump in when we used a validation script in our receive message definition. Let&#8217;s have an example for that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                &lt;![CDATA[
                  assert json.type == <span class="string"><span class="delimiter">'</span><span class="content">read</span><span class="delimiter">'</span></span>
                  assert json.mbean == <span class="string"><span class="delimiter">'</span><span class="content">java.lang:type=Memory</span><span class="delimiter">'</span></span>
                  assert json.attribute == <span class="string"><span class="delimiter">'</span><span class="content">HeapMemoryUsage</span><span class="delimiter">'</span></span>
                  assert json.value == <span class="string"><span class="delimiter">'</span><span class="content">${heapUsage}</span><span class="delimiter">'</span></span>
                ]]&gt;</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we tell Citrus that we expect a message of <strong>type="json"</strong> . Now we used a validation script that is written in Groovy. Citrus will automatically activate the special message validator that executes our Groovy script. The script validation is more powerful as we can use the full power of the Groovy language. The validation script automatically has access to the incoming JSON message object <strong>json</strong> . We can use the Groovy JSON dot notated syntax in order to navigate through the JSON structure. The Groovy JSON slurper object <strong>json</strong> is automatically passed to the validation script. This way you can access the JSON object elements in your code doing some assertions.</p>
</div>
<div class="paragraph">
<p>There is even more object injection for the validation script. With the automatically added object <strong><em>receivedMessage</em></strong> You have access to the Citrus message object for this receive action. This enables you to do whatever you want with the message payload or header.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                assert receivedMessage.getPayload(String.<span class="reserved">class</span>).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>)
                assert receivedMessage.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">sayHello</span><span class="delimiter">'</span></span>

                context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">request_payload</span><span class="delimiter">&quot;</span></span>, receivedMessage.getPayload(String.<span class="reserved">class</span>))</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above shows some power of the validation script. We can access the message payload, we can access the message header. With test context access we can also save the whole message payload as a new test variable for later usage in the test.</p>
</div>
<div class="paragraph">
<p>In general Groovy code inside the XML test case definition or as part of the Java DSL code is not very comfortable to maintain. You do not have code syntax assist or code completion. This is why we can also use external file resources for the validation scripts. The syntax looks like follows:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:validationScript.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="inline">        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">validate&gt;
    &lt;</span><span class="delimiter">/</span><span class="modifier">m</span></span>essage&gt;
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">receive&gt;</span></span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span>)
        .validateScript(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">validationScript.groovy</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We referenced some external file resource <strong><em>validationScript.groovy</em></strong> . This file content is loaded at runtime and is used as script body. Now that we have a normal groovy file we can use the code completion and syntax highlighting of our favorite Groovy editor.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using several message validator implementations at the same time in the Spring application context is also no problem. Citrus automatically searches for all available message validators applicable for the given message format and executes these validators in sequence. So several message validators can coexist in a Citrus project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we have multiple message validators that apply to the message format Citrus will execute all of them in sequence. In case you need to explicitly choose a message validator implementation you can do so in the receive action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                &lt;![CDATA[
                  assert json.type == <span class="string"><span class="delimiter">'</span><span class="content">read</span><span class="delimiter">'</span></span>
                  assert json.mbean == <span class="string"><span class="delimiter">'</span><span class="content">java.lang:type=Memory</span><span class="delimiter">'</span></span>
                  assert json.attribute == <span class="string"><span class="delimiter">'</span><span class="content">HeapMemoryUsage</span><span class="delimiter">'</span></span>
                  assert json.value == <span class="string"><span class="delimiter">'</span><span class="content">${heapUsage}</span><span class="delimiter">'</span></span>
                ]]&gt;</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we use the <strong>groovyJsonMessageValidator</strong> explicitly in the receive test action. The message validator implementation was added as Spring bean with id <strong>groovyJsonMessageValidator</strong> to the Spring application context before. Now Citrus will only execute the explicit message validator. Other implementations that might also apply are skipped.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default Citrus will consolidate all available message validators for a message format in sequence. You can explicitly pick a special message validator in the receive message action as shown in the example above. In this case all other validators will not take part in this special message validation. But be careful: When picking a message validator explicitly you are of course limited to this message validator capabilities. Validation features of other validators are not valid in this case (e.g. message header validation, XPath validation, etc.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So much for receiving JSON message data in Citrus. Of course sending JSON messages in Citrus is also very easy. Just use JSON message payloads in your sending message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          {
            &quot;type&quot; : &quot;read&quot;,
            &quot;mbean&quot; : &quot;java.lang:type=Memory&quot;,
            &quot;attribute&quot; : &quot;HeapMemoryUsage&quot;,
            &quot;path&quot; : &quot;used&quot;
          }
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xhtml-message-validation">XHTML message validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Citrus receives plain Html messages we likely want to use the powerful XML validation capabilities such as XML tree comparison or XPath support. Unfortunately Html messages do not follow the XML well formed rules very strictly. This implies that XML message validation will fail because of non well formed Html code.</p>
</div>
<div class="paragraph">
<p>XHTML closes this gap by automatically fixing the most common Html XML incompatible rule violations such as missing end tags (e.g. &lt;br&gt;).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try this with a simple example. Very first thing for us to do is to add a new library dependency to the project. Citrus is using the <strong>jtidy</strong> library in order to prepare the HTML and XHTML messages for validation. As this 3rd party dependency is optional in Citrus we have to add it now to our project dependency list. Just add the <strong>jtidy</strong> dependency to your Maven project POM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>net.sf.jtidy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jtidy<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>r938<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <strong>jtidy</strong> project documentation for the latest versions. Now everything is ready. As usual the Citrus message validator for XHTML is active in background by default. You can overwrite this default implementation by placing a Spring bean with id <strong>defaultXhtmlMessageValidator</strong> to the Citrus application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXhtmlMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.xhtml.XhtmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can tell the test case receiving action that we want to use the XHTML message validation in our test case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;org/w3c/xhtml/xhtml1-strict.dtd&quot;&gt;
            &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
            &lt;head&gt;
              &lt;title&gt;Citrus Hello World&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;h1&gt;Hello World!&lt;/h1&gt;
              &lt;br/&gt;
              &lt;p&gt;This is a test!&lt;/p&gt;
            &lt;/body&gt;
          <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message receiving action in our test case has to specify a message format type <strong>type="xhtml"</strong> . As you can see the Html message payload get XHTML specific DOCTYPE processing instruction. The <strong>xhtml1-strict.dtd</strong> is mandatory in the XHTML message validation. For better convenience all XHTML dtd files are packaged within Citrus so you can use this as a relative path.</p>
</div>
<div class="paragraph">
<p>The incoming Html message is automatically converted into proper XHTML code with well formed XML. So now the XHTML message validator can use the XML message validation mechanism of Citrus for comparing received and expected data. As usual you can use test variables, ignore element expressions and XPath expressions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plain-text-message-validation">Plain text message validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Plain text message validation is the easiest validation in Citrus that you can think of. This validation just performs an exact Java String match of received and expected message payloads.</p>
</div>
<div class="paragraph">
<p>As usual a default message validator for plaintext messages is active by default. Citrus will pick this message validator for all messages of <strong>type="plaintext"</strong> . The default message validator implementation can be overwritten by placing a Spring bean with id <strong>defaultPlaintextMessageValidator</strong> to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultPlaintextMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.PlainTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test case receiving action we tell Citrus to use plain text message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the message format type <strong>type="plaintext"</strong> set Citrus performs String equals on the message payloads (received and expected). Only exact match will pass the test.</p>
</div>
<div class="paragraph">
<p>By the way sending plain text messages in Citrus is also very easy. Just use the plain text message payload data in your sending message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course test variables are supported in the plain text payloads. The variables are replace by the referenced values before sending or receiving the message.</p>
</div>
<div class="paragraph">
<p>Plaintext message payloads may only differ in system-dependent line separator characters (<strong>CR</strong>, <em>LF</em>, <em>CRLF</em>). By default the plain text message validation fails because of that differences even if only whitespace
characters are different.</p>
</div>
<div class="paragraph">
<p>You can disable this default validation behavior and ignore new line types with following system property or environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>citrus.plaintext.validation.ignore.newline.type=true
CITRUS_PLAINTEXT_VALIDATION_IGNORE_NEWLINE_TYPE=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you need to ignore all whitespaces during plain text validation such as multiple new line characters or tabs you need to set this system property or environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>citrus.plaintext.validation.ignore.whitespace=true
CITRUS_PLAINTEXT_VALIDATION_IGNORE_WHITESPACE=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This property will not only ignore new line types but also normalize the whitespaces. As a result all empty lines, tabs and double whitespace characters are filtered before comparison.</p>
</div>
<div class="paragraph">
<p>Of course you can also set the properties directly on the plain text message validator bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultPlaintextMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.PlainTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ignoreNewLineType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ignoreWhitespace</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="binary-message-validation">Binary message validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Binary message validation is not very easy to do especially when it comes to compare data with a given control message. As a tester you want to validate the binary content. In Citrus the way to compare binary message content is to use base64 String encoding. The binary data is encoded as base64 character sequence and there fore is comparable with an expected content.</p>
</div>
<div class="paragraph">
<p>The received message content does not have to be base64 encoded. Citrus is doing this conversion automatically before validation takes place. The binary data can be anything e.g. images, pdf or gzip content.</p>
</div>
<div class="paragraph">
<p>The default message validator for binary messages is active by default. Citrus will pick this message validator for all messages of <strong>type="binary_base64"</strong> . The default message validator implementation can be overwritten by placing a Spring bean with id <strong>defaultBinaryBase64MessageValidator</strong> to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.BinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test case receiving action we tell Citrus to use binary base64 message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">binary_base64</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>citrus:encodeBase64('Hello World!')<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the message format type <strong>type="binary_base64"</strong> Citrus performs the base64 character sequence validation. Incoming message content is automatically encoded as base64 String and compared to the expected data. This way we can make sure that the binary content is as expected.</p>
</div>
<div class="paragraph">
<p>By the way sending binary messages in Citrus is also very easy. Just use the <strong>type="binary"</strong> message type in the send operation. Citrus now converts the message payload to a binary stream as payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">binary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Base64 encoding is also supported in outbound messages. Just use the <strong>encodeBase64</strong> function in Citrus. The result is a base64 encoded String as message payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>citrus:encodeBase64('Hello World!')<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gzip-message-validation">Gzip message validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gzip is a famous message compression library. When dealing with large message content the compression might be a good way to optimize the message transportation.
Citrus is able to handle gzipped message payloads on send and receive operations. When sending compressed data we just have to use the message type <strong>gzip</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just use the <strong>type="gzip"</strong> message type in the send operation. Citrus now converts the message payload to a gzip binary stream as payload.</p>
</div>
<div class="paragraph">
<p>When validating gzip binary message content the messages are compared with a given control message in binary base64 String representation. The gzip binary data is
automatically unzipped and encoded as base64 character sequence in order to compare with an expected content.</p>
</div>
<div class="paragraph">
<p>The received message content is using gzip format but the actual message content does not have to be base64 encoded. Citrus is doing this conversion automatically
before validation takes place. The binary data can be anything e.g. images, pdf or plaintext content.</p>
</div>
<div class="paragraph">
<p>The default message validator for gzip messages is active by default. Citrus will pick this message validator for all messages of <strong>type="gzip_base64"</strong> . The default message validator implementation
can be overwritten by placing a Spring bean with id <strong>defaultGzipBinaryBase64MessageValidator</strong> to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGzipBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.GzipBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test case receiving action we tell Citrus to use gzip message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip_base64</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>citrus:encodeBase64('Hello World!')<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the message format type <strong>type="gzip_base64"</strong> Citrus performs the gzip base64 character sequence validation. Incoming message content is automatically unzipped and encoded as base64 String and
compared to the expected data. This way we can make sure that the binary content is as expected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using http client and server components the gzip compression support is built in with the underlying Spring and http commons libraries. So in http communication
you just have to set the header <strong>Accept-Encoding=gzip</strong> or <strong>Content-Encoding=gzip</strong>. The message data is then automatically zipped/unzipped before Citrus gets the message data
for validation. Read more about this http specific gzip compression in <a href="#http-rest">chapter http</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-dsl-validation-callbacks">Java DSL validation callbacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java DSL offers some additional validation tricks and possibilities when dealing with messages that are sent and received over Citrus. One of them is the validation callback functionality. With this feature you can marshal/unmarshal message payloads and code validation steps on Java objects.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(bookResponseEndpoint)
        .validationCallback(<span class="keyword">new</span> MarshallingValidationCallback&lt;AddBookResponseMessage&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> validate(AddBookResponseMessage response, MessageHeaders headers) {
                Assert.isTrue(response.isSuccess());
            }
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the validation callback needs some XML unmarshaller implementation for transforming the XML payload to a Java object. Citrus will automatically search for the unmarshaller bean in your Spring application context if nothing specific is set. Of course you can also set the unmarshaller instance explicitly.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Unmarshaller unmarshaller;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(bookResponseEndpoint)
        .validationCallback(<span class="keyword">new</span> MarshallingValidationCallback&lt;AddBookResponseMessage&gt;(unmarshaller) {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> validate(AddBookResponseMessage response, MessageHeaders headers) {
                Assert.isTrue(response.isSuccess());
            }
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously working on Java objects is much more comfortable than using the XML String concatenation. This is why you can also use this feature when sending messages.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Marshaller marshaller;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
    send(bookRequestEndpoint)
        .payload(createAddBookRequestMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">978-citrus:randomNumber(10)</span><span class="delimiter">&quot;</span></span>), marshaller)
        .header(SoapMessageHeaders.SOAP_ACTION, <span class="string"><span class="delimiter">&quot;</span><span class="content">addBook</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">private</span> AddBookRequestMessage createAddBookRequestMessage(<span class="predefined-type">String</span> isbn) {
    AddBookRequestMessage requestMessage = <span class="keyword">new</span> AddBookRequestMessage();
    <span class="predefined-type">Book</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>();
    book.setAuthor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>);
    book.setTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">FooTitle</span><span class="delimiter">&quot;</span></span>);
    book.setIsbn(isbn);
    book.setYear(<span class="integer">2008</span>);
    book.setRegistrationDate(<span class="predefined-type">Calendar</span>.getInstance());
    requestMessage.setBook(book);
    <span class="keyword">return</span> requestMessage;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above creates a <strong>AddBookRequestMessage</strong> object and puts this as payload to a send action. In combination with a marshaller instance Citrus is able to create a proper XML message payload then.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customize-message-validators">Customize message validators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous sections we have already seen some examples on how to overwrite default message validator implementations in Citrus. By default all message validators can be overwritten by placing a Spring bean of the same id to the Spring application context. The default implementations of Citrus are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
defaultXmlMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.xml.DomXmlMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultXpathMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.xml.XpathMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultJsonMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.json.JsonTextMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultJsonPathMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.json.JsonPathMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultPlaintextMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.text.PlainTextMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultMessageHeaderValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.DefaultMessageHeaderValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultBinaryBase64MessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.text.BinaryBase64MessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGzipBinaryBase64MessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.text.GzipBinaryBase64MessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultXhtmlMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.xhtml.XhtmlMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGroovyXmlMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.script.GroovyXmlMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGroovyTextMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.script.GroovyScriptMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGroovyJsonMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.script.GroovyJsonMessageValidator</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Overwriting a single message validator with a custom implementation is then very easy. Just add your custom Spring bean to the application context using one of these default bean identifiers. In case you want to change the message validator gang by adding or removing a message validator implementation completely you can place a message validator component in the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:message-validators&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXpathMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyXmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultPlaintextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultMessageHeaderValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGzipBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.custom.CustomMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonPathMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXhtmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:message-validators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above adds a custom message validator implementation to the sequence of message validators in Citrus. We reference default message validators and add a implementation of type <strong>com.consol.citrus.validation.custom.CustomMessageValidator</strong> . The custom implementation class has to implement the basic interface <strong>com.consol.citrus.validation.MessageValidator</strong> . Now Citrus will try to match the custom implementation to incoming message types and occasionally execute the message validator logic. This is how you can add and change the basic message validator registry in Citrus. You can add custom implementations for new message formats very easy.</p>
</div>
<div class="paragraph">
<p>The same approach applies in case you want to remove a message validator implementation by banning it completely. Just delete the entry in the message validator registry component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:message-validators&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonPathMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultMessageHeaderValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:message-validators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus message validator component deleted all default implementations except of those dealing with JSON message format. Now Citrus is only able to validate JSON messages. Be careful as the complete Citrus project will be affected by this change.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-05 16:56:12 MESZ
</div>
</div>
</body>
</html>