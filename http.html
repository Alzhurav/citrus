<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>HTTP REST support</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="http-rest" class="article toc2 toc-left">
<div id="header">
<h1>HTTP REST support</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#http-rest-client">HTTP REST client</a></li>
<li><a href="#http-client-interceptors">HTTP client interceptors</a></li>
<li><a href="#http-rest-server">HTTP REST server</a></li>
<li><a href="#http-headers">HTTP headers</a></li>
<li><a href="#http-server-interceptors">HTTP server interceptors</a></li>
<li><a href="#http-form-urlencoded-data">HTTP form urlencoded data</a></li>
<li><a href="#http-error-handling">HTTP error handling</a></li>
<li><a href="#http-client-basic-authentication">HTTP client basic authentication</a></li>
<li><a href="#http-server-basic-authentication">HTTP server basic authentication</a></li>
<li><a href="#http-cookies">HTTP cookies</a></li>
<li><a href="#http-gzip-compression">HTTP Gzip compression</a></li>
<li><a href="#http-servlet-filters">HTTP servlet filters</a></li>
<li><a href="#http-servlet-context-customization">HTTP servlet context customization</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>REST APIs have gained more and more significance regarding client-server interfaces. The REST client is nothing but a HTTP client sending HTTP requests usually in JSON data format to a HTTP server. As HTTP is a synchronous protocol by nature the client receives the server response synchronously. Citrus is able to connect with HTTP services and test REST APIs on both client and server side with a powerful JSON message data support. In the next sections you will learn how to invoke HTTP services as a client and how to handle REST HTTP requests in a test case. We deal with setting up a HTTP server in order to accept client requests and provide proper HTTP responses with GET, PUT, DELETE or POST request method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The http components in Citrus are kept in a separate Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-http<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.2-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As Citrus provides a customized HTTP configuration schema for the Spring application context configuration files we have to add name to the top level <strong>beans</strong> element. Simply include the http-config namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:citrus-http</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/http/config</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
   <span class="content">http://www.springframework.org/schema/beans</span>
   <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
   <span class="content">http://www.citrusframework.org/schema/config</span>
   <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
   <span class="content">http://www.citrusframework.org/schema/http/config</span>
   <span class="content">http://www.citrusframework.org/schema/http/config/citrus-http-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to use the customized Citrus HTTP configuration elements with the citrus-http namespace prefix.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-rest-client">HTTP REST client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On the client side we have a simple HTTP message client component connecting to the server. The <strong>request-url</strong> attribute defines the HTTP server endpoint URL to connect to. As usual you can reference this client in your test case in order to send and receive messages. Citrus as client waits for the response message from server. After that the response message goes through the validation process as usual. Let us see how a Citrus HTTP client component looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>request-method</strong> defines the HTTP method to use. In addition to that we can specify the content-type of the request we are about to send. The charset is also added to the content-type header. In case you do not want to set the charset at all please specify an empty string as the default value is <em>UTF-8</em>.
The client builds the HTTP request and sends it to the HTTP server. While the client is waiting for the synchronous HTTP response to arrive we are able to poll several times for the response message in our test case. As usual aou can use the same client endpoint in your test case to send and receive messages synchronously. In case the reply message comes in too late according to the timeout settings a respective timeout error is raised.</p>
</div>
<div class="paragraph">
<p>Http defines several request methods that a client can use to access Http server resources. In the example client above we are using <strong>GET</strong> as default request method. Of course you can overwrite this setting in a test case action by setting the HTTP request method inside the sending test action. The Http client component can be used as normal endpoint in a sending test action. Use something like this in your test:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>Hello HttpServer<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Citrus uses the Spring REST template mechanism for sending out HTTP requests. This means you have great customizing opportunities with a special REST template configuration. You can think of basic HTTP authentication, read timeouts and special message factory implementations. Just use the custom REST template attribute in client configuration like this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">rest-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customizedRestTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- Customized rest template --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customizedRestTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.client.RestTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.converter.StringHttpMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supportedMediaTypes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">types</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>text/plain<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/util:list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/util:list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errorHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Custom error handler --&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">requestFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.client.HttpComponentsClientHttpRequestFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">readTimeout</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Up to now we have used a normal <strong>send</strong> test action to send Http requests as a client. This is completely valid strategy as the Citrus Http client is a normal endpoint. But we might want to set some more Http REST specific properties and settings. In order to simplify the Http usage in a test case we can use a special test action implementation. The Citrus Http specific actions are located in a separate XML namespace. So wen need to add this namespace to our test case XML first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:http</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/http/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/http/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/http/testcase/citrus-http-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

    <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test case is now ready to use the specific Http test actions by using the prefix <strong>http:</strong> .</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/customer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml, */*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;customer&gt;
            &lt;id&gt;citrus:randomNumber()&lt;/id&gt;
            &lt;name&gt;testuser&lt;/name&gt;
          &lt;/customer&gt;
        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The action above uses several Http specific settings such as the request method <strong>POST</strong> as well as the <strong>content-type</strong> and <strong>accept</strong> headers. As usual the send action needs a target Http client endpoint component. We can specify a request <strong>path</strong> attribute that added as relative path to the base uri used on the client.</p>
</div>
<div class="paragraph">
<p>When using a <strong>GET</strong> request we can specify some request uri parameters.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:GET</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/customer/${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:params</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml, */*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:params&gt;</span>
  <span class="tag">&lt;/http:GET&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The send action above uses a <strong>GET</strong> request on the endpoint uri <code><a href="http://localhost:8080/customer/1234?type=active" class="bare">http://localhost:8080/customer/1234?type=active</a></code>.</p>
</div>
<div class="paragraph">
<p>Of course when sending Http client requests we are also interested in receiving Http response messages. We want to validate the success response with Http status code.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-response</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:headers&gt;</span>
  <span class="tag">&lt;http:body&gt;</span>
    <span class="tag">&lt;http:data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;customerResponse&gt;
            &lt;success&gt;true&lt;/success&gt;
          &lt;/customerResponse&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/http:data&gt;</span>
  <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>receive-response</strong> test action also uses a client component. We can expect response status code information such as <strong>status</strong> and <strong>reason-phrase</strong> . Of course Citrus will raise a validation exception in case Http status codes mismatch.</p>
</div>
<div class="paragraph">
<p>Up to now we have used XML DSL test cases. The Java DSL in Citrus also works with specific Http test actions. See following example and find out how this works:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void httpActionTest() {
    http().client(&quot;httpClient&quot;)
          .send()
          .post(&quot;/customer&quot;)
          .payload(&quot;<span class="tag">&lt;customer&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;id&gt;</span>citrus:randomNumber()<span class="tag">&lt;/id&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;name&gt;</span>testuser<span class="tag">&lt;/name&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/customer&gt;</span>&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .contentType(&quot;text/xml&quot;)
          .accept(&quot;text/xml, */*&quot;);

    http().client(&quot;httpClient&quot;)
          .receive()
          .response(HttpStatus.OK)
          .payload(&quot;<span class="tag">&lt;customerResponse&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;success&gt;</span>true<span class="tag">&lt;/success&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/customerResponse&gt;</span>&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .version(&quot;HTTP/1.1&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is one more setting on the client to be aware of. By default the client component will add the <strong>Accept</strong> http header and set its value to a list of all supported encodings on the host operating system. As
this list can get very long you may want to not set this default accept header. The setting is done in the Spring RestTemplate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customizedRestTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.client.RestTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.converter.StringHttpMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writeAcceptCharset</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/util:list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You would have add this custom RestTemplate configuration and set it to the client component with <strong>rest-template</strong> property. But fortunately the Citrus client component provides a separate setting <strong>default-accept-header</strong> which
is a Boolean setting. By default it is set to <strong>true</strong> so the default accept header is automatically added to all requests. If you set this flag to <strong>false</strong> the header is not set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">default-accept-header</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can set the <strong>Accept</strong> header on each send operation in order to tell the server what kind of content types are supported in response messages.</p>
</div>
<div class="paragraph">
<p>Now we can send and receive messages as Http client with specific test actions. Now lets move on to the Http server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-client-interceptors">HTTP client interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client component is able to add custom interceptors that participate in the request/response processing. The interceptors need to implement the common interface <strong>org.springframework.http.client.ClientHttpRequestInterceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.interceptor.LoggingClientInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above adds the Citrus logging client interceptor that logs requests and responses exchanged with that client component. You can add custom interceptor implementations here in order
to participate in the request/response message processing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-rest-server">HTTP REST server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The HTTP client was quite easy and straight forward. Receiving HTTP messages is a little bit more complicated because Citrus has to provide server functionality listening on a local port for client connections. Therefore Citrus offers an embedded HTTP server which is capable of handling incoming HTTP requests. Once a client connection is accepted the HTTP server must also provide a proper HTTP response to the client. In the next few lines you will see how to simulate server side HTTP REST service with Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus uses an embedded Jetty server that will automatically start when the Spring application context is loaded (auto-start="true"). The basic connector is listening on port <strong>8080</strong> for requests. Test cases can interact with this server instance via message channels by default. The server provides an inbound channel that holds incoming request messages. The test case can receive those requests from the channel with a normal receive test action. In a second step the test case can provide a synchronous response message as reply which will be automatically sent back to the HTTP client as response.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_008.jpg" alt="figure_008.jpg"></span></p>
</div>
<div class="paragraph">
<p>The figure above shows the basic setup with inbound channel and reply channel. You as a tester should not worry about this to much. By default you as a tester just use the server as synchronous endpoint in your test case. This means that you simply receive a message from the server and send a response back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we reference the server id in both receive and send actions. The Citrus server instance will automatically send the response back to the calling HTTP client. In most cases this is exactly what we want to do - send back a response message that is specified inside the test. The HTTP server component by default uses a channel endpoint adapter in order to forward all incoming requests to an in memory message channel. This is done completely behind the scenes. The Http server component provides some more customization possibilities when it comes to endpoint adapter implementations. This topic is discussed in a separate section <a href="#endpoint-adapter">endpoint-adapter</a>. Up to now we keep it simple by synchronously receiving and sending messages in the test case.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The default channel endpoint adapter automatically creates an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message channel. The message channel follows a naming convention <strong>{serverName}.inbound</strong> where <strong>{serverName}</strong> is the Spring bean name of the Citrus server endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So lets get back to our mission of providing response messages as server to connected clients. As you might know Http REST works with some characteristic properties when it comes to send and receive messages. For instance a client can send different request methods GET, POST, PUT, DELETE, HEAD and so on. The Citrus server may verify this method when receiving client requests. Therefore we have introduced special Http test actions for server communication. Have a look at a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml, */*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
    <span class="tag">&lt;http:data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;testRequestMessage&gt;
          &lt;text&gt;Hello HttpServer&lt;/text&gt;
        &lt;/testRequestMessage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
  <span class="tag">&lt;http:extract&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:extract&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span>

<span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${message_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:headers&gt;</span>
  <span class="tag">&lt;http:body&gt;</span>
  <span class="tag">&lt;http:data&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>
      &lt;testResponseMessage&gt;
        &lt;text&gt;Hello Citrus&lt;/text&gt;
      &lt;/testResponseMessage&gt;
    <span class="inline-delimiter">]]&gt;</span>
  <span class="tag">&lt;/http:data&gt;</span>
  <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We receive a client request and validate that the request method is <strong>POST</strong> on request path <strong>/test</strong> . Now we can validate special message headers such as <strong>content-type</strong> . In addition to that we can check custom headers and basic authorization headers. As usual the optional message body is compared to an expected message template. The custom <strong>X-MessageId</strong> header is saved to a test variable <strong>message_id</strong> for later usage in the response.</p>
</div>
<div class="paragraph">
<p>The response message defines Http typical entities such as <strong>status</strong> and <strong>reason-phrase</strong> . Here the tester can simulate <strong>404 NOT_FOUND</strong> errors or similar other status codes that get send back to the client. In our example everything is <strong>OK</strong> and we send back a response body and some custom header entries.</p>
</div>
<div class="paragraph">
<p>That is basically how Citrus simulates Http server operations. We receive the client request and validate the request properties. Then we send back a response with a Http status code.</p>
</div>
<div class="paragraph">
<p>As usual all these Http specific actions are also available in Java DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void httpServerActionTest() {
    http().server(&quot;helloHttpServer&quot;)
          .receive()
          .post(&quot;/test&quot;)
          .payload(&quot;<span class="tag">&lt;testRequestMessage&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;text</span><span class="error">&lt;</span><span class="attribute-name">Hello</span> <span class="attribute-name">HttpServer</span><span class="error">&lt;</span><span class="error">/</span><span class="attribute-name">text</span><span class="tag">&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/testRequestMessage&gt;</span>&quot;)
          .contentType(&quot;application/xml&quot;)
          .accept(&quot;application/xml, */*&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .header(&quot;Authorization&quot;, &quot;Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==&quot;)
          .extractFromHeader(&quot;X-MessageId&quot;, &quot;message_id&quot;);

    http().server(&quot;helloHttpServer&quot;)
          .send()
          .response(HttpStatus.OK)
          .payload(&quot;<span class="tag">&lt;testResponseMessage&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;text</span><span class="error">&lt;</span><span class="attribute-name">Hello</span> <span class="attribute-name">Citrus</span><span class="error">&lt;</span><span class="error">/</span><span class="attribute-name">text</span><span class="tag">&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/testResponseMessage&gt;</span>&quot;)
          .version(&quot;HTTP/1.1&quot;)
          .contentType(&quot;application/xml&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .header(&quot;X-MessageId&quot;, &quot;${message_id}&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the exact same example in Java DSL. We select server actions first and receive client requests. Then we send back a response with a <strong>HttpStatus.OK</strong> status. This completes the server actions on Http message transport. Now we continue with some more Http specific settings and features.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-headers">HTTP headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When dealing with HTTP request/response communication we always deal with HTTP specific headers. The HTTP protocol defines a group of header attributes that both client and server need to be able to handle. You can set and validate these HTTP headers in Citrus quite easy. Let us have a look at a client operation in Citrus where some HTTP headers are explicitly set before the request is sent out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml,*/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testRequestMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testRequestMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are able to set custom headers (<strong>X-CustomHeaderId</strong>) that go directly into the HTTP header section of the request. In addition to that testers can explicitly set HTTP reserved headers such as <strong>Content-Type</strong> . Fortunately you do not have to set all headers on your own. Citrus will automatically set the required HTTP headers for the request. So we have the following HTTP request which is sent to the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
X-CustomHeaderId: 123456789
Accept-Charset: macroman
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8091
Content-Length: 175
<span class="tag">&lt;testRequestMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/testRequestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On server side testers are interested in validating the HTTP headers. Within Citrus receive action you simply define the expected header entries. The HTTP specific headers are automatically available for validation as you can see in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml,*/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testRequestMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testRequestMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test checks on custom headers and HTTP specific headers to meet the expected values.</p>
</div>
<div class="paragraph">
<p>Now that we have accepted the client request and validated the contents we are able to send back a proper HTTP response message. Same thing here with HTTP specific headers. The HTTP protocol defines several headers marking the success or failure of the server operation. In the test case you can set those headers for the response message with conventional Citrus header names. See the following example to find out how that works for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testResponseMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello Citrus Client<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testResponseMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once more we set the custom header entry (<strong>X-CustomHeaderId</strong>) and a HTTP reserved header (<strong>Content-Type</strong>) for the response message. On top of this we are able to set the response status for the HTTP response. We use the reserved header names <strong>status</strong> in order to mark the success of the server operation. With this mechanism we can easily simulate different server behaviour such as HTTP error response codes (e.g. 404 - Not found, 500 - Internal error). Let us have a closer look at the generated response message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HTTP/1.1 200 OK
Content-Type: text/xml;charset=UTF-8
Accept-Charset: macroman
Content-Length: 205
Server: Jetty(7.0.0.pre5)
<span class="tag">&lt;testResponseMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>Hello Citrus Client<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/testResponseMessage&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You do not have to set the reason phrase all the time. It is sufficient to only set the HTTP status code. Citrus will automatically add the proper reason phrase for well known HTTP status codes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The only thing that is missing right now is the validation of HTTP status codes when receiving the server response in a Citrus test case. It is very easy as you can use the Citrus reserved header names for validation, too.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-response</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testResponseMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello Test Framework<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testResponseMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Up to now we have used some of the basic Citrus reserved HTTP header names (status, version, reason-phrase). In HTTP RESTful services some other header names are essential for validation. These are request attributes like query parameters, context path and request URI. The Citrus server side REST message controller will automatically add all this information to the message header for you. So all you need to do is validate the header entries in your test.</p>
</div>
<div class="paragraph">
<p>The next example receives a HTTP GET method request on server side. Here the GET request does not have any message payload, so the validation just works on the information given in the message header. We assume the client to call <code><a href="http://localhost:8080/app/users?id=123456789" class="bare">http://localhost:8080/app/users?id=123456789</a></code>. As a tester we need to validate the request method, request URI, context path and the query parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:GET</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/app/users</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">context-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/app</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:params&gt;</span>
        <span class="tag">&lt;http:param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:params&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Host</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost:8080</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml,*/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:data&gt;</span><span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:GET&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Be aware of the slight differences in request URI and context path. The context path gives you the web application context path within the servlet container for your web application. The request URI always gives you the complete path that was called for this request.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see we are able to validate all parts of the initial request endpoint URI the client was calling. This completes the HTTP header processing within Citrus. On both client and server side Citrus is able to set and validate HTTP specific header entries which is essential for simulating HTTP communication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-server-interceptors">HTTP server interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The server component is able to add custom interceptors that participate in the request/response processing. The interceptors need to implement the common interface <strong>org.springframework.web.servlet.HandlerInterceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.interceptor.LoggingHandlerInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above adds the Citrus logging handler interceptor that logs requests and responses exchanged with that server component. You can add custom interceptor implementations here in order
to participate in the request/response message processing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-form-urlencoded-data">HTTP form urlencoded data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HTML form data can be sent to the server using different methods and content types. One of them is a POST method with <strong>x-www-form-urlencoded</strong> body content. The form data elements are sent to the server using key-value pairs POST data where the form control name is the key and the control data is the url encoded value.</p>
</div>
<div class="paragraph">
<p>Form urlencoded form data content could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">password=s%21cr%21t<span class="error">&amp;</span>username=foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>A you can see the form data is automatically encoded. In the example above we transmit two form controls <strong>password</strong> and <strong>username</strong> with respective values <strong>s$cr$t</strong> and <strong>foo</strong> . In case we would validate this form data in Citrus we are able to do this with plaintext message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        password=s%21cr%21t&amp;username=${username}
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_request_uri</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/form-test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously validating these key-value pair character sequences can be hard especially when having HTML forms with lots of form controls. This is why Citrus provides a special message validator for <strong>x-www-form-urlencoded</strong> contents. First of all we have to add <strong>citrus-http</strong> module as dependency to our project if not done so yet. After that we can add the validator implementation to the list of message validators used in Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:message-validators&gt;</span>
  <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.validation.FormUrlEncodedMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:message-validators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are able to receive the urlencoded form data message in a test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
      <span class="tag">&lt;form-data</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/http/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;content-type&gt;</span>application/x-www-form-urlencoded<span class="tag">&lt;/content-type&gt;</span>
        <span class="tag">&lt;action&gt;</span>/form-test<span class="tag">&lt;/action&gt;</span>
        <span class="tag">&lt;controls&gt;</span>
          <span class="tag">&lt;control</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>${password}<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/control&gt;</span>
          <span class="tag">&lt;control</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>${username}<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/control&gt;</span>
        <span class="tag">&lt;/controls&gt;</span>
      <span class="tag">&lt;/form-data&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_request_uri</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/form-test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use a special message type <strong>x-www-form-urlencoded</strong> so the new message validator will take action. The form url encoded message validator is able to handle a special XML representation of the form data. This enables the very powerful XML message validation capabilities of Citrus such as ignoring elements and usage of test variables inline.</p>
</div>
<div class="paragraph">
<p>Each form control is translated to a control element with respective name and value properties. The form data is validated in a more comfortable way as the plaintext message validator would be able to offer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-error-handling">HTTP error handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have received response messages with HTTP status code <strong>200 OK</strong> . How to deal with server errors like <strong>404 Not Found</strong> or <strong>500 Internal server error</strong> ? The default HTTP message client error strategy is to propagate server error response messages to the receive action for validation. We simply check on HTTP status code and status text for error validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testRequestMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testRequestMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span>

<span class="tag">&lt;http:receive-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:data&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span><span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">403</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FORBIDDEN</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/http:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message data can be empty depending on the server logic for these error situations. If we receive additional error information as message payload just add validation assertions as usual.</p>
</div>
<div class="paragraph">
<p>Instead of receiving such empty messages with checks on HTTP status header information we can change the error strategy in the message sender component in order to automatically raise exceptions on response messages other than <strong>200 OK</strong> . Therefore we go back to the HTTP message sender configuration for changing the error strategy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">error-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">throwsException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we expect an exception to be thrown because of the error response. Following from that we have to change our test case. Instead of receiving the error message with receive action we assert the client exception and check on the HTTP status code and status text.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assert</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.client.HttpClientErrorException</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">403 Forbidden</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;when&gt;</span>
        <span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;http:body&gt;</span>
                <span class="tag">&lt;http:payload&gt;</span>
                    <span class="tag">&lt;testRequestMessage&gt;</span>
                        <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
                    <span class="tag">&lt;/testRequestMessage&gt;</span>
                <span class="tag">&lt;/http:payload&gt;</span>
            <span class="tag">&lt;/http:body&gt;</span>
        <span class="tag">&lt;/http:send-request&gt;</span>
    <span class="tag">&lt;/when&gt;</span>
<span class="tag">&lt;/assert&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both ways of handling HTTP error messages on client side are valid for expecting the server to raise HTTP error codes. Choose the preferred way according to your test project requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-client-basic-authentication">HTTP client basic authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As client you may have to use basic authentication in order to access a resource on the server. In most cases this will be username/password authentication where the credentials are transmitted in the request header section as base64 encoding.</p>
</div>
<div class="paragraph">
<p>The easiest approach to set the <strong>Authorization</strong> header for a basic authentication HTTP request would be to set it on your own in the send action definition. Of course you have to use the correct basic authentication header syntax with base64 encoding for the username:password phrase. See this simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:headers&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/http:headers&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus will add this header to the HTTP requests and the server will read the <strong>Authorization</strong> username and password. For more convenient base64 encoding you can also use a Citrus function, see <a href="#functions-encode-base64">functions-encode-base64</a></p>
</div>
<div class="paragraph">
<p>Now there is a more comfortable way to set the basic authentication header in all the Citrus requests. As Citrus uses Spring&#8217;s REST support with the RestTemplate and ClientHttpRequestFactory the basic authentication is already covered there in a more generic way. You simply have to configure the basic authentication credentials on the RestTemplate&#8217;s ClientHttpRequestFactory. Just see the following example and learn how to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">request-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthFactory</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.client.BasicAuthClientHttpRequestFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.AuthScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8072</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basic</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.UsernamePasswordCredentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someUsername</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somePassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantages of this method is obvious. Now all sending test actions that reference the client component will automatically add the basic authentication header.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Since Citrus has upgraded to Spring 3.1.x the Jakarta commons HTTP client is deprecated with Citrus version 1.2. The formerly used UserCredentialsClientHttpRequestFactory is therefore also deprecated and will not continue with next versions. Please update your configuration if you are coming from Citrus 1.1 or earlier versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above configuration results in HTTP client requests with authentication headers properly set for basic authentication. The client request factory takes care on adding the proper basic authentication header to each request that is sent with this Citrus message sender. Citrus uses preemptive authentication. The message sender only sends a single request to the server with all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope in the client request factory so Citrus can setup an authentication cache within the HTTP context in order to have preemptive authentication.</p>
</div>
<div class="paragraph">
<p>As a result of the basic auth client request factory the following example request that is created by the Citrus HTTP client has the <strong>Authorization</strong> header set. This is done now automatically for all requests with this HTTP client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
Accept-Charset: iso-8859-1, us-ascii, utf-8
Authorization: Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8080
Content-Length: 175
<span class="tag">&lt;testRequestMessage&gt;</span>
  <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/testRequestMessage&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-server-basic-authentication">HTTP server basic authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus as a server can also set basic authentication so clients need to authenticate properly when accessing server resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthHttpServer</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8090</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">security-handler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicSecurityHandler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securityHandler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.security.SecurityHandlerFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.security.User</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">constraints</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/foo/*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.security.BasicAuthConstraint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/entry&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have set a security handler on the server web container with a constraint on all resources with <code>/foo/*</code>. Following from that the server requires basic authentication for these resources. The granted users and roles are specified within the security handler bean definition. Connecting clients have to set the basic auth HTTP header properly using the correct user and role for accessing the Citrus server now.</p>
</div>
<div class="paragraph">
<p>You can customize the security handler for your very specific needs (e.g. load users and roles with JDBC from a database). Just have a look at the code base and inspect the settings and properties offered by the security handler interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This mechanism is not restricted to basic authentication only. With other settings you can also set up digest or form-based authentication constraints very easy.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-cookies">HTTP cookies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cookies hold any kind of information and are saved as test information on the client side. Http servers are able to instruct the client (browser) to save a new cookie with name, value and some attributes. This is usually done with a
<em>"Set-Cookie"</em> message header set on the server response message. Citrus is able to add those cookie information in a server response.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="entity">&amp;lt;</span>http:receive-request server=&quot;echoHttpServer&quot;<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:POST<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:headers<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:header name=&quot;Operation&quot; value=&quot;getCookie&quot;/<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:headers<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:body<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:data<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>![CDATA[
 Some request data
 ]]<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:data<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:body<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:POST<span class="entity">&amp;gt;</span>
<span class="entity">&amp;lt;</span>/http:receive-request<span class="entity">&amp;gt;</span>

<span class="entity">&amp;lt;</span>http:send-response server=&quot;echoHttpServer&quot;<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:headers status=&quot;200&quot; reason-phrase=&quot;OK&quot; version=&quot;HTTP/1.1&quot;<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:header name=&quot;Operation&quot; value=&quot;getCookie&quot;/<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:cookie name=&quot;Token&quot;
 value=&quot;${messageId}&quot;
 secure=&quot;false&quot;
 domain=&quot;citrusframework.org&quot;
 path=&quot;/test/cookie.py&quot;
 max-age=&quot;86400&quot;/<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:headers<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:body<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>http:data<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>![CDATA[
 Some response body
 ]]<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:data<span class="entity">&amp;gt;</span>
 <span class="entity">&amp;lt;</span>/http:body<span class="entity">&amp;gt;</span>
<span class="entity">&amp;lt;</span>/http:send-response<span class="entity">&amp;gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
cookie.setPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test/cookie.py</span><span class="delimiter">&quot;</span></span>);
cookie.setSecure(<span class="predefined-constant">false</span>);
cookie.setDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusframework.org</span><span class="delimiter">&quot;</span></span>);
cookie.setMaxAge(<span class="integer">86400</span>);

http().server(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span>)
 .receive()
 .post()
 .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some request data</span><span class="delimiter">&quot;</span></span>)
 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);

http().server(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span>)
 .send()
 .response(HttpStatus.OK)
 .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some response body</span><span class="delimiter">&quot;</span></span>)
 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
 .cookie(cookie);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above receives a Http request with method POST and some request data. The server response is specified with <em>Http 200 OK</em> and some additional cookie information. The
cookie is part of the message header specification and gets a name and value as well as several other attributes. This response will result in a Http response with the <em>"Set-Cookie"</em> header set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Set-Cookie:Token=5877643571;Path=/test/cookie.py;Domain=citrusframework.org;Max-Age=86400</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see test variables are replaced before the cookie is added to the response. The client now is able to receive the cookie information for validation:</p>
</div>
<div class="paragraph">
<div class="title">XML DSL</div>
<p>`xml
&lt;http:receive-response server=&quot;echoHttpClient&quot;&gt;
  &lt;http:headers status=&quot;200&quot; reason-phrase=&quot;OK&quot; version=&quot;HTTP/1.1&quot;&gt;
  &lt;http:header name=&quot;Operation&quot; value=&quot;getCookie&quot;/&gt;
  &lt;http:cookie name=&quot;Token&quot;
               value=&quot;${messageId}&quot;
               secure=&quot;false&quot;
               domain=&quot;citrusframework.org&quot;
               path=&quot;/test/cookie.py&quot;
               max-age=&quot;86400&quot;/&gt;
  &lt;/http:headers&gt;
  &lt;http:body&gt;
    &lt;http:data&gt;
      &lt;![CDATA[
        Some response body
      ]]&gt;
    &lt;/http:data&gt;
  &lt;/http:body&gt;
&lt;/http:receive-response&gt;
`</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
cookie.setPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test/cookie.py</span><span class="delimiter">&quot;</span></span>);
cookie.setSecure(<span class="predefined-constant">false</span>);
cookie.setDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusframework.org</span><span class="delimiter">&quot;</span></span>);
cookie.setMaxAge(<span class="integer">86400</span>);

http().client(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpClient</span><span class="delimiter">&quot;</span></span>)
 .receive()
 .response(HttpStatus.OK)
 .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some response body</span><span class="delimiter">&quot;</span></span>)
 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
 .cookie(cookie);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again the cookie information is added to the header specification. The Citrus message validation will make sure that the cookie information is present with all
specified attributes.</p>
</div>
<div class="paragraph">
<p>In all further actions the client is able to continue to send the cookie information with name and value:</p>
</div>
<div class="paragraph">
<div class="title">XML DSL</div>
<p>`xml
&lt;http:send-request client=&quot;echoHttpClient&quot; fork=&quot;true&quot;&gt;
  &lt;http:POST&gt;
    &lt;http:headers&gt;
      &lt;http:header name=&quot;Operation&quot; value=&quot;sayHello&quot;/&gt;
      &lt;http:cookie name=&quot;Token&quot; value=&quot;${messageId}&quot;/&gt;
    &lt;/http:headers&gt;
    &lt;http:body&gt;
      &lt;http:data&gt;
        &lt;![CDATA[
          Some other request data
        ]]&gt;
      &lt;/http:data&gt;
    &lt;/http:body&gt;
  &lt;/http:POST&gt;
&lt;/http:send-request&gt;
`</p>
</div>
<div class="paragraph">
<div class="title">Java DSL</div>
<p>`java
http().client(&quot;echoHttpClient&quot;)
    .send()
    .post()
    .fork(true)
    .payload(&quot;Some other request data&quot;)
    .header(&quot;Operation&quot;, &quot;sayHello&quot;)
    .cookie(new Cookie(&quot;Token&quot;, &quot;${messageId}&quot;));
`</p>
</div>
<div class="paragraph">
<p>The cookie now is only specified with name and value as the cookie now goes to the <em>"Cookie"</em> request message header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Cookie:Token=5877643571</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course the Citrus Http server can now also validate the cookie information in a request validation:</p>
</div>
<div class="paragraph">
<div class="title">XML DSL</div>
<p>`xml
&lt;http:receive-request client=&quot;echoHttpServer&quot;&gt;
  &lt;http:POST&gt;
    &lt;http:headers&gt;
      &lt;http:header name=&quot;Operation&quot; value=&quot;sayHello&quot;/&gt;
      &lt;http:cookie name=&quot;Token&quot; value=&quot;${messageId}&quot;/&gt;
    &lt;/http:headers&gt;
    &lt;http:body&gt;
      &lt;http:data&gt;
        &lt;![CDATA[
          Some other request data
        ]]&gt;
      &lt;/http:data&gt;
    &lt;/http:body&gt;
  &lt;/http:POST&gt;
&lt;/http:receive-request&gt;
`</p>
</div>
<div class="paragraph">
<div class="title">Java DSL</div>
<p>`java
http().server(&quot;echoHttpServer&quot;)
    .receive()
    .post()
    .payload(&quot;Some other request data&quot;)
    .header(&quot;Operation&quot;, &quot;sayHello&quot;)
    .cookie(new Cookie(&quot;Token&quot;, &quot;${messageId}&quot;));
`</p>
</div>
<div class="paragraph">
<p>The Citrus message validation will make sure that the cookie is set in the request with respective name and value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-gzip-compression">HTTP Gzip compression</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gzip is a very popular compression mechanism for optimizing the message transportation for large content. The Citrus http client and server components support gzip compression out of the box. This means
that you only need to set the specific encoding headers in your http request/response message.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Accept-Encoding=gzip</dt>
<dd>
<p>Setting for clients when requesting gzip compressed response content. The Http server must support gzip compression then in order to provide the response as zipped byte stream. The Citrus http server component automatically recognizes this header in a request and applies gzip compression to the response.</p>
</dd>
<dt class="hdlist1">Content-Encoding=gzip</dt>
<dd>
<p>When a http server sends compressed message content to the client this header is set to <strong>gzip</strong> in order to mark the compression. The Http client must support gzip compression then in order to unzip the message content. The Citrus http client component automatically recognizes this header in a response and applies gzip unzip logic before passing the message to the test case.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Citrus client and server automatically take care on gzip compression when those headers are set. In the test case you do not need to zip or unzip the content then as it is automatically done before.</p>
</div>
<div class="paragraph">
<p>This means that you can request gzipped content from a server with just adding the message header <strong>Accept-Encoding</strong> in your http request operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Send Http client request for gzip compressed data<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzipClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:POST&gt;</span>
      <span class="tag">&lt;http:headers</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept-Encoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/http:headers&gt;</span>
<span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span>

<span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Receive text automatically gzip unzipped<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:receive-response</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzipClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>${text}<span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the server side if we receive a message and the response should be compressed with Gzip we just have to set the <strong>Content-Encoding</strong> header in the response operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Receive gzip compressed as base64 encoded text<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:POST</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/echo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept-Encoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span>

<span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Send Http server gzip compressed response<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Encoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>${text}<span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So the Citrus server will automatically add gzip compression to the response for us.</p>
</div>
<div class="paragraph">
<p>Of course you can also send gzipped content as a client. Then you would just set the <strong>Content-Encoding</strong> header to <strong>gzip</strong> in your request. The client will automatically apply compression for you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-servlet-filters">HTTP servlet filters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Citrus http server component supports custom servlet filters that take part in handling an incoming request/response communication. This might be useful when customizing
the basic server behavior such as custom zip/unzip mechanisms. The custom servlet filters are referenced in the http server component as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">filters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">filter-mappings</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filterMappings</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">request-caching-filter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.servlet.RequestCachingServletFilter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/entry&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip-filter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.servlet.GzipServletFilter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/entry&gt;</span>
<span class="tag">&lt;/util:map&gt;</span>

<span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filterMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">request-caching-filter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip-filter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/gzip/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The map of filters are specified as normal Spring configuration entries. The server component uses the attribute <code>filters</code> to reference a set of custom servlet filters.
The map holds one to many servlet filter beans each given a name that is also referenced in the respective servlet mappings. The servlet mappings specify when to apply those filters.</p>
</div>
<div class="paragraph">
<p>This way you can set a very custom servlet filter chain for each request/response communication. As usual the filter implementations can participate in the request and response handling process.</p>
</div>
<div class="paragraph">
<p>Citrus provides several default servlet implementations that are automatically added to each http server component these implementations are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">com.consol.citrus.http.servlet.RequestCachingServletFilter</dt>
<dd>
<p>caches incoming request data so input streams can be read multiple times during request processing (important when request logging is enabled)</p>
</dd>
<dt class="hdlist1">com.consol.citrus.http.servlet.GzipServletFilter</dt>
<dd>
<p>applies Gzip compressing when according headers are set and client explicitly asks for compressed request/response communication</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By the time you define some custom servlet filters or mappings to the server component Citrus will not apply default servlet filters. This means you always need to construct the whole servlet filter
chain including default servlet filters mentioned above.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-servlet-context-customization">HTTP servlet context customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Citrus HTTP server uses Spring application context loading on startup. For high customizations you can provide a custom servlet context file which holds all custom configurations as Spring beans for the server. Here is a sample servlet context with some basic Spring MVC components and the central HttpMessageController which is responsible for handling incoming requests (GET, PUT, DELETE, POST, etc.).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusHandlerMapping</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusMethodHandlerAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.converter.StringHttpMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supportedMediaTypes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;util:list&gt;</span>
            <span class="tag">&lt;value&gt;</span>text/xml<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/util:list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/util:list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusHttpMessageController</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.controller.HttpMessageController</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span>
       <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.endpoint.adapter.EmptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The beans above are responsible for proper HTTP server configuration. In general you do not need to adjust those beans, but we have the possibility to do so which gives us a great customization and extension points. The important part is the endpoint adapter definition inside the HttpMessageController. Once a client request was accepted the adapter is responsible for generating a proper response to the client.</p>
</div>
<div class="paragraph">
<p>You can add the custom servlet context as file resource to the Citrus HTTP server component. Just use the <strong>context-config-location</strong> attribute as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">context-config-location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/http/custom-servlet-context.xml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-05 17:34:29 MESZ
</div>
</div>
</body>
</html>