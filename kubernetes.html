<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Kubernetes support</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="kubernetes" class="article toc2 toc-left">
<div id="header">
<h1>Kubernetes support</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#kubernetes-client">Kubernetes client</a></li>
<li><a href="#kubernetes-commands-in-xml">Kubernetes commands in XML</a></li>
<li><a href="#kubernetes-commands-in-java">Kubernetes commands in Java</a></li>
<li><a href="#info-command">Info command</a></li>
<li><a href="#list-resources">List resources</a></li>
<li><a href="#list-nodes-and-namespaces">List nodes and namespaces</a></li>
<li><a href="#get-resources">Get resources</a></li>
<li><a href="#create-resources">Create resources</a></li>
<li><a href="#delete-resources">Delete resources</a></li>
<li><a href="#watch-resources">Watch resources</a></li>
<li><a href="#kubernetes-messaging">Kubernetes messaging</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://kubernetes.io/">Kubernetes</a> is one of the hottest management platforms for containerized applications these days. Kubernetes lets you deploy, scale and manage your containers on the platform so you get features like auto-scaling, self-healing, service discovery and load balancing.
Citrus provides interaction with the Kubernetes REST API so you can access the Kubernetes platform and its resources within a Citrus test case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Kubernetes test components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-kubernetes<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.2-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a "citrus-kubernetes" configuration namespace and schema definition for Kubernetes related components and actions. Include this namespace into your Spring configuration in order to use the Citrus Kubernetes configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-k8s</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/kubernetes/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/kubernetes/config</span>
       <span class="content">http://www.citrusframework.org/schema/kubernetes/config/citrus-kubernetes-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-client">Kubernetes client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus operates with the Kubernetes remote REST API in order to interact with the Kubernetes platform. The Kubernetes client is defined as Spring bean component in the configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-k8s:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kubernetes client is based on the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Java Kubernetes client</a> implementation. Following from that the component can be configured in various ways.
By default the client reads the system properties as well as environment variables for default Kubernetes settings such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>kubernetes.master</strong> / <strong>KUBERNETES_MASTER</strong></p>
</li>
<li>
<p><strong>kubernetes.api.version</strong> / <strong>KUBERNETES_API_VERSION</strong></p>
</li>
<li>
<p><strong>kubernetes.trust.certificates</strong> / <strong>KUBERNETES_TRUST_CERTIFICATES</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you set these properties in your environment the client component will automatically pick up the configuration settings. Also when using <code>kubectl</code> command line locally the client may automatically
use the stored user authentication settings from there. For a complete list of settings and explanation of those please refer to the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 client documentation</a>.</p>
</div>
<div class="paragraph">
<p>In case you need to set the client configuration explicitly on your environment you can also use explicit settings on the Kubernetes client component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-k8s:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8843</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s!cr!t</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user_namespace</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">message-converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverter</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">object-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus is able to access the Kubernetes remote API for executing commands such as list-pods, watch-services and so on. Citrus provides a set of actions that
perform a Kubernetes command via REST. The results usually get validated in the Citrus test as usual.</p>
</div>
<div class="paragraph">
<p>Based on that we can execute several Kubernetes commands in a test case and validate the Json results:</p>
</div>
<div class="paragraph">
<p>Citrus supports the following Kubernetes API commands with respective test actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>k8s:info</strong></p>
</li>
<li>
<p><strong>k8s:list-pods</strong></p>
</li>
<li>
<p><strong>k8s:get-pod</strong></p>
</li>
<li>
<p><strong>k8s:delete-pod</strong></p>
</li>
<li>
<p><strong>k8s:list-services</strong></p>
</li>
<li>
<p><strong>k8s:get-service</strong></p>
</li>
<li>
<p><strong>k8s:delete-service</strong></p>
</li>
<li>
<p><strong>k8s:list-namespaces</strong></p>
</li>
<li>
<p><strong>k8s:list-events</strong></p>
</li>
<li>
<p><strong>k8s:list-endpoints</strong></p>
</li>
<li>
<p><strong>k8s:list-nodes</strong></p>
</li>
<li>
<p><strong>k8s:list-replication-controllers</strong></p>
</li>
<li>
<p><strong>k8s:watch-pods</strong></p>
</li>
<li>
<p><strong>k8s:watch-services</strong></p>
</li>
<li>
<p><strong>k8s:watch-namespaces</strong></p>
</li>
<li>
<p><strong>k8s:watch-nodes</strong></p>
</li>
<li>
<p><strong>k8s:watch-replication-controllers</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will discuss these commands in detail later on in this chapter. For now lets have a closer look on how to use the commands inside of a Citrus test.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-commands-in-xml">Kubernetes commands in XML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have several Citrus test actions each representing a Kubernetes command. These actions can be part of a test case where you can manage Kubernetes pods inside the test. As a prerequisite we have to enable the Kubernetes
specific test actions in our XML test as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:k8s</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/kubernetes/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/kubernetes/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/kubernetes/testcase/citrus-kubernetes-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We added a special kubernetes namespace with prefix <strong>k8s:</strong> so now we can start to add Kubernetes test actions to the test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">KubernetesCommandIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;k8s:info</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;k8s:validate&gt;</span>
          <span class="tag">&lt;k8s:result&gt;</span>{
            &quot;result&quot;: {
              &quot;clientVersion&quot;: &quot;1.4.27&quot;,
              &quot;apiVersion&quot;: &quot;v1&quot;,
              &quot;kind&quot;:&quot;Info&quot;,
              &quot;masterUrl&quot;: &quot;${masterUrl}&quot;,
              &quot;namespace&quot;: &quot;test&quot;
            }
          }<span class="tag">&lt;/k8s:result&gt;</span>
        <span class="tag">&lt;/k8s:validate&gt;</span>
      <span class="tag">&lt;/k8s:info&gt;</span>

      <span class="tag">&lt;k8s:list-pods&gt;</span>
        <span class="tag">&lt;k8s:validate&gt;</span>
          <span class="tag">&lt;k8s:result&gt;</span>{
            &quot;result&quot;: {
              &quot;apiVersion&quot;:&quot;v1&quot;,
              &quot;kind&quot;:&quot;PodList&quot;,
              &quot;metadata&quot;:&quot;@ignore@&quot;,
              &quot;items&quot;:[]
            }
          }<span class="tag">&lt;/k8s:result&gt;</span>
          <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/k8s:validate&gt;</span>
      <span class="tag">&lt;/k8s:list-pods&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this very simple example we first ping the Kubernetes REST API to make sure we have connectivity up and running. The info command connects the REST API and returns a list of status information of the Kubernetes client.
After that we get the list of available Kubernetes pods. As a tester we might be interested in validating the command results. So wen can specify an optional <strong>k8s:result</strong> which is usually in Json format. With that we can apply the full
Citrus Json validation power to the Kubernetes results. As usual we can use test variables here and ignore some values explicitly such as the <strong>metadata</strong> value. Also JsonPath expression validation and Json test message validation features in
Citrus come in here to validate the results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-commands-in-java">Kubernetes commands in Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Up to now we have only used the Citrus XML DSL. Of course all Kubernetes commands are also available in Java DSL as the next example shows.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> kubernetesTest() {
    kubernetes().info()
                .validate(<span class="keyword">new</span> CommandResultCallback&lt;InfoResult&gt;() {
                    <span class="annotation">@Override</span>
                    <span class="directive">public</span> <span class="type">void</span> doWithCommandResult(InfoResult info, TestContext context) {
                        Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>);
                    }
            });

    kubernetes().pods()
                .list()
                .withoutLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">running</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL Kubernetes commands provide an optional <strong>CommandResultCallback</strong> that is automatically called with the unmarshalled command result object.
In the example above the <em>InfoResult</em> model object is passed as argument to the callback. So the tester can access the command result and validate its properties with assertions.</p>
</div>
<div class="paragraph">
<p>Java 8 Lambda expressions add some syntactical sugar to the command result validation:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> kubernetesTest() {
    kubernetes().info()
                .validate((info, context) -&gt; Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>));

    kubernetes().pods()
                .list()
                .withoutLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">running</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Citrus tries to find a Kubernetes client component within the Citrus Spring application context. If not present Citrus will instantiate a default kubernetes client with all default settings.
You can also explicitly set the kubernetes client instance when using the Java DSL Kubernetes command actions:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> KubernetesClient kubernetesClient;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> kubernetesTest() {
    kubernetes().client(kubernetesClient)
                .info()
                .validate((info, context) -&gt; Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>));

    kubernetes().client(kubernetesClient)
                .pods()
                .list()
                .withoutLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">running</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="info-command">Info command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The info command just gets the client connection settings and provides them as a Json result to the action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:info</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:validate&gt;</span>
    <span class="tag">&lt;k8s:result&gt;</span>{
      &quot;result&quot;: {
        &quot;clientVersion&quot;: &quot;1.4.27&quot;,
        &quot;apiVersion&quot;: &quot;v1&quot;,
        &quot;kind&quot;:&quot;Info&quot;,
        &quot;masterUrl&quot;: &quot;${masterUrl}&quot;,
        &quot;namespace&quot;: &quot;test&quot;
      }
    }<span class="tag">&lt;/k8s:result&gt;</span>
  <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:info&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> infoTest() {
    kubernetes().info()
                .validate((info, context) -&gt; Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="list-resources">List resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can list Kubernetes resources such as pods, services, endpoints and replication controllers. The list can be filtered by several properties such as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>label</p>
</li>
<li>
<p>namespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The test action is able to define respective filters to the list so we get only pods the match the given attributes:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:list-pods</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">app=todo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:result&gt;</span>{
        &quot;result&quot;: {
          &quot;apiVersion&quot;:&quot;${apiVersion}&quot;,
          &quot;kind&quot;:&quot;PodList&quot;,
          &quot;metadata&quot;:&quot;@ignore@&quot;,
          &quot;items&quot;:&quot;@ignore@&quot;
        }
      }<span class="tag">&lt;/k8s:result&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:list-pods&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> listPodsTest() {
    kubernetes()
        .client(k8sClient)
        .pods()
        .list()
        .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app=todo</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span>)
        .validate((pods, context) -&gt; {
            Assert.assertFalse(CollectionUtils.isEmpty(pods.getResult().getItems()));
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are able to give the pod label that is searched for in list of all pods. The list returned is validated either by giving an expected Json message
or by adding JsonPath expressions with expected values to check.</p>
</div>
<div class="paragraph">
<p>In Java DSL we can add a validation result callback that is provided with the unmarshalled result object for validation. Besides <em>label</em> filtering we can also specify the <em>namespace</em>
and the pod <em>name</em> to search for.</p>
</div>
<div class="paragraph">
<p>You can also define multiple labels as comma delimited list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:list-services</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stage!=test,provider=fabric8</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we have combined to label filters <em>stage!=test</em> and <em>provider=fabric8</em> on pods in namespace <em>default</em>. The first label filter is negated so the label <em>stage</em> should <strong>not</strong> be <em>test</em> here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="list-nodes-and-namespaces">List nodes and namespaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nodes and namespaces are special resources that are not filtered by their namespace as they are more global resources. The rest is pretty similar to listing pods or services. We can
add filteres such as <em>name</em> and <em>label</em>.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:list-namespaces</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:list-namespaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> listPodsTest() {
    kubernetes()
        .client(k8sClient)
        .namespaces()
        .list()
        .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span>)
        .validate((pods, context) -&gt; {
            Assert.assertFalse(CollectionUtils.isEmpty(pods.getResult().getItems()));
        });
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-resources">Get resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can get a very special Kubernetes resource such as a pod or service for detailed validation of that resource. We need to specify a resource name
in order to select the resource from list of available resources in Kubernetes.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:get-pod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:result&gt;</span>{
      &quot;result&quot;: {
        &quot;apiVersion&quot;:&quot;${apiVersion}&quot;,
        &quot;kind&quot;:&quot;Pod&quot;,
        &quot;metadata&quot;: {
            &quot;annotations&quot;:&quot;@ignore@&quot;,
            &quot;creationTimestamp&quot;:&quot;@ignore@&quot;,
            &quot;finalizers&quot;:[],
            &quot;generateName&quot;:&quot;@startsWith('hello-minikube-')@&quot;,
            &quot;labels&quot;:{
              &quot;pod-template-hash&quot;:&quot;@ignore@&quot;,
              &quot;run&quot;:&quot;hello-minikube&quot;
            },
            &quot;name&quot;:&quot;${podName}&quot;,
            &quot;namespace&quot;:&quot;default&quot;,
            &quot;ownerReferences&quot;:&quot;@ignore@&quot;,
            &quot;resourceVersion&quot;:&quot;@ignore@&quot;,
            &quot;selfLink&quot;:&quot;/api/${apiVersion}/namespaces/default/pods/${podName}&quot;,
            &quot;uid&quot;:&quot;@ignore@&quot;
        },
        &quot;spec&quot;: {
          &quot;containers&quot;: [{
            &quot;args&quot;:[],
            &quot;command&quot;:[],
            &quot;env&quot;:[],
            &quot;image&quot;:&quot;gcr.io/google_containers/echoserver:1.4&quot;,
            &quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,
            &quot;name&quot;:&quot;hello-minikube&quot;,
            &quot;ports&quot;:[{
              &quot;containerPort&quot;:8080,
              &quot;protocol&quot;:&quot;TCP&quot;
            }],
            &quot;resources&quot;:{},
            &quot;terminationMessagePath&quot;:&quot;/dev/termination-log&quot;,
            &quot;volumeMounts&quot;:&quot;@ignore@&quot;
          }],
          &quot;dnsPolicy&quot;:&quot;ClusterFirst&quot;,
          &quot;imagePullSecrets&quot;:&quot;@ignore@&quot;,
          &quot;nodeName&quot;:&quot;minikube&quot;,
          &quot;restartPolicy&quot;:&quot;Always&quot;,
          &quot;securityContext&quot;:&quot;@ignore@&quot;,
          &quot;serviceAccount&quot;:&quot;default&quot;,
          &quot;serviceAccountName&quot;:&quot;default&quot;,
          &quot;terminationGracePeriodSeconds&quot;:30,
          &quot;volumes&quot;:&quot;@ignore@&quot;
        },
        &quot;status&quot;: &quot;@ignore@&quot;
      }
      }<span class="tag">&lt;/k8s:result&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:get-pod&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> getPodsTest() {
    kubernetes()
        .client(k8sClient)
        .pods()
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span>)
        .validate((pod, context) -&gt; {
            Assert.assertEquals(pods.getResult().getStatus().getPhase(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span>);
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are able get the complete pod information from Kubernetes. The result is validated with Json message validator in Citrus. This means we can use <em>@ignore@</em> as well as test variables and
JsonPath expressions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-resources">Create resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can create new Kubernetes resources within a Citrus test. This is very important in case we need to setup new pods or services for the test run. You can create new resources
by giving a <code>.yml</code> file holding all information how to create the new resource. See the following sample YAML for a new pod and service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>kind: Pod
apiVersion: v1
metadata:
  name: hello-jetty-${randomId}
  namespace: default
  selfLink: /api/v1/namespaces/default/pods/hello-jetty-${randomId}
  uid: citrus:randomUUID()
  labels:
    server: hello-jetty
spec:
  containers:
    - name: hello-jetty
      image: jetty:9.3
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 8080
          protocol: TCP
  restartPolicy: Always
  terminationGracePeriodSeconds: 30
  dnsPolicy: ClusterFirst
  serviceAccountName: default
  serviceAccount: default
  nodeName: minikube</code></pre>
</div>
</div>
<div class="paragraph">
<p>This YAML file specifies a new resource of kind <em>Pod</em>. We define the metadata as well as all containers that are part of this pod. The container is build from
<em>jetty:9.3</em> Docker image that should be pulled automatically from Docker Hub registry. We also expose port 8080 as <em>containerPort</em> so the upcoming service configuration can provide this
port to clients as Kubernetes service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>kind: Service
apiVersion: v1
metadata:
  name: hello-jetty
  namespace: default
  selfLink: /api/v1/namespaces/default/services/hello-jetty
  uid: citrus:randomUUID()
  labels:
    service: hello-jetty
spec:
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 31citrus:randomNumber(3)
  selector:
    server: hello-jetty
  type: NodePort
  sessionAffinity: None</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service resource maps the port <em>8080</em> and selects all pods with label <em>server=hello-jetty</em>. This makes the jetty container available to clients. The service type is <em>NodePort</em> which means
that clients outside of Kubernetes are also able to access the service by using the dynamic port <em>nodePort=31xxx</em>. We can use Citrus functions such as <em>randomNumber</em> in the YAML files.</p>
</div>
<div class="paragraph">
<p>In the test case we can use these YAML files to create the resources in Kubernetes:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:create-pod</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:template</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:templates/hello-jetty-pod.yml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/k8s:create-pod&gt;</span>

<span class="tag">&lt;k8s:create-service</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:template</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:templates/hello-jetty-service.yml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/k8s:create-service&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> createPodsTest() {
    kubernetes()
        .pods()
        .create(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">templates/hello-jetty-pod.yml</span><span class="delimiter">&quot;</span></span>))
        .namespace(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>);

    kubernetes()
        .services()
        .create(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">templates/hello-jetty-service.yml</span><span class="delimiter">&quot;</span></span>))
        .namespace(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating new resources may take some time to finish. Kubernetes will have to pull images, build containers and start up everything. The create action is not waiting synchronously for all that to have happened.
Therefore we might add a list-pods action that waits for the new resources to appear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repeat-onerror-until-true</span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat('greaterThan(9)')@</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auto-sleep</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:list-pods</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server=hello-jetty</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
  <span class="tag">&lt;/k8s:list-pods&gt;</span>
<span class="tag">&lt;/repeat-onerror-until-true&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this repeat on error action we wait for the new <em>server=hello-jetty</em> labeled pod to be in state <em>Running</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delete-resources">Delete resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With that command we are able to delete a resource in Kubernetes. Up to now deletion of pods and services is supported. We have to give a name of the resource that we want
to delete.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:delete-pod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.success</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:delete-pod&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> deletePodsTest() {
    kubernetes()
        .pods()
        .delete(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span>)
        .validate((result, context) -&gt; Assert.assertTrue(result.getResult().getSuccess()));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="watch-resources">Watch resources</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The watch operation is still in experimental state and may face severe adjustments and improvements in near future.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using a watch command we add a subscription to change events on a Kubernetes resources. So we can watch resources such as pods, services for future changes.
Each change on that resource triggers a new watch event result that we can expect and validate.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:watch-pods</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:watch-pods&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> listPodsTest() {
    kubernetes()
        .pods()
        .watch()
        .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span>)
        .validate((watchEvent, context) -&gt; {
            Assert.assertFalse(watchEvent.hasError());
            Assert.assertEquals(((WatchEventResult) watchEvent).getAction(), Watcher.Action.DELETED);
        });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The watch command may be triggered several times for multiple changes on the respective Kubernetes resource. The watch action will always handle one single event result. The first
event trigger is forwarded to the action validation. All further watch events on that same resource are ignored. This means that you may need multiple watch actions in your test case in case you expect
multiple watch events to be triggered.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-messaging">Kubernetes messaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have seen how to access the Kubernetes remote REST API by using special Citrus test actions in out test. As an alternative to that we can also use more
generic send/receive actions in Citrus for accessing the Kubernetes API. We demonstrate this with a simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">KubernetesSendReceiveIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
          <span class="tag">&lt;data&gt;</span>
            { &quot;command&quot;: &quot;info&quot; }
          <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/send&gt;</span>

      <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;data&gt;</span>{
            &quot;command&quot;: &quot;info&quot;,
            &quot;result&quot;: {
                &quot;clientVersion&quot;: &quot;1.4.27&quot;,
                &quot;apiVersion&quot;: &quot;v1&quot;,
                &quot;kind&quot;:&quot;Info&quot;,
                &quot;masterUrl&quot;: &quot;${masterUrl}&quot;,
                &quot;namespace&quot;: &quot;test&quot;
              }
            }<span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/receive&gt;</span>

      <span class="tag">&lt;echo&gt;</span>
        <span class="tag">&lt;message&gt;</span>List all pods<span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/echo&gt;</span>

      <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
          <span class="tag">&lt;data&gt;</span>
            { &quot;command&quot;: &quot;list-pods&quot; }
          <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/send&gt;</span>

      <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;data&gt;</span>{
            &quot;command&quot;: &quot;list-pods&quot;,
            &quot;result&quot;: {
                  &quot;apiVersion&quot;:&quot;v1&quot;,
                  &quot;kind&quot;:&quot;PodList&quot;,
                  &quot;metadata&quot;:&quot;@ignore@&quot;,
                  &quot;items&quot;:[]
              }
          }<span class="tag">&lt;/data&gt;</span>
          <span class="tag">&lt;validate</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we can use the send/receive actions to call Kubernetes API commands and receive the respective results in Json format, too. This gives us the well known
Json validation mechanism in Citrus in order to validate the results from Kubernetes. This way you can load Kubernetes resources verifying its state and properties.
Of course JsonPath expressions also come in here in order to validate Json elements explicitly.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-05 16:56:12 MESZ
</div>
</div>
</body>
</html>