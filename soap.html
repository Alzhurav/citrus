<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>SOAP WebServices</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="soap-webservices" class="article toc2 toc-left">
<div id="header">
<h1>SOAP WebServices</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#soap-client">SOAP client</a></li>
<li><a href="#soap-client-interceptors">SOAP client interceptors</a></li>
<li><a href="#soap-server">SOAP server</a></li>
<li><a href="#soap-send-and-receive">SOAP send and receive</a></li>
<li><a href="#soap-headers">SOAP headers</a></li>
<li><a href="#soap-http-mime-headers">SOAP HTTP mime headers</a></li>
<li><a href="#soap-envelope-handling">SOAP Envelope handling</a></li>
<li><a href="#soap-server-interceptors">SOAP server interceptors</a></li>
<li><a href="#soap-1-2">SOAP 1.2</a></li>
<li><a href="#soap-faults">SOAP faults</a></li>
<li><a href="#send-soap-faults">Send SOAP faults</a></li>
<li><a href="#receive-soap-faults">Receive SOAP faults</a></li>
<li><a href="#multiple-soap-fault-details">Multiple SOAP fault details</a></li>
<li><a href="#send-http-error-codes-with-soap">Send HTTP error codes with SOAP</a></li>
<li><a href="#soap-attachment-support">SOAP attachment support</a></li>
<li><a href="#send-soap-attachments">Send SOAP attachments</a></li>
<li><a href="#receive-soap-attachments">Receive SOAP attachments</a></li>
<li><a href="#soap-mtom-support">SOAP MTOM support</a></li>
<li><a href="#soap-client-basic-authentication">SOAP client basic authentication</a></li>
<li><a href="#soap-server-basic-authentication">SOAP server basic authentication</a></li>
<li><a href="#ws-addressing-support">WS-Addressing support</a></li>
<li><a href="#soap-client-fork-mode">SOAP client fork mode</a></li>
<li><a href="#soap-servlet-context-customization">SOAP servlet context customization</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>SOAP Web Services over HTTP is a widely used communication scenario in modern enterprise applications. A SOAP Web Service client is posting a SOAP request via HTTP to a server. SOAP via HTTP is a synchronous message protocol by default so the client is waiting synchronously for the response message. Citrus provides both SOAP client and server components in order to meet both directions of this scenario. The components used are very similar to the HTTP components that were have discussed in the sections before.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The SOAP WebService components in Citrus are kept in a separate Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-ws<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.2-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use the SOAP WebService support you need to include the specific XML configuration schema provided by Citrus. See following XML definition to find out how to include the citrus-ws namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/config</span>
       <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/ws/config</span>
       <span class="content">http://www.citrusframework.org/schema/ws/config/citrus-ws-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the customized soap configuration elements - all using the citrus-ws prefix - in your Spring configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-client">SOAP client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus is able to form a proper SOAP request in order to pass it to the server via HTTP and validate the respective SOAP response message. Let us see how a message client for SOAP looks like in the Spring configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The client component uses the <strong>request-url</strong> in order to access the server resource. The client will automatically build a proper SOAP request message including the SOAP envelope, SOAP header and the message payload as SOAP body. This means that you as a tester do not care about SOAP envelope specific logic in the test case. The client endpoint component saves the synchronous SOAP response so the test case can receive this message with a normal receive test action.</p>
</div>
<div class="paragraph">
<p>In detail you as a tester just send and receive using the same client endpoint reference just as you would do with a synchronous JMS or channel communication. In case no response message is available in time according to the timeout settings Citrus raises a timeout error and the test will fail.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The SOAP client component uses a SoapMessageFactory implementation in order to create the SOAP messages. This is a Spring bean added to the Citrus Spring application context. Spring offers several reference implementations as message factories so you can choose one of them (e.g. for SOAP 1.1 or 1.2 implementations).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Default SOAP Message Factory (SOAP 1.1) --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- SOAP 1.2 Message Factory --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.SoapVersion.SOAP_12</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Citrus will search for a bean with id <strong>'messageFactory'</strong> . In case you intend to use different identifiers you need to tell the SOAP client component which message factory to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Up to now we have used a static endpoint request url for the SOAP message sender. Besides that we can use dynamic endpoint uri in configuration. We just use an endpoint uri resolver instead of the static request url like this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">endpoint-resolver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dynamicEndpointResolver</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dynamicEndpointResolver</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.endpoint.resolver.DynamicEndpointUriResolver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>dynamicEndpointResolver</strong> bean must implement the EndpointUriResolver interface in order to resolve dynamic endpoint uri values. Citrus offers a default implementation, the <strong>DynamicEndpointUriResolver</strong>, which uses a specific message header for setting the dynamic endpoint uri for each message. The message header needs to specify the header <strong>citrus_endpoint_uri</strong> with a valid request uri. Just like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_endpoint_uri</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:${port}/${context}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you can use dynamic test variables then in order to build the request uri to use. The SOAP client evaluates the endpoint uri header and sends the message to this server resource. You can use a different uri value then in different test cases and send actions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-client-interceptors">SOAP client interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client component is able to add custom interceptors that participate in the request/response processing. The interceptors need to implement the common interface <strong>org.springframework.ws.client.support.interceptor.ClientInterceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secureSoapClient</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/services/ws/todolist</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securementActions</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Timestamp UsernameToken</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securementUsername</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securementPassword</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.LoggingClientInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above adds Wss4J WsSecurity interceptors in order to add security constraints to the request messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When customizing the interceptor chain all default interceptors (like logging interceptor) are lost. You need to add these interceptors explicitly as shown with the <em>com.consol.citrus.ws.interceptor.LoggingClientInterceptor</em> which
is able to log request/response messages during communication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-server">SOAP server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every client need a server to talk to. When receiving SOAP messages we require a web server instance listening on a port. Citrus is using an embedded Jetty server instance in combination with the Spring Web Service API in order to accept SOAP request calls asa server. See how the Citrus SOAP server is configured in the Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The server component is able to start automatically when application starts up. In the example above the server is listening for requests on port <strong><em>8080</em></strong> . This setup uses the standard connector configuration for the Jetty server. For detailed customization the Citrus Jetty server configuration also supports explicit connector configurations (@connector and @connectors attributes). For more information please see the Jetty connector documentation.</p>
</div>
<div class="paragraph">
<p>Test cases interact with this server instance via message channels by default. The server component provides an inbound channel that holds incoming request messages. The test case can receive those requests from the channel with a normal receive test action. In a second step the test case can provide a synchronous response message as reply which will be automatically sent back to the calling SOAP client as response.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_010.jpg" alt="figure_010.jpg"></span></p>
</div>
<div class="paragraph">
<p>The figure above shows the basic setup with inbound channel and reply channel. You as a tester should not worry about this to much. By default you as a tester just use the server as synchronous endpoint in your test case. This means that you simply receive a message from the server and send a response back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapServerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we reference the server id in both receive and send actions. The Citrus server instance will automatically send the response back to the calling client. In most cases this is what you need to simulate a SOAP server instance in Citrus. Of course we have some more customization possibilities that we will go over later on. This customizations are optional so you can also skip the next description on endpoint adapters if you are happy with just what you have learned about the SOAP server component in Citrus.</p>
</div>
<div class="paragraph">
<p>Just like the HTTP server component the SOAP server component by default uses the channel endpoint adapter in order to forward all incoming requests to an in memory message channel. This is done completely behind the scenes. The Citrus configuration has become a lot easier here so you do not have to configure this by default. When nothing else is set the test case does not worry about that settings on the server and just uses the server id reference as synchronous endpoint.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The default channel endpoint adapter automatically creates an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message channel. The message channel follows a naming convention <strong>{serverName}.inbound</strong> where <strong>{serverName}</strong> is the Spring bean name of the Citrus server endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However we do not want to loose the great extendability and customizing capabilities of the Citrus server component. This is why you can optionally define the endpoint adapter implementation used by the Citrus SOAP server. We provide several message endpoint adapter implementations for different simulation strategies. With these endpoint adapters you should be able to generate proper SOAP response messages for the client in various ways. Before we have a closer look at the different adapter implementations we want to show how you can set a custom endpoint adapter on the server component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">endpoint-adapter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;citrus:empty-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this endpoint adapter configuration above we change the Citrus server behavior from scratch. Now the server automatically sends back an empty SOAP response message every time. Setting a custom endpoint adapter implementation with custom logic is easy as defining a custom endpoint adapter Spring bean and reference it in the server attribute. You can read more about endpoint adapters in <a href="#endpoint-adapter">endpoint-adapter</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-send-and-receive">SOAP send and receive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus provides test actions for sending and receiving messages of all kind. Different message content and different message transports are available to these send and receive actions. When using SOAP message transport we might need to set special information on that messages. These are special SOAP headers, SOAP faults and so on. So we have created a special SOAP namespace for all your SOAP related send and receive operations in a XML DSL test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns:ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/testcase</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
          <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
          <span class="content">http://www.citrusframework.org/schema/testcase</span>
          <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
          <span class="content">http://www.citrusframework.org/schema/ws/testcase</span>
          <span class="content">http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have added the <strong>ws</strong> namespace from above to your test case you are ready to use special send and receive operations in the test.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span>

          <span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The special namespace contains following elements:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
send
</td>
<td class="hdlist2">
<p>Special send operation for sending out SOAP message content.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
receive
</td>
<td class="hdlist2">
<p>Special receive operation for validating SOAP message content.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
send-fault
</td>
<td class="hdlist2">
<p>Special send operation for sending out SOAP fault message content.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
assert-fault
</td>
<td class="hdlist2">
<p>Special assertion operation for expecting a SOAP fault message as response.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The special SOAP related send and receive actions can coexist with normal Citrus actions. In fact you can mix those action types as you want inside of a test case. All test actions that work with SOAP message content on client and server side should use this special namespace.</p>
</div>
<div class="paragraph">
<p>In Java DSL we have something similar to that. The Java DSL provides special SOAP related features when calling the <strong>soap()</strong> method. With a fluent API you are able to then send and receive SOAP message content as client and server.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void soapTest() {

    soap().client(&quot;soapClient&quot;)
        .send()
        .soapAction(&quot;MySoapService/sayHello&quot;)
        .payload(&quot;...&quot;);

    soap().client(&quot;soapClient&quot;)
        .receive()
        .payload(&quot;...&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following sections the SOAP related capabilities are discussed in more detail.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-headers">SOAP headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOAP defines several header variations that we discuss in the following sections. First of all we deal with the special <strong>SOAP action</strong> header. In case we need to set this SOAP action header we simply need to use the special <strong><em>soap-action</em></strong> attribute in our test. The special header key in combination with a underlying SOAP client endpoint component constructs the SOAP action in the SOAP message.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span>

          <span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void soapActionTest() {

    soap().client(&quot;soapClient&quot;)
        .send()
        .soapAction(&quot;MySoapService/sayHello&quot;)
        .payload(&quot;...&quot;);

    soap().server(&quot;soapClient&quot;)
        .receive()
        .soapAction(&quot;MySoapService/sayHello&quot;)
        .payload(&quot;...&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SOAP action header is added to the message before sending and validated when used in a receive operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>soap-action</strong> attribute is defined in the special SOAP namespace in Citrus. We recommend to use this namespace for all your send and receive operations that deal with SOAP message content. However you can also set the special SOAP action header when not using the special SOAP namespace: Just set this header in your test action:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly a SOAP message is able to contain customized SOAP headers. These are key-value pairs where the key is a qualified name (QName) and the value a normal String value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/sayHello}h1:Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/sayHello}h1:Request</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The key is defined as qualified QName character sequence which has a mandatory XML namespace and a prefix along with a header name. Last not least a SOAP header can contain whole XML fragment values. The next example shows how to set these XML fragments as SOAP header in Citrus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;User xmlns=&quot;http://www.consol.de/schemas/sayHello&quot;&gt;
              &lt;UserId&gt;123456789&lt;/UserId&gt;
              &lt;Handshake&gt;S123456789&lt;/Handshake&gt;
          &lt;/User&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use external file resources to set this SOAP header XML fragment as shown in this last example code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:request-soap-header.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the SOAP header possibilities for sending SOAP messages with Citrus. Of course you can also use these variants in SOAP message header validation. You define expected SOAP headers, SOAP action and XML fragments and Citrus will match incoming request to that. Just use <strong>citrus_soap_action</strong> header key in your receiving message action and you validate this SOAP header accordingly.</p>
</div>
<div class="paragraph">
<p>When validating SOAP header XML fragments you need to define the whole XML header fragment as expected header data like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;ResponseMessage xmlns=&quot;http://citrusframework.org/schema&quot;&gt;
              &lt;resultCode&gt;OK&lt;/resultCode&gt;
            &lt;/ResponseMessage&gt;
          <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;data&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;SOAP-ENV:Header
                    xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
                    &lt;customHeader xmlns=&quot;http://citrusframework.org/headerschema&quot;&gt;
                        &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                        &lt;applicationId&gt;${applicationId}&lt;/applicationId&gt;
                        &lt;trackingId&gt;${trackingId}&lt;/trackingId&gt;
                        &lt;serviceId&gt;${serviceId}&lt;/serviceId&gt;
                        &lt;interfaceVersion&gt;1.0&lt;/interfaceVersion&gt;
                        &lt;timestamp&gt;@ignore@&lt;/timestamp&gt;
                    &lt;/customHeader&gt;
                &lt;/SOAP-ENV:Header&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the SOAP XML header validation can combine header element and XML fragment validation. This is also likely to be used when dealing with WS-Security message headers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-http-mime-headers">SOAP HTTP mime headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Besides the SOAP specific header elements the HTTP mime headers (e.g. Content-Type, Content-Length, Authorization) might be candidates for validation, too. When using HTTP as transport layer the SOAP message may define those mime headers. The tester is able to send and validate these headers inside the test case, although these HTTP headers are located outside of the SOAP envelope. Let us first of all speak about validating the HTTP mime headers. This feature is not enabled by default. We have enable this in our SOAP server configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">handle-mime-headers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration Citrus will handle all available mime headers and pass those to the test case for normal header validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapMessageRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Operation&gt;</span>Validate mime headers<span class="tag">&lt;/Operation&gt;</span>
            <span class="tag">&lt;/SoapMessageRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml; charset=utf-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation of these HTTP mime headers is as usual now that we have enabled the mime header handling in the SOAP server. The transport HTTP headers are available in the header just like the normal SOAP header elements do. So you can validate the headers as usual.</p>
</div>
<div class="paragraph">
<p>So much for receiving and validating HTTP mime message headers with SOAP communication. Now we want to send special mime headers on client side. We overwrite or add mime headers to our sending action. We mark some headers with following prefix <strong><em>"citrus_http</em>"_</strong> . This tells the SOAP client to add these headers to the HTTP header section outside the SOAP envelope. Keep in mind that header elements without this prefix go right into the SOAP header section by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  [...]
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
  [...]
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines a HTTP mime header <strong>operation</strong> . The header prefix <strong><em>citrus_http_</em></strong> is cut off before the header goes into the HTTP header section. With this feature we can decide where exactly our header information is located in our resulting client message.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-envelope-handling">SOAP Envelope handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default Citrus will remove the SOAP envelope in message converter. Following from that the Citrus test case is independent from SOAP message formats and is not bothered with handling of SOAP envelope at all. This is great in most cases but sometimes it might be mandatory to also see the whole SOAP envelope inside the test case receive action. Therefore you can keep the SOAP envelope for incoming messages by configuration on the SOAP server side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">keep-soap-envelope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration Citrus will handle all available mime headers and pass those to the test case for normal header validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;payload&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;SoapMessageRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;Operation&gt;</span>Validate mime headers<span class="tag">&lt;/Operation&gt;</span>
        <span class="tag">&lt;/SoapMessageRequest&gt;</span>
      <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span>
  <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So now you are able to validate the whole SOAP envelope as is. This might be of interest in very special cases. As mentioned by default the Citrus server will automatically remove the SOAP envelope and translate the SOAP body to the message payload for straight forward validation inside the test cases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-server-interceptors">SOAP server interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Citrus SOAP server supports the concept of interceptors in order to add custom logic to the request/response processing steps. The interceptors need to implement a common interface: <strong>org.springframework.ws.server.EndpointInterceptor</strong>. We are able to customize the interceptor
chain on the server component as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secureSoapServer</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.SoapMustUnderstandEndpointInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">acceptedHeaders</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;list&gt;</span>
        <span class="tag">&lt;value&gt;</span>{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security<span class="tag">&lt;/value&gt;</span>
      <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.LoggingEndpointInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validationActions</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Timestamp UsernameToken</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validationCallbackHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">passwordCallbackHandler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.security.wss4j.callback.SimplePasswordValidationCallbackHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usersMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom interceptors are used to enable WsSecurity features on the soap server component via Wss4J.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When customizing the interceptor chain of the soap server component all default interceptors (like logging interceptors) are lost. You can see that we had to add
the <em>com.consol.citrus.ws.interceptor.LoggingEndpointInterceptor</em> explicitly in order to log request/response messages for the server communication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-1-2">SOAP 1.2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default Citrus components use SOAP 1.1 version. Fortunately SOAP 1.2 is supported same way. As we already mentioned before the Citrus SOAP components do use a SOAP message factory for creating messages in SOAP format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SOAP 1.1 Message Factory --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMessageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.SoapVersion.SOAP_11</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- SOAP 1.2 Message Factory --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.SoapVersion.SOAP_12</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the SOAP message factory can either create SOAP 1.1 or SOAP 1.2 messages. This is how Citrus can create both SOAP 1.1 and SOAP 1.2 messages. Of course you can have multiple message factories configured in your project. Just set the message factory on a WebService client or server component in order to define which version should be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12Client</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/echo</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12Server</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">root-parent-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Citrus components do connect with a message factory called <strong>messageFactory</strong> no matter what SOAP version this factory is using.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-faults">SOAP faults</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOAP faults describe a failed communication in SOAP WebServices world. Citrus is able to send and receive SOAP fault messages. On server side Citrus can simulate SOAP faults with fault-code, fault-reason, fault-actor and fault-detail. On client side Citrus is able to handle and validate SOAP faults in response messages. The next section describes how to deal with SOAP faults in Citrus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="send-soap-faults">Send SOAP faults</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As Citrus simulates SOAP server endpoints you also need to think about sending a SOAP fault to the calling client. In case Citrus receives a SOAP request as a server you can respond with a proper SOAP fault if necessary.</p>
</div>
<div class="paragraph">
<p>Please keep in mind that we use the citrus-ws extension for sending SOAP faults in our test case, as shown in this very simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send-fault</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault&gt;</span>
        <span class="tag">&lt;ws:fault-code&gt;</span>{http://www.citrusframework.org/faults}citrus:TEC-1000<span class="tag">&lt;/ws:fault-code&gt;</span>
        <span class="tag">&lt;ws:fault-string&gt;</span>Invalid request<span class="tag">&lt;/ws:fault-string&gt;</span>
        <span class="tag">&lt;ws:fault-actor&gt;</span>SERVER<span class="tag">&lt;/ws:fault-actor&gt;</span>
        <span class="tag">&lt;ws:fault-detail&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/sayHello.xsd&quot;&gt;
                    &lt;MessageId&gt;${messageId}&lt;/MessageId&gt;
                    &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                    &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
                    &lt;Text&gt;Invalid request&lt;/Text&gt;
                &lt;/FaultDetail&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;/ws:fault&gt;</span>
    <span class="tag">&lt;ws:header&gt;</span>
        <span class="tag">&lt;ws:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:header&gt;</span>
<span class="tag">&lt;/ws:send-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example generates a simple SOAP fault that is sent back to the calling client. The fault-actor and the fault-detail elements are optional. Same with the soap action declared in the special Citrus header <strong><em>citrus_soap_action</em></strong> . In the sample above the fault-detail data is placed inline as XML data. As an alternative to that you can also set the fault-detail via external file resource. Just use the <strong><em>file</em></strong> attribute as fault detail instead of the inline CDATA definition.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send-fault</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault&gt;</span>
        <span class="tag">&lt;ws:fault-code&gt;</span>{http://www.citrusframework.org/faults}citrus:TEC-1000<span class="tag">&lt;/ws:fault-code&gt;</span>
        <span class="tag">&lt;ws:fault-string&gt;</span>Invalid request<span class="tag">&lt;/ws:fault-string&gt;</span>
        <span class="tag">&lt;ws:fault-actor&gt;</span>SERVER<span class="tag">&lt;/ws:fault-actor&gt;</span>
        <span class="tag">&lt;ws:fault-detail</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:myFaultDetail.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:fault&gt;</span>
    <span class="tag">&lt;ws:header&gt;</span>
        <span class="tag">&lt;ws:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:header&gt;</span>
<span class="tag">&lt;/ws:send-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated SOAP fault looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: &quot;sayHello&quot;
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

<span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;SOAP-ENV:Fault&gt;</span>
            <span class="tag">&lt;faultcode</span> <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/faults</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus:TEC-1000<span class="tag">&lt;/faultcode&gt;</span>
            <span class="tag">&lt;faultstring</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Invalid request<span class="tag">&lt;/faultstring&gt;</span>
            <span class="tag">&lt;detail&gt;</span>
                <span class="tag">&lt;FaultDetail</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;MessageId&gt;</span>9277832563<span class="tag">&lt;/MessageId&gt;</span>
                    <span class="tag">&lt;CorrelationId&gt;</span>4346806225<span class="tag">&lt;/CorrelationId&gt;</span>
                    <span class="tag">&lt;ErrorCode&gt;</span>TEC-1000<span class="tag">&lt;/ErrorCode&gt;</span>
                    <span class="tag">&lt;Text&gt;</span>Invalid request<span class="tag">&lt;/Text&gt;</span>
                <span class="tag">&lt;/FaultDetail&gt;</span>
            <span class="tag">&lt;/detail&gt;</span>
        <span class="tag">&lt;/SOAP-ENV:Fault&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice that the send action uses a special XML namespace (ws:send). This ws namespace belongs to the Citrus WebService extension and adds SOAP specific features to the normal send action. When you use such ws extensions you need to define the additional namespace in your test case. This is usually done in the root <code>&lt;spring:beans&gt;</code> element where we simply declare the citrus-ws specific namespace like follows.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="receive-soap-faults">Receive SOAP faults</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In case you receive SOAP response messages as a client endpoint you may need to handle and validate SOAP faults in error situations. Citrus can validate SOAP faults with fault-code, fault-actor, fault-string and fault-detail values.</p>
</div>
<div class="paragraph">
<p>As a client we send out a request and receive a SOAP fault as response. By default the client sending action in Citrus throws a specific exception when the SOAP response is a SOAP fault element. This exception is called <strong><em>SoapFaultClientException</em></strong> coming from the Spring API. You as a tester can assert this kind of exception in a test case in order to expect the SOAP error.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assert</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.client.SoapFaultClientException</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
            <span class="tag">&lt;payload&gt;</span>
                <span class="tag">&lt;SoapFaultForcingRequest</span>
                  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
                <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
            <span class="tag">&lt;/payload&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/send&gt;</span>
<span class="tag">&lt;/assert&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The SOAP message sending action is surrounded by a simple assert action. The asserted exception class is the <strong><em>SoapFaultClientException</em></strong> that we have mentioned before. This means that the test expects the exception to be thrown during the communication. In case the exception is missing the test is fails.</p>
</div>
<div class="paragraph">
<p>So far we have used the Citrus core capabilities of asserting an exception. This basic assertion test action is not able to offer direct access to the SOAP fault-code and fault-string values for validation. The basic assert action simply has no access to the actual SOAP fault elements. Fortunately we can use the <strong>citrus-ws</strong> namespace again which offers a special assert action implementation especially designed for SOAP faults in this case.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           fault-actor=&quot;SERVER&quot;<span class="error">&gt;</span>
  <span class="tag">&lt;ws:when&gt;</span>
    <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
            <span class="tag">&lt;payload&gt;</span>
                <span class="tag">&lt;SoapFaultForcingRequest</span>
                  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
                <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
            <span class="tag">&lt;/payload&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/send&gt;</span>
  <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The special assert action offers several attributes to validate the expected SOAP fault. Namely these are <strong>"fault-code"</strong>, <strong>"fault-string"</strong> and <strong>"fault-actor"</strong> . The <strong>fault-code</strong> is defined as a QName string and is mandatory for the validation. The fault assertion also supports test variable replacement as usual.</p>
</div>
<div class="paragraph">
<p>The time you use SOAP fault validation you need to tell Citrus how to validate the SOAP faults. Citrus needs an instance of a <strong><em>SoapFaultValitator</em></strong> that we need to add to the Spring application context. By default Citrus is searching for a bean with the id <strong>'soapFaultValidator'</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapFaultValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus offers several reference implementations for these SOAP fault validators. These are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</p>
</li>
<li>
<p>com.consol.citrus.ws.validation.SimpleSoapFaultValidator</p>
</li>
<li>
<p>com.consol.citrus.ws.validation.XmlSoapFaultValidator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please see the API documentation for details on the available reference implementations. Of course you can also define your own SOAP validator logic (would be great if you could share your ideas!). In the test case you can explicitly choose the validator to use:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">fault-validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialSoapFaultValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   [...]
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Another important thing to notice when asserting SOAP faults is the fact, that Citrus needs to have a <strong><em>SoapMessageFactory</em></strong> available in the Spring application context. If you deal with SOAP messaging in general you will already have such a bean in the context.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Choose one of Spring&#8217;s reference implementations or some other implementation as SOAP message factory. Citrus will search for a bean with id <strong>'messageFactory'</strong> by default. In case you have other beans with different identifiers please choose the messageFactory in the test case assert action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   [...]
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice the ws specific namespace that belongs to the Citrus WebService extensions. As the <strong>ws:assert</strong> action uses SOAP specific features we need to refer to the citrus-ws namespace. You can find the namespace declaration in the root element in your test case.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus is also able to validate SOAP fault details. See the following example for understanding how to do it:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault-detail&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
              &lt;Text&gt;Invalid request&lt;/Text&gt;
          &lt;/FaultDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;SoapFaultForcingRequest</span>
                      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
                    <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expected SOAP fault detail content is simply added to the <strong>ws:assert</strong> action. The <strong><em>SoapFaultValidator</em></strong> implementation defined in the Spring application context is responsible for checking the SOAP fault detail with validation algorithm. The validator implementation checks the detail content to meet the expected template. Citrus provides some default <strong><em>SoapFaultValidator</em></strong> implementations. Supported algorithms are pure String comparison (<strong>com.consol.citrus.ws.validation.SimpleSoapFaultValidator</strong>) as well as XML tree walk-through (<strong>com.consol.citrus.ws.validation.XmlSoapFaultValidator</strong>).</p>
</div>
<div class="paragraph">
<p>When using the XML validation algorithm you have the complete power as known from normal message validation in receive actions. This includes schema validation or ignoring elements for instance. On the fault-detail element you are able to add some validation settings such as <strong>schema-validation=enabled/disabled</strong>, custom <strong>schema-repository</strong> and so on.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault-detail</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
              &lt;Text&gt;Invalid request&lt;/Text&gt;
          &lt;/FaultDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            [...]
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please see also the Citrus API documentation for available validator implementations and validation algorithms.</p>
</div>
<div class="paragraph">
<p>So far we have used assert action wrapper in order to catch SOAP fault exceptions and validate the SOAP fault content. Now we have an alternative way of handling SOAP faults in Citrus. With exceptions the send action aborts and we do not have a receive action for the SOAP fault. This might be inadequate if we need to validate the SOAP message content (SOAPHeader and SOAPBody) coming with the SOAP fault. Therefore the web service message sender component offers several fault strategy options. In the following we discuss the propagation of SOAP fault as messages to the receive action as we would do with normal SOAP messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">fault-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propagateError</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have configured a fault strategy <strong>propagateError</strong> so the message sender will not raise client exceptions but inform the receive action with SOAP fault message contents. By default the fault strategy raises client exceptions (fault-strategy= <strong>throwsException</strong>).</p>
</div>
<div class="paragraph">
<p>So now that we do not raise exceptions we can leave out the assert action wrapper in our test. Instead we simply use a receive action and validate the SOAP fault like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapFaultForcingRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
            <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SOAP-ENV:Fault</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;faultcode</span> <span class="attribute-name">xmlns:CITRUS</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.org/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>CITRUS:${soapFaultCode}<span class="tag">&lt;/faultcode&gt;</span>
                <span class="tag">&lt;faultstring</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${soapFaultString}<span class="tag">&lt;/faultstring&gt;</span>
            <span class="tag">&lt;/SOAP-ENV:Fault&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So choose the preferred way of handling SOAP faults either by asserting client exceptions or propagating fault messages to the receive action on a SOAP client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multiple-soap-fault-details">Multiple SOAP fault details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOAP fault messages can hold multiple SOAP fault detail elements. In the previous sections we have used SOAP fault details in sending and receiving actions as single element. In order to meet the SOAP specification Citrus is also able to handle multiple SOAP fault detail elements in a message. You just use multiple fault-detail elements in your test action like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send-fault</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault&gt;</span>
        <span class="tag">&lt;ws:fault-code&gt;</span>{http://www.citrusframework.org/faults}citrus:TEC-1000<span class="tag">&lt;/ws:fault-code&gt;</span>
        <span class="tag">&lt;ws:fault-string&gt;</span>Invalid request<span class="tag">&lt;/ws:fault-string&gt;</span>
        <span class="tag">&lt;ws:fault-actor&gt;</span>SERVER<span class="tag">&lt;/ws:fault-actor&gt;</span>
        <span class="tag">&lt;ws:fault-detail&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/sayHello.xsd&quot;&gt;
                    &lt;MessageId&gt;${messageId}&lt;/MessageId&gt;
                    &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                    &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
                    &lt;Text&gt;Invalid request&lt;/Text&gt;
                &lt;/FaultDetail&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/ws:fault-detail&gt;</span>
        <span class="tag">&lt;ws:fault-detail&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;ErrorDetail xmlns=&quot;http://www.consol.de/schemas/sayHello.xsd&quot;&gt;
                    &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
                &lt;/ErrorDetail&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;/ws:fault&gt;</span>
    <span class="tag">&lt;ws:header&gt;</span>
        <span class="tag">&lt;ws:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:header&gt;</span>
<span class="tag">&lt;/ws:send-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in following SOAP envelope message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: &quot;sayHello&quot;
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

<span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;SOAP-ENV:Fault&gt;</span>
            <span class="tag">&lt;faultcode</span> <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/faults</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus:TEC-1000<span class="tag">&lt;/faultcode&gt;</span>
            <span class="tag">&lt;faultstring</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Invalid request<span class="tag">&lt;/faultstring&gt;</span>
            <span class="tag">&lt;detail&gt;</span>
                <span class="tag">&lt;FaultDetail</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;MessageId&gt;</span>9277832563<span class="tag">&lt;/MessageId&gt;</span>
                    <span class="tag">&lt;CorrelationId&gt;</span>4346806225<span class="tag">&lt;/CorrelationId&gt;</span>
                    <span class="tag">&lt;ErrorCode&gt;</span>TEC-1000<span class="tag">&lt;/ErrorCode&gt;</span>
                    <span class="tag">&lt;Text&gt;</span>Invalid request<span class="tag">&lt;/Text&gt;</span>
                <span class="tag">&lt;/FaultDetail&gt;</span>
                <span class="tag">&lt;ErrorDetail</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;ErrorCode&gt;</span>TEC-1000<span class="tag">&lt;/ErrorCode&gt;</span>
                <span class="tag">&lt;/ErrorDetail&gt;</span>
            <span class="tag">&lt;/detail&gt;</span>
        <span class="tag">&lt;/SOAP-ENV:Fault&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we can also expect several fault detail elements when receiving a SOAP fault.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault-detail</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
              &lt;Text&gt;Invalid request&lt;/Text&gt;
          &lt;/FaultDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:fault-detail&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;ErrorDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
          &lt;/ErrorDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            [...]
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we can individually use validation settings for each fault detail. In the example above we disabled schema validation for the first fault detail element.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="send-http-error-codes-with-soap">Send HTTP error codes with SOAP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SOAP server logic in Citrus is able to simulate pure HTTP error codes such as 404 "Not found" or 500 "Internal server error". The good thing is that the Citrus server is able to receive a request for proper validation in a receive action and then simulate HTTP errors on demand.</p>
</div>
<div class="paragraph">
<p>The mechanism on HTTP error code simulation is not different to the usual SOAP request/response handling in Citrus. We receive the request as usual and we provide a response. The HTTP error situation is simulated according to the special HTTP header <strong>citrus_http_status</strong> in the Citrus SOAP response definition. In case this header is set to a value other than 200 OK the Citrus SOAP server sends an empty SOAP response with HTTP error status code set accordingly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
      <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;Message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;Text&gt;</span>Hello SOAP server<span class="tag">&lt;/Text&gt;</span>
          <span class="tag">&lt;/Message&gt;</span>
      <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span><span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_status_code</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The SOAP response must be empty and the HTTP status code is set to a value other than 200, like 500. This results in a HTTP error sent to the calling client with error 500 "Internal server error".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-attachment-support">SOAP attachment support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus is able to add attachments to a SOAP request on client and server side. As usual you can validate the SOAP attachment content on a received SOAP message. The next chapters describe how to handle SOAP attachments in Citrus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="send-soap-attachments">Send SOAP attachments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As client Citrus is able to add attachments to the SOAP message. I think it is best to go straight into an example in order to understand how it works.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapMessageWithAttachment</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Operation&gt;</span>Read the attachment<span class="tag">&lt;/Operation&gt;</span>
            <span class="tag">&lt;/SoapMessageWithAttachment&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapAttachment</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/ws/soapAttachment.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the previous chapters you may have already noticed the <strong>citrus-ws</strong> namespace that stands for the SOAP extensions in Citrus. Please include the <strong>citrus-ws</strong> namespace in your test case as described earlier in this chapter so you can use the attachment support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The special send action of the SOAP extension namespace is aware of SOAP attachments. The attachment content usually consists of a <strong>content-id</strong> a <strong>content-type</strong> and the actual content as plain text or binary content. Inside the test case you can use external file resources or inline CDATA sections for the attachment content. As you are familiar with Citrus you may know this already from other actions.</p>
</div>
<div class="paragraph">
<p>Citrus will construct a SOAP message with the SOAP attachment. Currently only one attachment per message is supported.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="receive-soap-attachments">Receive SOAP attachments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Citrus calls SOAP WebServices as a client we may receive SOAP responses with attachments. The tester can validate those received SOAP messages with attachment content quite easy. As usual let us have a look at an example first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapMessageWithAttachmentRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Operation&gt;</span>Read the attachment<span class="tag">&lt;/Operation&gt;</span>
            <span class="tag">&lt;/SoapMessageWithAttachmentRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapAttachment</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/ws/soapAttachment.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we use the Citrus SOAP extension namespace with the specific receive action that is aware of SOAP attachment validation. The tester can validate the <strong>content-id</strong>, the <strong>content-type</strong> and the attachment content. Instead of using the external file resource you could also define an expected attachment template directly in the test case as inline CDATA section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>ws:attachment</strong> element specifies a validator instance. This validator determines how to validate the attachment content. SOAP attachments are not limited to XML content. Plain text content and binary content is possible, too. So each SOAP attachment validating action can use a different <strong><em>SoapAttachmentValidator</em></strong> instance which is responsible for validating and comparing received attachments to expected template attachments. In the Citrus configuration the validator is set as normal Spring bean with the respective identifier.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapAttachmentValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySoapAttachmentValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.company.ws.validation.MySoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define several validator instances in the Citrus configuration. The validator with the general id <strong>"soapAttachmentValidator"</strong> is the default validator for all actions that do not explicitly set a validator instance. Citrus offers a set of reference validator implementations. The <strong><em>SimpleSoapAttachmentValidator</em></strong> will use a simple plain text comparison. Of course you are able to add individual validator implementations, too.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-mtom-support">SOAP MTOM support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MTOM (Message Transmission Optimization Mechanism) enables you to send and receive large SOAP message content using streamed data handlers. This optimizes the resource allocation on server and client side where not all data is loaded into memory when marshalling/unmarshalling the message payload data. In detail MTOM enabled messages do have a XOP package inside the message payload replacing the actual large content data. The content is then streamed aas separate attachment. Server and client can operate with a data handler providing access to the streamed content. This is very helpful when using large binary content inside a SOAP message for instance.</p>
</div>
<div class="paragraph">
<p>Citrus is able to both send and receive MTOM enabled SOAP messages on client and server. Just use the <strong>mtom-enabled</strong> flag when sending a SOAP message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMtomClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mtom-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;image:addImage xmlns:image=&quot;http://www.citrusframework.org/imageService/&quot;&gt;
          &lt;image&gt;cid:IMAGE&lt;/image&gt;
        &lt;/image:addImage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/hugeImageData.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the example above sends a SOAP message that contains a large binary image content. The actual binary image data is referenced with a content id marker <strong>cid:IMAGE</strong> inside the message payload. The actual image content is added as attachment with a separate file resource. Important is here the <strong>content-id</strong> which matches the id marker in the SOAP message payload (<strong>IMAGE</strong>).</p>
</div>
<div class="paragraph">
<p>Citrus builds a proper SOAP MTOM enabled message automatically adding the XOP package inside the message. The binary data is sent as separate SOAP attachment accordingly. The resulting SOAP message looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;SOAP-ENV:Header&gt;</span><span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
  <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
    <span class="tag">&lt;image:addImage</span> <span class="attribute-name">xmlns:image</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/imageService/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;image&gt;</span><span class="tag">&lt;xop:Include</span> <span class="attribute-name">xmlns:xop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2004/08/xop/include</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cid:IMAGE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;/image:addImage&gt;</span>
  <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the server side Citrus is also able to handle MTOM enabled SOAP messages. In a server receive action you can specify the MTOM SOAP attachment content as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMtomServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mtom-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;image:addImage xmlns:image=&quot;http://www.citrusframework.org/imageService/&quot;&gt;
          &lt;image&gt;&lt;xop:Include xmlns:xop=&quot;http://www.w3.org/2004/08/xop/include&quot; href=&quot;cid:IMAGE&quot;/&gt;&lt;/image&gt;
        &lt;/image:addImage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/hugeImageData.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We define the MTOM attachment content as separate SOAP attachment. The <strong>content-id</strong> is referenced somewhere in the SOAP message payload data. At runtime Citrus will add the XOP package definition automatically and perform validation on the message and its streamed MTOM attachment data.</p>
</div>
<div class="paragraph">
<p>Next thing that we have to talk about is inline MTOM data. This means that the content should be added as either <strong>base64Binary</strong> or <strong>hexBinary</strong> encoded String data directly to the message content. See the following example that uses the <strong>mtom-inline</strong> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMtomClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mtom-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;image:addImage xmlns:image=&quot;http://www.citrusframework.org/imageService/&quot;&gt;
          &lt;image&gt;cid:IMAGE&lt;/image&gt;
          &lt;icon&gt;cid:ICON&lt;/icon&gt;
        &lt;/image:addImage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">mtom-inline</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">encoding-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">base64Binary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/image.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ICON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">mtom-inline</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">encoding-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hexBinary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/icon.ico</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines two inline MTOM attachments. The first attachment <strong>cid:IMAGE</strong> uses the encoding type <strong>base64Binary</strong> which is the default. The second attachment <strong>cid:ICON</strong> uses <strong>hexBinary</strong> encoding. Both attachments are added as inline data before the message is sent. The final SOAP message looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;SOAP-ENV:Header&gt;</span><span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
  <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
    <span class="tag">&lt;image:addImage</span> <span class="attribute-name">xmlns:image</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/imageService/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;image&gt;</span>VGhpcyBpcyBhIGJpbmFyeSBpbWFnZSBhdHRhY2htZW50IQpWYXJpYWJsZXMgJXt0ZXN0fSBzaG91bGQgbm90IGJlIHJlcGxhY2VkIQ==<span class="tag">&lt;/image&gt;</span>
      <span class="tag">&lt;icon&gt;</span>5468697320697320612062696E6172792069636F6E206174746163686D656E74210A5661726961626C657320257B746573747D2073686F756C64206E6F74206265207265706C6163656421<span class="tag">&lt;/icon&gt;</span>
    <span class="tag">&lt;/image:addImage&gt;</span>
  <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The image content is a base64Binary String and the icon a heyBinary String. Of course this mechanism also is supported in receive actions on the server side where the expected message content is added als inline MTOM data before validation takes place.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-client-basic-authentication">SOAP client basic authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a SOAP client you may have to use basic authentication in order to access a server resource. Basic authentication via HTTP stands for username/password authentication where the credentials are transmitted in the HTTP request header section as base64 encoded entry. As Citrus uses the Spring WebService stack we can use the basic authentication support there. We set the user credentials on the HttpClient message sender which is used inside the Spring <strong><em>WebServiceTemplate</em></strong> .</p>
</div>
<div class="paragraph">
<p>Citrus provides a comfortable way to set the HTTP message sender with basic authentication credentials on the <strong><em>WebServiceTemplate</em></strong> . Just see the following example and learn how to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">message-sender</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthClient</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.transport.http.HttpComponentsMessageSender</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.AuthScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8090</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basic</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.UsernamePasswordCredentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someUsername</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somePassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration results in SOAP requests with authentication headers properly set for basic authentication. The special message sender takes care on adding the proper basic authentication header to each request that is sent with this Citrus message sender. By default preemptive authentication is used. The message sender only sends a single request to the server with all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope so Citrus can setup an authentication cache within the HTTP context in order to have preemptive authentication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also skip the message sender configuration and set the <strong>Authorization</strong> header on each request in your send action definition on your own. Be aware of setting the header as HTTP mime header using the correct prefix and take care on using the correct basic authentication with base64 encoding for the <strong>username:password</strong> phrase.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_Authorization</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For base64 encoding you can also use a Citrus function, see <a href="#functions-encode-base64">functions-encode-base64</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-server-basic-authentication">SOAP server basic authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When providing SOAP WebService server functionality Citrus can also set basic authentication so all clients need to authenticate properly when accessing the server resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleSoapServer</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">security-handler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicSecurityHandler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securityHandler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.security.SecurityHandlerFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.security.User</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">constraints</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/foo/*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.security.BasicAuthConstraint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/entry&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have set a security handler on the server web container with a constraint on all resources with <code>/foo/*</code>. Following from that the server requires basic authentication for these resources. The granted users and roles are specified within the security handler bean definition. Connecting clients have to set the basic auth HTTP header properly using the correct user and role for accessing the Citrus server now.</p>
</div>
<div class="paragraph">
<p>You can customize the security handler for your very specific needs (e.g. load users and roles with JDBC from a database). Just have a look at the code base and inspect the settings and properties offered by the security handler interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This mechanism is not restricted to basic authentication only. With other settings you can also set up digest or form-based authentication constraints very easy.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ws-addressing-support">WS-Addressing support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The web service stack offers a lot of different technologies and standards within the context of SOAP WebServices. We speak of WS-* specifications in particular. One of these specifications deals with addressing. On client side you may add wsa header information to the request in order to give the server instructions how to deal with SOAP faults for instance.</p>
</div>
<div class="paragraph">
<p>In Citrus WebService client you can add those header information using the common configuration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">message-converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.message.converter.WsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor-arg&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressing200408</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.addressing.WsAddressingHeaders</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERSION200408</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.core.EndpointReference</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/client</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replyTo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.core.EndpointReference</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/client</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">faultTo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.core.EndpointReference</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/fault/resolver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/constructor-arg&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The WsAddressing header values will be used for all request messages that are sent with the soap client component <em>soapClient</em>. You can overwrite the WsAddressing
header in each send test action in your test though. Just set the special WsAddressing message header on your request. You can use the following message header names in
order to overwrite the default addressing headers specified in the message converter configuration (also see the class <em>com.consol.citrus.ws.addressing.WsAddressingMessageHeaders</em>).</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_messageId
</td>
<td class="hdlist2">
<p>addressing message id as URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_from
</td>
<td class="hdlist2">
<p>addressing from endpoint reference as URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_to
</td>
<td class="hdlist2">
<p>addressing to URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_action
</td>
<td class="hdlist2">
<p>addressing action URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_replyTo
</td>
<td class="hdlist2">
<p>addressing reply to endpoint reference as URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_faultTo
</td>
<td class="hdlist2">
<p>addressing fault to endpoint reference as URI</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using this message headers you are able to explicitly overwrite the WsAddressing headers. Test variables are supported of course when specifying the values. Most of the values
are parsed to a URI value at the end so please make sure to use correct URI String representations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The WS-Addressing specification knows several versions. Supported version are:
</td>
</tr>
</table>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
VERSION10
</td>
<td class="hdlist2">
<p>WS-Addressing 1.0 May 2006</p>
</td>
</tr>
<tr>
<td class="hdlist1">
VERSION200408
</td>
<td class="hdlist2">
<p>August 2004 edition of the WS-Addressing specification</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The addressing headers find a place in the SOAP message header with respective namespaces and values. A possible SOAP request with WS addressing headers looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Header</span> <span class="attribute-name">xmlns:wsa</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/ws/2004/08/addressing</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;wsa:To</span> <span class="attribute-name">SOAP-ENV:mustUnderstand</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://citrus.sample/server<span class="tag">&lt;/wsa:To&gt;</span>
        <span class="tag">&lt;wsa:From&gt;</span>
            <span class="tag">&lt;wsa:Address&gt;</span>http://citrus.sample/client<span class="tag">&lt;/wsa:Address&gt;</span>
        <span class="tag">&lt;/wsa:From&gt;</span>
        <span class="tag">&lt;wsa:ReplyTo&gt;</span>
            <span class="tag">&lt;wsa:Address&gt;</span>http://citrus.sample/client<span class="tag">&lt;/wsa:Address&gt;</span>
        <span class="tag">&lt;/wsa:ReplyTo&gt;</span>
        <span class="tag">&lt;wsa:FaultTo&gt;</span>
            <span class="tag">&lt;wsa:Address&gt;</span>http://citrus.sample/fault/resolver<span class="tag">&lt;/wsa:Address&gt;</span>
        <span class="tag">&lt;/wsa:FaultTo&gt;</span>
        <span class="tag">&lt;wsa:Action&gt;</span>http://citrus.sample/sayHello<span class="tag">&lt;/wsa:Action&gt;</span>
        <span class="tag">&lt;wsa:MessageID&gt;</span>urn:uuid:4c4d8af2-b402-4bc0-a2e3-ad33b910e394<span class="tag">&lt;/wsa:MessageID&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;cit:HelloRequest</span> <span class="attribute-name">xmlns:cit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus/sample/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;cit:Text&gt;</span>Hello Citrus!<span class="tag">&lt;/cit:Text&gt;</span>
        <span class="tag">&lt;/cit:HelloRequest&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default when not set explicitly on the message headers the WsAddressing message id property is automatically generated for each request. You can set the message id generation strategy in the Spring application context message converter configuration:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.message.converter.WsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageIdStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.messageid.UuidMessageIdStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the strategy will create a new Java UUID for each request. The strategy also uses a common resource name prefix <em>urn:uuid:</em>. You can overwrite the message id
any time for each request explicitly by setting the message header <em>citrus_soap_ws_addressing_messageId</em> with a respective value on the message in your test.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-client-fork-mode">SOAP client fork mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOAP over HTTP uses synchronous communication by nature. This means that sending a SOAP message in Citrus over HTTP will automatically block further test actions until the synchronous HTTP response has been received. In test cases this synchronous blocking might cause problems for several reasons. A simple reason would be that you need to do further test actions in parallel to the synchronous HTTP SOAP communication (e.g. simulate another backend system in the test case).</p>
</div>
<div class="paragraph">
<p>You can separate the SOAP send action from the rest of the test case by using the <strong>"fork"</strong> mode. The SOAP client will automatically open a new Java Thread for the synchronous communication and the test is able to continue with execution although the synchronous HTTP SOAP response has not arrived yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;SoapRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;Operation&gt;</span>Read the attachment<span class="tag">&lt;/Operation&gt;</span>
        <span class="tag">&lt;/SoapRequest&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <strong>"fork"</strong> mode enabled the test continues with execution while the sending action waits for the synchronous response in a separate Java Thread. You could reach the same behaviour with a complex &lt;parallel&gt;/&lt;sequential&gt; container construct, but forking the send action is much more straight forward.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is highly recommended to use a proper <strong>"timeout"</strong> setting on the SOAP receive action when using fork mode. The forked send operation might take some time and the corresponding receive action might run into failure as the response was has not been received yet. The result would be a broken test because of the missing response message. A proper <strong>"timeout"</strong> setting for the receive action solves this problem as the action waits for this time period and occasionally repeatedly asks for the SOAP response message. The following listing sets the receive timeout to 10 seconds, so the action waits for the forked send action to deliver the SOAP response in time.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;SoapResponse</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;Operation&gt;</span>Did something<span class="tag">&lt;/Operation&gt;</span>
          <span class="tag">&lt;Success&gt;</span>true<span class="tag">&lt;/Success&gt;</span>
        <span class="tag">&lt;/SoapResponse&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-servlet-context-customization">SOAP servlet context customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For highly customized SOAP server components in Citrus you can define a full servlet context configuration file. Here you have the full power to add Spring endpoint mappings and custom endpoint implementations. You can set the custom servlet context as external file resource on the server component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">context-config-location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus-ws-servlet.xml</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap11MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let us have a closer look at the context-config-location attribute. This configuration defines the Spring application context file for endpoints, request mappings and other SpringWS specific information. Please see the official SpringWS documentation for details on this Spring based configuration. You can also just copy the following example application context which should work for you in general.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loggingInterceptor</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.server.endpoint.interceptor.PayloadLoggingInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;description&gt;</span>
          This interceptor logs the message payload.
      <span class="tag">&lt;/description&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServicePayloadMapping</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.server.endpoint.mapping.PayloadRootQNameEndpointMapping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;props&gt;</span>
              <span class="tag">&lt;prop</span>
                  <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/sayHello}HelloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                  helloServiceEndpoint
              <span class="tag">&lt;/prop&gt;</span>
          <span class="tag">&lt;/props&gt;</span>
      <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;list&gt;</span>
              <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loggingInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/list&gt;</span>
      <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.server.WebServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpointAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">staticResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <span class="tag">&lt;citrus:static-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">staticResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus:payload&gt;</span>
          <span class="inline-delimiter">&lt;![CDATA[</span>
              &lt;HelloResponse xmlns=&quot;http://www.consol.de/schemas/sayHello&quot;&gt;
                  &lt;MessageId&gt;123456789&lt;/MessageId&gt;
                  &lt;CorrelationId&gt;CORR123456789&lt;/CorrelationId&gt;
                  &lt;User&gt;WebServer&lt;/User&gt;
                  &lt;Text&gt;Hello User&lt;/Text&gt;
              &lt;/HelloResponse&gt;
          <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/citrus:payload&gt;</span>
      <span class="tag">&lt;citrus:header&gt;</span>
          <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Operation</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Request</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/citrus:header&gt;</span>
  <span class="tag">&lt;/citrus:static-response-adapter&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The program listing above describes a normal SpringWS request mapping with endpoint configurations. The mapping is responsible to forward incoming requests to the endpoint which will handle the request and provide a proper response message. First of all we add a logging interceptor to the context so all incoming requests get logged to the console first. Then we use a payload mapping (PayloadRootQNameEndpointMapping) in order to map all incoming <strong><em>'HelloRequest'</em></strong> SOAP messages to the <strong><em>'helloServiceEndpoint'</em></strong> . Endpoints are of essential nature in Citrus SOAP WebServices implementation. They are responsible for processing a request in order to provide a proper response message that is sent back to the calling client. Citrus uses the endpoint in combination with a message endpoint adapter implementation.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_009.jpg" alt="figure_009.jpg"></span></p>
</div>
<div class="paragraph">
<p>The endpoint works together with the message endpoint adapter that is responsible for providing a response message for the client. The various message endpoint adapter implementations in Citrus were already discussed in <a href="#endpoint-adapter">endpoint-adapter</a>.</p>
</div>
<div class="paragraph">
<p>In this example the <strong><em>'helloServiceEndpoint'</em></strong> uses the <strong><em>'static-response-adapter'</em></strong> which is always returning a static response message. In most cases static responses will not fit the test scenario and you will have to respond more dynamically.</p>
</div>
<div class="paragraph">
<p>Regardless of which message endpoint adapter setup you are using in your test case the endpoint transforms the response into a proper SOAP message. You can add as many request mappings and endpoints as you want to the server context configuration. So you are able to handle different request types with one single Jetty server instance.</p>
</div>
<div class="paragraph">
<p>That&#8217;s it for connecting with SOAP WebServices! We saw how to send and receive SOAP messages with Jetty and Spring WebServices. Have a look at the samples coming with your Citrus archive in order to learn more about the SOAP message handling.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-05 17:41:31 MESZ
</div>
</div>
</body>
</html>