<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Test actions</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="actions" class="article toc2 toc-left">
<div id="header">
<h1>Test actions</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#actions-send">Sending messages</a></li>
<li><a href="#actions-receive">Receive messages</a>
<ul class="sectlevel2">
<li><a href="#validate-message-payloads">Validate message payloads</a></li>
<li><a href="#validate-message-headers">Validate message headers</a></li>
<li><a href="#message-selectors">Message selectors</a></li>
<li><a href="#groovy-markupbuilder">Groovy MarkupBuilder</a></li>
</ul>
</li>
<li><a href="#actions-database">Database actions</a>
<ul class="sectlevel2">
<li><a href="#sql-update-insert-delete">SQL update, insert, delete</a></li>
<li><a href="#sql-query">SQL query</a></li>
<li><a href="#transaction-management">Transaction management</a></li>
<li><a href="#groovy-sql-result-set-validation">Groovy SQL result set validation</a></li>
<li><a href="#save-result-set-values">Save result set values</a></li>
</ul>
</li>
<li><a href="#actions-sleep">Sleep</a></li>
<li><a href="#actions-java">Java</a></li>
<li><a href="#actions-receive-timeout">Receive timeout</a></li>
<li><a href="#echo">Echo</a></li>
<li><a href="#actions-stop-time">Stop time</a></li>
<li><a href="#actions-create-variables">Create variables</a></li>
<li><a href="#actions-trace-variables">Trace variables</a></li>
<li><a href="#actions-transform">Transform</a></li>
<li><a href="#actions-groovy">Groovy script execution</a></li>
<li><a href="#actions-fail">Failing the test</a></li>
<li><a href="#actions-input">Input</a></li>
<li><a href="#actions-load">Load</a></li>
<li><a href="#actions-wait">Wait</a></li>
<li><a href="#actions-purging-jms-destinations">Purging JMS destinations</a></li>
<li><a href="#actions-purging-message-channels">Purging message channels</a></li>
<li><a href="#actions-purging-endpoints">Purging endpoints</a></li>
<li><a href="#actions-assert-failure">Assert failure</a></li>
<li><a href="#actions-catch-exceptions">Catch exceptions</a></li>
<li><a href="#actions-ant-build">Apache Ant build</a></li>
<li><a href="#actions-start-stop">Start/Stop server</a></li>
<li><a href="#actions-stop-timer">Stop Timer</a></li>
<li><a href="#actions-custom">Custom test actions</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This chapter gives a brief description to all test actions that a tester can incorporate into the test case. Besides sending
and receiving messages the tester may access these actions in order to build a more complex test scenario that fits the desired use case.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-send">Sending messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a integration test scenario we want to trigger processes and call interface services on the system under test. In order to do this we need to be able to send messages to various message transports. Therefore the send message test action in Citrus is one of the most important test actions. First of all let us have a look at the Citrus message definition in Citrus:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_001.jpg" alt="figure_001.jpg"></span></p>
</div>
<div class="paragraph">
<p>A message consists of a message header (name-value pairs) and a message payload. Later in this section we will see different ways of constructing a message with payload and header values. But first of all let&#8217;s concentrate on a simple sending message action inside a test case.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;description&gt;</span>Basic send message example<span class="tag">&lt;/description&gt;</span>

    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mx1x123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>

    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;TestMessage&gt;</span>
                        <span class="tag">&lt;Text&gt;</span>${text}<span class="tag">&lt;/Text&gt;</span>
                    <span class="tag">&lt;/TestMessage&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;header&gt;</span>
                <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/header&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message name is optional and defines the message identifier in the local message store. This message name is very useful when accessing the message content later on during the test case. The local message store is handled per test case and contains all exchanged messages.
The sample uses both header and payload as message parts to send. In both parts you can use variable definitions (see <strong>${text}</strong> and <strong>${messageId}</strong>). So first of all let us recap what variables do. Test variables are defined at the very beginning of the test case and are valid throughout all actions that take place in the test. This means that actions can simply reference a variable by the expression <strong><em>${variable-name}</em></strong> .</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use variables wherever you can! At least the important entities of a test should be defined as variables at the beginning. The test case improves maintainability and flexibility when using variables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now lets have a closer look at the sending action. The <strong>'endpoint'</strong> attribute might catch your attention first. This attribute references a message endpoint in Citrus configuration by name. As previously mentioned the message endpoint definition lives in a separate configuration file and contains the actual message transport settings. In this example the <strong>"helloServiceEndpoint"</strong> is referenced which is a message endpoint for sending out messages via JMS or HTTP for instance.</p>
</div>
<div class="paragraph">
<p>The test case is not aware of any transport details, because it does not have to. The advantages are obvious: On the one hand multiple test cases can reference the message endpoint definition for better reuse. Secondly test cases are independent of message transport details. So connection factories, user credentials, endpoint uri values and so on are not present in the test case.</p>
</div>
<div class="paragraph">
<p>In other words the <strong>"endpoint"</strong> attribute of the <code>&lt;send&gt;</code> element specifies which message endpoint definition to use and therefore where the message should go to. Once again all available message endpoints are configured in a separate Citrus configuration file. We will come to this later on. Be sure to always pick the right message endpoint type in order to publish your message to the right destination.</p>
</div>
<div class="paragraph">
<p>If you do not like the XML language you can also use pure Java code to define the same test. In Java you would also make use of the message endpoint definition and reference this instance. The same test as shown above in Java DSL looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.ITestContext</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SendMessageTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
        description(<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic send message example</span><span class="delimiter">&quot;</span></span>);

        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">messageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mx1x123456789</span><span class="delimiter">&quot;</span></span>);

        send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestTag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.ITestContext</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestRunner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SendMessageTestRunner</span> <span class="directive">extends</span> TestNGCitrusTestRunner {

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">messageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mx1x123456789</span><span class="delimiter">&quot;</span></span>);

        send(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestTag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using the XML tags for send we use methods from <strong>TestNGCitrusTestDesigner</strong> class. The same message endpoint is referenced within the send message action.</p>
</div>
<div class="paragraph">
<p>Now that the message sender pattern is clear we can concentrate on how to specify the message content to be sent. There are several possibilities for you to define message content in Citrus:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>This element constructs the message to be sent. There are several child elements available:</p>
</td>
</tr>
<tr>
<td class="hdlist1">
payload
</td>
<td class="hdlist2">
<p>Nested XML payload as direct child node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
data
</td>
<td class="hdlist2">
<p>Inline CDATA definition of the message payload</p>
</td>
</tr>
<tr>
<td class="hdlist1">
resource
</td>
<td class="hdlist2">
<p>External file resource holding the message payload The syntax would be: <code>&lt;resource file=&quot;classpath:com/consol/citrus/messages/TestRequest.xml&quot; /&gt;</code> The file path prefix indicates the resource type, so the file location is resolved either as file system resource (file:) or classpath resource (classpath:).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
element
</td>
<td class="hdlist2">
<p>Explicitly overwrite values in the XML message payload using XPath. You can replace message content with dynamic values before sending. Each &lt;element&gt; entry provides a "path" and "value" attribute. The "path" gives a XPath expression evaluating to a XML node element or attribute in the message. The "value" can be a variable expression or any other static value. Citrus will replace the value before sending the message.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
header
</td>
<td class="hdlist2">
<p>Defines a header for the message (e.g. JMS header information or SOAP header):</p>
</td>
</tr>
<tr>
<td class="hdlist1">
element
</td>
<td class="hdlist2">
<p>Each header receives a "name" and "value". The "name" will be the name of the header entry and "value" its respective value. Again the usage of variable expressions as value is supported here, too.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="comment">&lt;!-- message payload as XML --&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;!-- message payload as XML --&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important thing when dealing with sending actions is to prepare the message payload and header. You are able to construct the message payload either by nested XML child nodes (payload), as inline CDATA (&lt;data&gt;) or external file (&lt;resource&gt;).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes the nested XML message payload elements may cause XSD schema validation rule violations. This is because of variable values not fitting the XSD schema rules for example. In this scenario you could also use simple CDATA sections as payload data. In this case you need to use the <strong><em>`&lt;data&gt;`</em></strong> element in contrast to the <strong><em>`&lt;payload&gt;`</em></strong> element that we have used in our examples so far.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this alternative you can skip the XML schema validation from your IDE at design time. Unfortunately you will loose the XSD auto completion features many XML editors offer when constructing your payload.</p>
</div>
<div class="paragraph">
<p>The The same possibilities apply to the Citrus Java DSL.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .message(<span class="keyword">new</span> DefaultMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides defining message payloads as normal Strings and via external file resource (classpath and file system) you can also use model objects as payload data in Java DSL. This model object payload requires a proper message marshaller that should be available as Spring bean inside the application context. By default Citrus is searching for a bean of type <strong>org.springframework.oxm.Marshaller</strong> .</p>
</div>
<div class="paragraph">
<p>In case you have multiple message marshallers in the application context you have to tell Citrus which one to use in this particular send message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageMarshallerBean</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus will marshal the message payload with the message marshaller bean named <strong>myMessageMarshallerBean</strong> . This way you can have multiple message marshaller implementations active in your project (XML, JSON, and so on).</p>
</div>
<div class="paragraph">
<p>Last not least the message can be defined as Citrus message object. Here you can choose one of the different message implementations used in Citrus for SOAP, Http or JMS messages. Or you just use the default message implementation or maybe a custom implementation.</p>
</div>
<div class="paragraph">
<p>Before sending takes place you can explicitly overwrite some message values in payload. You can think of overwriting specific message elements with variable values. Also you can overwrite values using XPath (<a href="#xpath">xpath</a>) or JSONPath (<a href="json-path">json-path</a>) expressions.</p>
</div>
<div class="paragraph">
<p>The message header is part of our duty of defining proper messages, too. So Citrus uses name-value pairs like "Operation" and "MessageId" in the next example to set message header entries. Depending on what message endpoint is used and which message transport underneath the header values will be shipped in different ways. In JMS the headers go to the header section of the message, in Http we set mime headers accordingly, in SOAP we can access the SOAP header elements and so on. Citrus aims to do the hard work for you. So Citrus knows how to set headers on different message transports.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message headers to send are defined by a simple name and value pair. Of course you can use test variables in header values as well. Let&#8217;s see how this looks like in Java DSL:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is basically how to send messages in Citrus. The test case is responsible for constructing the message content while the predefined message endpoint holds transport specific settings. Test cases reference endpoint components to publish messages to the outside world. The variable support in message payload and message header enables you to add dynamic values before sending out the message.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-receive">Receive messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just like sending messages the receiving part is a very important action in an integration test. Honestly the receive action is even more important in Citrus as we also want to validate the incoming message contents. We are writing a test so we also need assertions and checks that everything works as expected.</p>
</div>
<div class="paragraph">
<p>As already mentioned before a message consists of a message header (name-value pairs) and a message payload. Later in this document we will see how to validate incoming messages with payload and header values. We start with a very simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>${text}<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Overall the receive message action looks quite similar to the send message action. Concepts are identical as we define the message content with payload and header values. The message name is optional and defines the message identifier in the local message store.
This message name is very useful when accessing the message content later on during the test case. The local message store is handled per test case and contains all exchanged messages.</p>
</div>
<div class="paragraph">
<p>We can use test variables in both message payload an headers. Now let us have a look at the Java DSL representation of this simple example:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The receive action waits for a message to arrive. The whole test execution is stopped while waiting for the message. This is important to ensure the step by step test workflow processing. Of course you can specify message timeouts so the receiver will only wait a given amount of time before raising a timeout error. Following from that timeout exception the test case fails as the message did not arrive in time. Citrus defines default timeout settings for all message receiving tasks.</p>
</div>
<div class="paragraph">
<p>In a good case scenario the message arrives in time and the content can be validated as a next step. This validation can be done in various ways. On the one hand you can specify a whole XML message that you expect as control template. In this case the received message structure is compared to the expected message content element by element. On the other hand you can use explicit element validation where only a small subset of message elements is included into validation.</p>
</div>
<div class="paragraph">
<p>Besides the message payload Citrus will also perform validation on the received message header values. Test variable usage is supported as usual during the whole validation process for payload and header checks.</p>
</div>
<div class="paragraph">
<p>In general the validation component (validator) in Citrus works hand in hand with a message receiving component as the following figure shows:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_005.jpg" alt="figure_005.jpg"></span></p>
</div>
<div class="paragraph">
<p>The message receiving component passes the message to the validator where the individual validation steps are performed. Let us have a closer look at the validation options and features step by step.</p>
</div>
<div class="sect2">
<h3 id="validate-message-payloads">Validate message payloads</h3>
<div class="paragraph">
<p>The most detailed validation of incoming messages is to define some expected message payload. The Citrus message validator will then perform a detailed message payload comparison. The incoming message has to match exactly to the expected message payload. The different message validator implementations in Citrus provide deep comparison of message structures such as XML, JSON and so on.</p>
</div>
<div class="paragraph">
<p>So by defining an expected message payload we validate the incoming message in syntax and semantics. In case a difference is identified by the message validator the validation and the test case fails with respective exceptions. This is how you can define message payloads in receive action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;payload&gt;</span>
    <span class="comment">&lt;!-- message payload as XML --&gt;</span>
  <span class="tag">&lt;/payload&gt;</span>
<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;!-- message payload as XML --&gt;
      <span class="inline-delimiter">]]&gt;</span>
  <span class="tag">&lt;/data&gt;</span>
<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The three examples above represent three different ways of defining the message payload in a receive message action. On the one hand we can use inline message payloads as nested XML or CDATA sections in the test. On the other hand we can load the message content from external file resource.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes the nested XML message payload elements may cause XSD schema validation rule violations. This is because of variable values not fitting the XSD schema rules for example. In this scenario you could also use simple CDATA sections as payload data. In this case you need to use the <strong><em>`&lt;data&gt;`</em></strong> element in contrast to the <strong><em>`&lt;payload&gt;`</em></strong> element that we have used in our examples so far.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this alternative you can skip the XML schema validation from your IDE at design time. Unfortunately you will loose the XSD auto completion features many XML editors offer when constructing your payload.</p>
</div>
<div class="paragraph">
<p>In Java DSL we also have multiple options for specifying the message payloads:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .message(<span class="keyword">new</span> DefaultMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples above represent the basic variations of how to define message payloads in Citrus Java DSL. The payload can be a simple String or a Spring file resource (classpath or file system). In addition to that we can use a model object. When using model objects as payloads we need a proper message marshaller implementation in the Spring application context. By default this is a marshaller bean of type <strong>org.springframework.oxm.Marshaller</strong> that has to be present in the Spring application context. You can add such a bean for XML and JSON message marshalling for instance.</p>
</div>
<div class="paragraph">
<p>In case you have multiple message marshallers in the application context you have to tell Citrus which one to use in this particular send message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageMarshallerBean</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus will marshal the message payload with the message marshaller bean named <strong>myMessageMarshallerBean</strong> . This way you can have multiple message marshaller implementations active in your project (XML, JSON, and so on).</p>
</div>
<div class="paragraph">
<p>Last not least the message can be defined as Citrus message object. Here you can choose one of the different message implementations used in Citrus for SOAP, Http or JMS messages. Or you just use the default message implementation or maybe a custom implementation.</p>
</div>
<div class="paragraph">
<p>In general the expected message content can be manipulated using XPath (<a href="#xpath">xpath</a>) or JSONPath (<a href="#json-path">json-path</a>). In addition to that you can ignore some elements that are skipped in comparison. We will describe this later on in this section. Now lets continue with message header validation.</p>
</div>
</div>
<div class="sect2">
<h3 id="validate-message-headers">Validate message headers</h3>
<div class="paragraph">
<p>Message headers are used widely in enterprise messaging solution: The message headers are part of the message semantics and need to be validated, too. Citrus can validate message header by name and value.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;TestMessage&gt;</span>
            <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
        <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expected message headers are defined by a name and value pair. Citrus will check that the expected message header is present and will check the value. In case the message header is not found or the value does not match Citrus will raise an exception and the test fails. You can use validation matchers (<a href="#validation-matcher">validation-matcher</a>) for a more powerful validation of header values, too.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how this looks like in Java DSL:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Header definition in Java DSL is straight forward as we just define name and value as usual. This completes the message validation when receiving a message in Citrus. The message validator implementations may add additional validation capabilities such as XML schema validation or XPath and JSONPath validation. Please refer to the respective chapters in this guide to learn more about that.</p>
</div>
</div>
<div class="sect2">
<h3 id="message-selectors">Message selectors</h3>
<div class="paragraph">
<p>The <code>&lt;selector&gt;</code> element inside the receiving action defines key-value pairs in order to filter the messages being received. The filter applies to the message headers. This means that a receiver will only accept messages matching a header element value. In messaging applications the header information often holds message ids, correlation ids, operation names and so on. With this information given you can explicitly listen for messages that belong to your test case. This is very helpful to avoid receiving messages that are still available on the message destination.</p>
</div>
<div class="paragraph">
<p>Lets say the tested software application keeps sending messages that belong to previous test cases. This could happen in retry situations where the application error handling automatically tries to solve a communication problem that occurred during previous test cases. As a result a message destination (e.g. a JMS message queue) contains messages that are not valid any more for the currently running test case. The test case might fail because the received message does not apply to the actual use case. So we will definitely run into validation errors as the expected message control values do not match.</p>
</div>
<div class="paragraph">
<p>Now we have to find a way to avoid these problems. The test could filter the messages on a destination to only receive messages that apply for the use case that is being tested. The Java Messaging System (JMS) came up with a message header selector that will only accept messages that fit the expected header values.</p>
</div>
<div class="paragraph">
<p>Let us have a closer look at a message selector inside a receiving action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element&gt;</span> name=&quot;correlationId&quot; value=&quot;Cx1x123456789&quot;<span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element&gt;</span> name=&quot;operation&quot; value=&quot;getOrders&quot;<span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">testServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId='Cx1x123456789' AND operation='getOrders'</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">testServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId='Cx1x123456789' AND operation='getOrders'</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how message selectors work. The selector will only accept messages that meet the correlation id and the operation in the header values. All other messages on the message destination are ignored. The selector elements are automatically associated to each other using the logical AND operator. This means that the message selector string would look like this: <strong>correlationId = 'Cx1x123456789' AND operation = 'getOrders'</strong> .</p>
</div>
<div class="paragraph">
<p>Instead of using several elements in the selector you can also define a selector string directly which gives you more power in constructing the selection logic yourself. This way you can use <strong>AND</strong> logical operators yourself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;value&gt;</span>
        correlationId = 'Cx1x123456789' AND operation = 'getOrders'
    <span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In case you want to run tests in parallel message selectors become essential in your test cases. The different tests running at the same time will steal messages from each other when you lack of message selection mechanisms.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Previously only JMS message destinations offered support for message selectors! With Citrus version 1.2 we introduced message selector support for Spring Integration message channels, too (see <a href="#message-channel-selector-support">message-channel-selector-support</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="groovy-markupbuilder">Groovy MarkupBuilder</h3>
<div class="paragraph">
<p>With the Groovy MarkupBuilder you can build XML message payloads in a simple way, without having to write the typical XML overhead. For example we use a Groovy script to construct the XML message to be sent out. Instead of a plain CDATA XML section or the nested payload XML data we write a Groovy script snippet. The Groovy MarkupBuilder generates the XML message payload with exactly the same result:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;builder</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        markupBuilder.TestMessage {
                MessageId('${messageId}')
                Timestamp('?')
                VersionId('2')
                Text('Hello Citrus!')
            }
        }
    <span class="tag">&lt;/builder&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/Timestamp</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${createDate}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <strong>builder</strong> element with type <strong>groovy</strong> and the MarkupBuilder code is directly written to this element. As you can see from the example above, you can mix XPath and Groovy markup builder code. The MarkupBuilder syntax is very easy and follows the simple rule: <strong>markupBuilder.ROOT-ELEMENT{ CHILD-ELEMENTS }</strong> . However the tester has to follow some simple rules and naming conventions when using the Citrus MarkupBuilder extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The MarkupBuilder is accessed within the script over an object named markupBuilder. The name of the custom root element follows with all its child elements.</p>
</li>
<li>
<p>Child elements may be defined within curly brackets after the root-element (the same applies for further nested child elements)</p>
</li>
<li>
<p>Attributes and element values are defined within round brackets, after the element name</p>
</li>
<li>
<p>Attribute and element values have to stand within apostrophes (e.g. attribute-name: 'attribute-value')</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Groovy MarkupBuilder script may also be used within receive actions as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;builder</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/groovy/helloRequest.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;builder</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            markupBuilder.TestResponse(xmlns: 'http://www.consol.de/schemas/samples/sayHello.xsd'){
                MessageId('${messageId}')
                CorrelationId('${correlationId}')
                User('HelloService')
                Text('Hello ${user}')
            }
        <span class="tag">&lt;/builder&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see it is also possible to define the script as external file resource. In addition to that namespace support is given as normal attribute definition within the round brackets after the element name.</p>
</div>
<div class="paragraph">
<p>The MarkupBuilder implementation in Groovy offers great possibilities in defining message payloads. We do not need to write XML tag overhead and we can construct complex message payloads with Groovy logic like iterations and conditional elements. For detailed MarkupBuilder descriptions please see the official Groovy documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-database">Database actions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In many cases it is necessary to access the database during a test. This enables a tester to also validate the persistent
data in a database. It might also be helpful to prepare the database with some test data before running a test. You can do this
using the two database actions that are described in the following sections.</p>
</div>
<div class="paragraph">
<p>In general Citrus handles SELECT statements differently to other statements like INSERT, UPDATE and DELETE. When executing a SQL query with
SELECT you are able to add validation steps on the result sets returned from the database. This is not allowed when executing update statements like
INSERT, UPDATE, DELETE.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not mix statements of type <strong><em>SELECT</em></strong> with others in a single sql test action. This will lead to errors because validation steps are not valid
for statements other than SELECT. Please use separate test actions for update statements.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="sql-update-insert-delete">SQL update, insert, delete</h3>
<div class="paragraph">
<p>The &lt;sql&gt; action simply executes a group of SQL statements in order to change data in a database. Typically the action is used to prepare the database at the beginning of a test or to clean up the database at the end of a test. You can specify SQL statements like INSERT, UPDATE, DELETE, CREATE TABLE, ALTER TABLE and many more.</p>
</div>
<div class="paragraph">
<p>On the one hand you can specify the statements as inline SQL or stored in an external SQL resource file as shown in the next two examples.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM CUSTOMERS<span class="tag">&lt;/statement&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM ORDERS<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;/sql&gt;</span>

    <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/unit/resources/script.sql</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/sql&gt;</span>
<span class="tag">&lt;/actions&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sqlTest() {
    sql(dataSource)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM CUSTOMERS</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS</span><span class="delimiter">&quot;</span></span>);

    sql(dataSource)
        .sqlResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/unit/resources/script.sql</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sqlTest() {
    sql(action -&gt; action.dataSource(dataSource)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM CUSTOMERS</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS</span><span class="delimiter">&quot;</span></span>));

    sql(action -&gt; action.dataSource(dataSource)
        .sqlResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/unit/resources/script.sql</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first action uses inline SQL statements defined directly inside the test case. The next action uses an external SQL resource file instead. The file resource can hold several SQL statements separated by new lines. All statements inside the file are executed sequentially by the framework.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to pay attention to some rules when dealing with external SQL resources.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Each statement should begin in a new line</p>
</li>
<li>
<p>It is not allowed to define statements with word wrapping</p>
</li>
<li>
<p>Comments begin with two dashes "–"</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The external file is referenced either as file system resource or class path resource, by using the "file:" or "classpath:" prefix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both examples use the "datasource" attribute. This value defines the database data source to be used. The connection to a data source is mandatory, because the test case does not know about user credentials or database names. The 'datasource' attribute references predefined data sources that are located in a separate Spring configuration file.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-query">SQL query</h3>
<div class="paragraph">
<p>The &lt;sql&gt; query action is specially designed to execute SQL queries (SELECT * FROM). So the test is able to read data from a database. The query results are validated against expected data as shown in the next example.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select NAME from CUSTOMERS where ID='${customerId}'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select count(*) from ERRORS<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ID from ORDERS where DESC LIKE 'Def%'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select DESCRIPTION from ORDERS where ID='${id}'<span class="tag">&lt;/statement&gt;</span>

    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COUNT(*)</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${rowsCount}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">null</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> databaseQueryTest() {
    query(dataSource)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select NAME from CUSTOMERS where CUSTOMER_ID='${customerId}'</span><span class="delimiter">&quot;</span></span>)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select COUNT(1) as overall_cnt from ERRORS</span><span class="delimiter">&quot;</span></span>)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDER_ID from ORDERS where DESCRIPTION LIKE 'Migrate%'</span><span class="delimiter">&quot;</span></span>)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select DESCRIPTION from ORDERS where ORDER_ID = 2</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_ID</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">OVERALL_CNT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${rowsCount}</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">NULL</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> databaseQueryTest() {
    query(action -&gt; action.dataSource(dataSource)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select NAME from CUSTOMERS where CUSTOMER_ID='${customerId}'</span><span class="delimiter">&quot;</span></span>)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select COUNT(1) as overall_cnt from ERRORS</span><span class="delimiter">&quot;</span></span>)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDER_ID from ORDERS where DESCRIPTION LIKE 'Migrate%'</span><span class="delimiter">&quot;</span></span>)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select DESCRIPTION from ORDERS where ORDER_ID = 2</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_ID</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">OVERALL_CNT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${rowsCount}</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">NULL</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The action offers a wide range of validating functionality for database result sets. First of all you have to select the data via SQL statements. Here again you have the choice to use inline SQL statements or external file resource pattern.</p>
</div>
<div class="paragraph">
<p>The result sets are validated through &lt;validate&gt; elements. It is possible to do a detailed check on every selected column of the result set. Simply refer to the selected column name in order to validate its value. The usage of test variables is supported as well as database expressions like count(), avg(), min(), max().</p>
</div>
<div class="paragraph">
<p>You simply define the &lt;validate&gt; entry with the column name as the "column" attribute and any expected value expression as expected "value". The framework then will check the column to fit the expected value and raise validation errors in case of mismatch.</p>
</div>
<div class="paragraph">
<p>Looking at the first SELECT statement in the example you will see that test variables are supported in the SQL statements. The framework will replace the variable with its respective value before sending it to the database.</p>
</div>
<div class="paragraph">
<p>In the validation section variables can be used too. Look at the third validation entry, where the variable "${rowsCount}" is used. The last validation in this example shows, that <strong><em>NULL</em></strong> values are also supported as expected values.</p>
</div>
<div class="paragraph">
<p>If a single validation happens to fail, the whole action will fail with respective validation errors.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The validation with <strong><em>"&lt;validate column="&#8230;&#8203;" value="&#8230;&#8203;"/&gt;"</em></strong> meets single row result sets as you specify a single column control value. In case you have multiple rows in a result set you rather need to validate the columns with multiple control values like this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someColumnName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;values&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in 1st row<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in 2nd row<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in 3rd row<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in x row<span class="tag">&lt;/value&gt;</span>
      <span class="tag">&lt;/values&gt;</span>
  <span class="tag">&lt;/validate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Within Java you can pass a variable argument list to the validate method like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select NAME from WEEKDAYS where NAME LIKE 'S%'</span><span class="delimiter">&quot;</span></span>)
    .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Saturday</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sunday</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next example shows how to work with multiple row result sets and multiple values to expect within one column:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;statement&gt;</span>select WEEKDAY as DAY, DESCRIPTION from WEEK<span class="tag">&lt;/statement&gt;</span>
      <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DAY</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;values&gt;</span>
              <span class="tag">&lt;value&gt;</span>Monday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Tuesday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Wednesday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Thursday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Friday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/values&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
      <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;values&gt;</span>
              <span class="tag">&lt;value&gt;</span>I hate Mondays!<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Tuesday is sports day<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>The mid of the week<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Thursday we play chess<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Friday, the weekend is near!<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/values&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
  <span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the validation of multiple rows the <strong><em>`&lt;validate&gt;`</em></strong> element is able to host a list of control values for a column. As you can see from the example above, you have to add a control value for each row in the result set. This also means that we have to take care of the total number of rows. Fortunately we can use the ignore placeholder, in order to skip the validation of a specific row in the result set. Functions and variables are supported as usual.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is important, that the control values are defined in the correct order, because they are compared one on one with the actual result set coming from database query. You may need to add "order by" SQL expressions to get the right order of rows returned. If any of the values fails in validation or the total number of rows is not equal, the whole action will fail with respective validation errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="transaction-management">Transaction management</h3>
<div class="paragraph">
<p>By default no transactions are used when Citrus executes SQL statements on a datasource. You can enable transaction management by selecting a transaction manager.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someDataSource</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someTransactionManager</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">transaction-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">15000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">transaction-isolation-level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISOLATION_READ_COMMITTED</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM CUSTOMERS<span class="tag">&lt;/statement&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM ORDERS<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;/sql&gt;</span>
<span class="tag">&lt;/actions&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sqlTest() {
    sql(dataSource)
        .transactionManager(transactionManager)
        .transactionTimeout(<span class="integer">15000</span>)
        .transactionIsolationLevel(<span class="string"><span class="delimiter">&quot;</span><span class="content">ISOLATION_READ_COMMITTED</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM CUSTOMERS</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>transaction-manager</em> attribute references a Spring bean of type "<em>org.springframework.transaction.PlatformTransactionManager</em>". You can add this transaction manager to the Spring bean configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someTransactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The transaction isolation level as well as the transaction timeout get set on the transaction definition used during SQL statement execution. The isolation level should evaluate to one of the constants given in "<em>org.springframework.transaction.TransactionDefinition</em>". Valid isolation level are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ISOLATION_DEFAULT</p>
</li>
<li>
<p>ISOLATION_READ_UNCOMMITTED</p>
</li>
<li>
<p>ISOLATION_READ_COMMITTED</p>
</li>
<li>
<p>ISOLATION_REPEATABLE_READ</p>
</li>
<li>
<p>ISOLATION_SERIALIZABLE</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="groovy-sql-result-set-validation">Groovy SQL result set validation</h3>
<div class="paragraph">
<p>Groovy provides great support for accessing Java list objects and maps. As a Java SQL result set is nothing but a list of map representations, where each entry in the list defines a row in the result set and each map entry represents the columns and values. So with Groovy&#8217;s list and map access we have great possibilities to validate a SQL result set - out of the box.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ID from CUSTOMERS where NAME='${customerName}'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'<span class="tag">&lt;/statement&gt;</span>

    <span class="tag">&lt;validate-script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        assert rows.size() == 2
        assert rows[0].ID == '1'
        assert rows[1].STATUS == 'in progress'
        assert rows[1] == [ORDERTYPE:'SampleOrder', STATUS:'in progress']
    <span class="tag">&lt;/validate-script&gt;</span>
<span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .validateScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows.size == 2;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].ID == '1';</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].STATUS == 'in progress';</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(action -&gt; action.dataSource(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .validateScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows.size == 2;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].ID == '1';</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].STATUS == 'in progress';</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see Groovy provides fantastic access methods to the SQL result set. We can browse the result set with named column values and check the size of the result set. We are also able to search for an entry, iterate over the result set and have other helpful operations. For a detailed description of the list and map handling in Groovy my advice for you is to have a look at the official Groovy documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In general other script languages do also support this kind of list and map access. For now we just have implemented the Groovy script support, but the framework is ready to work with all other great script languages out there, too (e.g. Scala, Clojure, Fantom, etc.). So if you prefer to work with another language join and help us implement those features.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="save-result-set-values">Save result set values</h3>
<div class="paragraph">
<p>Now the validation of database entries is a very powerful feature but sometimes we simply do not know the persisted content values. The test may want to read database entries into test variables without validation. Citrus is able to do that with the following &lt;extract&gt; expressions:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ID from CUSTOMERS where NAME='${customerName}'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select STATUS from ORDERS where ID='${orderId}'<span class="tag">&lt;/statement&gt;</span>

    <span class="tag">&lt;extract</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${customerId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;extract</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${orderStatus}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .extract(<span class="string"><span class="delimiter">&quot;</span><span class="content">STATUS</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">orderStatus</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(action -&gt; action.dataSource(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .extract(<span class="string"><span class="delimiter">&quot;</span><span class="content">STATUS</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">orderStatus</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can save the database column values directly to test variables. Of course you can combine the value extraction with the normal column validation described earlier in this chapter. Please keep in mind that we can not use these operations on result sets with multiple rows. Citrus will always use the first row in a result set.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-sleep">Sleep</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This action shows how to make the test framework sleep for a given amount of time. The attribute 'time' defines the amount of time to wait in seconds. As shown in the next example decimal values are supported too. When no waiting time is specified the default time of 50000 milliseconds applies.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sleepTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sleepTest() {
    sleep(<span class="integer">500</span>); <span class="comment">// sleep 500 milliseconds</span>

    sleep(); <span class="comment">// sleep default time</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When should somebody use this action? To us this action was always very useful in case the test needed to wait until an application had done some work. For example in some cases the application took some time to write some data into the database. We waited then a small amount of time in order to avoid unnecessary test failures, because the test framework simply validated the database too early. Or as another example the test may wait a given time until retry mechanisms are triggered in the tested application and then proceed with the test actions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-java">Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The test framework is written in Java and runs inside a Java virtual machine. The functionality of calling other Java objects and methods in this same Java VM through Java Reflection is self-evident. With this action you can call any Java API available at runtime through the specified Java classpath.</p>
</div>
<div class="paragraph">
<p>The action syntax looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;java</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/constructor&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invoke</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String[]</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1,2<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span>

<span class="tag">&lt;java</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/constructor&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invoke</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span>

<span class="tag">&lt;java</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String[]</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4,Test,true <span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java class is specified by fully qualified class name. Constructor arguments are added using the &lt;constructor&gt; element with a list of &lt;argument&gt; child elements. The type of the argument is defined within the respective attribute "type". By default the type would be String.</p>
</div>
<div class="paragraph">
<p>The invoked method on the Java object is simply referenced by its name. Method arguments do not bring anything new after knowing the constructor argument definition, do they?.</p>
</div>
<div class="paragraph">
<p>Method arguments support data type conversion too, even string arrays (useful when calling CLIs). In the third action in the example code you can see that colon separated strings are automatically converted to string arrays.</p>
</div>
<div class="paragraph">
<p>Simple data types are defined by their name (int, boolean, float etc.). Be sure that the invoked method and class constructor fit your arguments and vice versa, otherwise you will cause errors at runtime.</p>
</div>
<div class="paragraph">
<p>Besides instantiating a fully new object instance for a class how about reusing a bean instance available in Spring bean container. Simply use the <strong>ref</strong> attribute and refer to an existing bean in Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;java</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invoke</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invocationDummy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method is invoked on the Spring bean instance. This is very useful as you can inject other objects (e.g. via Autowiring) to the Spring bean instance before method invocation in test takes place. This enables you to execute any Java logic inside a test case.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-receive-timeout">Receive timeout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases it might be necessary to validate that a message is <strong>not</strong> present on a destination. This means that this action expects a timeout when receiving a message from an endpoint destination. For instance the tester intends to ensure that no message is sent to a certain destination in a time period. In that case the timeout would not be a test aborting error but the expected behavior. And in contrast to the normal behavior when a message is received in the time period the test will fail with error.</p>
</div>
<div class="paragraph">
<p>In order to validate such a timeout situation the action &lt;expectTimout&gt; shall help. The usage is very simple as the following example shows:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">receiveJMSTimeoutTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;expect-timeout</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint myEndpoint;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(myEndpoint)
        .timeout(<span class="integer">500</span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint myEndpoint;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(action -&gt; action.endpoint(myEndpoint)
                    .timeout(<span class="integer">500</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The action offers two attributes:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
endpoint
</td>
<td class="hdlist2">
<p>Reference to a message endpoint that will try to receive messages.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
wait/timeout
</td>
<td class="hdlist2">
<p>Time period to wait for messages to arrive</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you may want to add some selector on the timeout receiving action. This way you can very selective check on a message to not be present on a message destination. This is possible with defining a message selector on the test action as follows.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;expect-timeout</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;select&gt;</span>MessageId='123456789'<span class="tag">&lt;select</span><span class="tag">/&gt;</span>
<span class="tag">&lt;expect-timeout</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(myEndpoint)
        .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId = '123456789'</span><span class="delimiter">&quot;</span></span>)
        .timeout(<span class="integer">500</span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(action -&gt; action.endpoint(myEndpoint)
                    .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId = '123456789'</span><span class="delimiter">&quot;</span></span>)
                    .timeout(<span class="integer">500</span>));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="echo">Echo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The &lt;echo&gt; action prints messages to the console/logger. This functionality is useful when debugging test runs. The property "message" defines the text that is printed. Tester might use it to print out debug messages and variables as shown the next code example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Hello Test Framework<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Current date is: ${date}<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> echoTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current date is: ${date}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Result on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Hello Test Framework
Current time is: 05.08.2008</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-stop-time">Stop time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Time measurement during a test can be very helpful. The &lt;trace-time&gt; action creates and monitors multiple time lines. The action offers the attribute <em>id</em> to identify a time line.
The tester can of course use more than one time line with different ids simultaneously.</p>
</div>
<div class="paragraph">
<p>Read the next example and you will understand the mix of different time lines:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">StopTimeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;trace-time</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span> <span class="content">time_line_id </span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span> <span class="content">time_line_id </span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> stopTimeTest() {
    stopTime();
    stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span>);
    sleep(<span class="float">3.5</span>); <span class="comment">// do something</span>
    stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span>);
    sleep(<span class="integer">5000</span>); <span class="comment">// do something</span>
    stopTime();
    stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test output looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Starting TimeWatcher:
Starting TimeWatcher: time_line_id
TimeWatcher time_line_id after 3500 milliseconds
TimeWatcher after 8500 seconds
TimeWatcher time_line_id after 8500 milliseconds</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Time line ids should not exist as test variables before the action is called for the first time. This would break the time line initialization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case no time line id is specified the framework will measure the time for a default time line. To print out the current elapsed time for a time line you simply have to place the
`&lt;trace-time&gt; action into the action chain again and again, using the respective time line identifier. The elapsed time will be printed out to the console every time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each time line is stored as test variable in the test case. By default you will have the following test variables set for each time line:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CITRUS_TIMELINE
</td>
<td class="hdlist2">
<p>first timestamp of time line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_TIMELINE_VALUE
</td>
<td class="hdlist2">
<p>latest time measurement value (time passed since first timestamp in milliseconds)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>According to your time line id you will get different test variable names. Also you can customize the time value suffix (default: <strong>_VALUE</strong>):</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suffix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_1st</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>
<span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suffix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_2nd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">_1st</span><span class="delimiter">&quot;</span></span>);
sleep();
stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">_2nd</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will get following test variables set:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
custom_watcher
</td>
<td class="hdlist2">
<p>first timestamp of time line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
custom_watcher_1st
</td>
<td class="hdlist2">
<p>time passed since start</p>
</td>
</tr>
<tr>
<td class="hdlist1">
custom_watcher_2nd
</td>
<td class="hdlist2">
<p>time passed since start</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course using the same suffix multiple times will overwrite the timestamps in test variables.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-create-variables">Create variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you know variables usually are defined at the beginning of the test case (<a href="#test-variables">test-variables</a>). It might also be helpful to reset existing variables as well as to define new variables during the test. The action &lt;create-variables&gt; is able to declare new variables or overwrite existing ones.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createVariablesTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Current variable value: ${myVariable}<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;create-variables&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">'this is a test'</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/create-variables&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Current variable value: ${myVariable} <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>
              New variable 'newVariable' has the value: ${newVariable}
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> createVariableTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current variable value: ${myVariable}</span><span class="delimiter">&quot;</span></span>);

    createVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${id}</span><span class="delimiter">&quot;</span></span>);
    createVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">newVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">this is a test</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current variable value: ${myVariable}</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">New variable 'newVariable' has the value: ${newVariable}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note the difference between the <strong>variable()</strong> method and the <strong>createVariable()</strong> method. The first initializes the test case with the test variables. So all variables defined with this method are valid from the very beginning of the test. In contrary to that the <strong>createVariable()</strong> is executed within the test action chain. The newly created variables are then valid for the rest of the test. Trailing actions can reference the variables as usual with the variable expression.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-trace-variables">Trace variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You already know the &lt;echo&gt; action that prints messages to the console or logger. The &lt;trace-variables&gt; action is specially designed to trace all currently valid test variables to the console. This was mainly used by us for debug reasons. The usage is quite simple:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">traceVariablesTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;trace-variables&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/trace-variables&gt;</span>

        <span class="tag">&lt;trace-variables</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> traceTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span>);

    traceVariables(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span>);
    traceVariables();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Simply add the &lt;trace-variables&gt; action to your action chain and all variables will be printed out to the console. You are able to define a special set of variables by using the &lt;variable&gt; child elements. See the output that was generated by the test example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Current value of variable myVariable = 12345
Current value of variable nextVariable = 54321</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-transform">Transform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong><em>`&lt;transform&gt;`</em></strong> action transforms XML fragments with XSLT in order to construct various XML representations. The transformation result is stored into a test variable for further usage. The property <strong>xml-data</strong> defines the XML source, that is going to be transformed, while <strong>xslt-data</strong> defines the XSLT transformation rules. The attribute <strong>variable</strong> specifies the target test variable which receives the transformation result. The tester might use the action to transform XML messages as shown in the next code example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transformTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;actions&gt;</span>
          <span class="tag">&lt;transform</span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;xml-data&gt;</span>
                  <span class="inline-delimiter">&lt;![CDATA[</span>
                      &lt;TestRequest&gt;
                          &lt;Message&gt;Hello World!&lt;/Message&gt;
                      &lt;/TestRequest&gt;
                  <span class="inline-delimiter">]]&gt;</span>
              <span class="tag">&lt;/xml-data&gt;</span>
              <span class="tag">&lt;xslt-data&gt;</span>
                  <span class="inline-delimiter">&lt;![CDATA[</span>
                      &lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;
                      &lt;xsl:template match=&quot;/&quot;&gt;
                          &lt;html&gt;
                              &lt;body&gt;
                                  &lt;h2&gt;Test Request&lt;/h2&gt;
                                  &lt;p&gt;Message: &lt;xsl:value-of select=&quot;TestRequest/Message&quot;/&gt;&lt;/p&gt;
                              &lt;/body&gt;
                          &lt;/html&gt;
                      &lt;/xsl:template&gt;
                      &lt;/xsl:stylesheet&gt;
                  <span class="inline-delimiter">]]&gt;</span>
              <span class="tag">&lt;/xslt-data&gt;</span>
          <span class="tag">&lt;/transform&gt;</span>
          <span class="tag">&lt;echo&gt;</span>
              <span class="tag">&lt;message&gt;</span>${result}<span class="tag">&lt;/message&gt;</span>
          <span class="tag">&lt;/echo&gt;</span>
      <span class="tag">&lt;/actions&gt;</span>
  <span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation above results to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;html&gt;</span>
      <span class="tag">&lt;body&gt;</span>
          <span class="tag">&lt;h2&gt;</span>Test Request<span class="tag">&lt;/h2&gt;</span>
          <span class="tag">&lt;p&gt;</span>Message: Hello World!<span class="tag">&lt;/p&gt;</span>
      <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example we used CDATA sections to define the transformation source as well as the XSL transformation rules. As usual you can also use external file resources here. The transform action with external file resources looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;transform</span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xml-resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:transform-source.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xslt-resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:transform.xslt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/transform&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL alternative for transforming data via XSTL in Citrus looks like follows:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> transformTest() {
    transform()
        .source(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestRequest&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Message&gt;Hello World!&lt;/Message&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestRequest&gt;</span><span class="delimiter">&quot;</span></span>)
        .xslt(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:stylesheet version=</span><span class="char">\&quot;</span><span class="content">1.0</span><span class="char">\&quot;</span><span class="content"> xmlns:xsl=</span><span class="char">\&quot;</span><span class="content">http://www.w3.org/1999/XSL/Transform</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:template match=</span><span class="char">\&quot;</span><span class="content">/</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h2&gt;Test Request&lt;/h2&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;Message: &lt;xsl:value-of select=</span><span class="char">\&quot;</span><span class="content">TestRequest/Message</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/p&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:template&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:stylesheet&gt;</span><span class="delimiter">&quot;</span></span>)
        .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);

    transform()
        .source(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform-source.xml</span><span class="delimiter">&quot;</span></span>))
        .xslt(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform.xslt</span><span class="delimiter">&quot;</span></span>))
        .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> transformTest() {
    transform(action -&gt;
        action.source(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestRequest&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Message&gt;Hello World!&lt;/Message&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestRequest&gt;</span><span class="delimiter">&quot;</span></span>)
        .xslt(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:stylesheet version=</span><span class="char">\&quot;</span><span class="content">1.0</span><span class="char">\&quot;</span><span class="content"> xmlns:xsl=</span><span class="char">\&quot;</span><span class="content">http://www.w3.org/1999/XSL/Transform</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:template match=</span><span class="char">\&quot;</span><span class="content">/</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h2&gt;Test Request&lt;/h2&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;Message: &lt;xsl:value-of select=</span><span class="char">\&quot;</span><span class="content">TestRequest/Message</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/p&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:template&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:stylesheet&gt;</span><span class="delimiter">&quot;</span></span>)
        .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>));

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);

    transform(action -&gt;
        action.source(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform-source.xml</span><span class="delimiter">&quot;</span></span>))
              .xslt(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform.xslt</span><span class="delimiter">&quot;</span></span>))
              .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>));

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defining multi-line Strings with nested quotes is no fun in Java. So you may want to use external file resources for your scripts as shown in the second part of the example. In fact you could also use script languages like Groovy or Scala that have much better support for multi-line Strings.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-groovy">Groovy script execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Groovy is an agile dynamic language for the Java Platform. Groovy ships with a lot of very powerful features and fits perfectly with Java as it is based on Java and runs inside the JVM.</p>
</div>
<div class="paragraph">
<p>The Citrus Groovy support might be the entrance for you to write customized test actions. You can easily execute Groovy code inside a test case, just like a normal test action. The whole test context with all variables is available to the Groovy action. This means someone can change variable values or create new variables very easily.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at some examples in order to understand the possible Groovy code interactions in Citrus:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/variables&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
        println 'Hello Citrus'
    <span class="tag">&lt;/groovy&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
        println 'The variable is: ${time}'
    <span class="tag">&lt;/groovy&gt;</span>
    <span class="tag">&lt;groovy</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/script/example.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> groovyTest() {
    groovy(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'Hello Citrus'</span><span class="delimiter">&quot;</span></span>);
    groovy(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'The variable is: ${time}'</span><span class="delimiter">&quot;</span></span>);

    groovy(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/script/example.groovy</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> groovyTest() {
    groovy(action -&gt; action.script(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'Hello Citrus'</span><span class="delimiter">&quot;</span></span>));
    groovy(action -&gt; action.script(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'The variable is: ${time}'</span><span class="delimiter">&quot;</span></span>));

    groovy(action -&gt; action.script(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/script/example.groovy</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see it is possible to write Groovy code directly into the test case. Citrus will interpret and execute the Groovy code at runtime. As usual nested variable expressions are replaced with respective values. In general this is done in advance before the Groovy code is interpreted. For more complex Groovy code sections which grow in lines of code you can also reference external file resources.</p>
</div>
<div class="paragraph">
<p>After this basic Groovy code usage inside a test case we might be interested accessing the whole TestContext. The TestContext Java object holds all test variables and function definitions for the test case and can be referenced in Groovy code via simple naming convention. Just access the object reference 'context' and you are able to manipulate the TestContext (e.g. setting a new variable which is directly ready for use in following test actions).</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
      context.setVariable(&quot;greetingText&quot;,&quot;Hello Citrus&quot;)
      println context.getVariable(&quot;greetingText&quot;)
    <span class="tag">&lt;/groovy&gt;</span>
    <span class="tag">&lt;echo&gt;</span>
      <span class="tag">&lt;message&gt;</span>New variable: ${greetingText}<span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/echo&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The implicit TestContext access that was shown in the previous sample works with a default Groovy script template provided by Citrus. The Groovy code you write in the test case is automatically surrounded with a Groovy script which takes care of handling the TestContext. The default template looks like follows:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus</span>.*
<span class="include">import</span> <span class="include">com.consol.citrus.variable</span>.*
<span class="include">import</span> <span class="include">com.consol.citrus.context.TestContext</span>
<span class="include">import</span> <span class="include">com.consol.citrus.script.GroovyAction.ScriptExecutor</span>

<span class="include">public</span> <span class="include">class</span> <span class="include">GScript</span> <span class="include">implements</span> <span class="include">ScriptExecutor</span> {
    <span class="include">public</span> <span class="include">void</span> <span class="include">execute</span>(<span class="include">TestContext</span> <span class="include">context</span>) {
        <span class="annotation">@SCRIPTBODY</span><span class="error">@</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your code is placed in substitution to the <strong><em>@SCRIPTBODY@</em></strong> placeholder. Now you might understand how Citrus handles the context automatically. You can also write your own script templates making more advanced usage of other Java APIs and Groovy code. Just add a script template path to the test action like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groovy</span> <span class="attribute-name">script-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:my-custom-template.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  [...]
<span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand you can disable the automatic script template wrapping in your action at all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groovy</span> <span class="attribute-name">use-script-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  println 'Just use some Groovy code'
<span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example deals with advanced Groovy code and writing whole classes. We write a new Groovy class which implements the ScriptExecutor interface offered by Citrus. This interface defines a special execute method and provides access to the whole TestContext for advanced test variables access.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/variables&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        import com.consol.citrus.*
        import com.consol.citrus.variable.*
        import com.consol.citrus.context.TestContext
        import com.consol.citrus.script.GroovyAction.ScriptExecutor

        public class GScript implements ScriptExecutor {
            public void execute(TestContext context) {
                println context.getVariable(&quot;time&quot;)
            }
        }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/groovy&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementing the ScriptExecutor interface in a custom Groovy class is applicable for very special test context manipulations as you are able to import and use other Java API classes in this code.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-fail">Failing the test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fail action will generate an exception in order to terminate the test case with error. The test case will therefore not be successful in the reports.</p>
</div>
<div class="paragraph">
<p>The user can specify a custom error message for the exception in order to describe the error cause. Here is a very simple example to clarify the syntax:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">failTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;fail</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Test will fail with custom message</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Test results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Execution of test: failTest failed! Nested exception is:
com.consol.citrus.exceptions.CitrusRuntimeException:
Test will fail with custom message

[...]

CITRUS TEST RESULTS

failTest          : failed - Exception is: Test will fail with custom message

Found 1 test cases to execute
Skipped 0 test cases (0.0%)
Executed 1 test cases, containing 3 actions
Tests failed:        1 (100.0%)
Tests successfully:  0 (0.0%)</code></pre>
</div>
</div>
<div class="paragraph">
<p>While using the Java DSL tester might want to raise some Java exceptions in the middle of configuring the test case. But this is not possible as we have to separate the design time and the execution time of the test case. The <strong>@CitrusTest</strong> annotated configuration method is called for building up the whole test case. After this method was processed the test gets executed in runtime oth the test. If you specify a throws exception statement in the configuration method this will not be done at runtime but at design time. This is why you have to use the special fail test action which raises a Java exception during the runtime of the test. The next example will not work as expected:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> wrongUsageSample() {
    <span class="comment">// some test actions</span>

    <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">&quot;</span><span class="content">This test should fail now</span><span class="delimiter">&quot;</span></span>); <span class="comment">// does not work as expected</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation exception above is directly raised before the test is able to start as the <strong>@CitrusTest</strong> annotated method does not represent the test runtime. Instead of this we have to use the fail action as follows:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> failTest() {
    <span class="comment">// some test actions</span>

    fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">This test should fail now</span><span class="delimiter">&quot;</span></span>); <span class="comment">// fails at test runtime as expected</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the test fails at runtime as the fail action is raised during the test execution as expected.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-input">Input</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the test case execution it is possible to read some user input from the command line. The test execution will stop and wait for keyboard inputs over the standard input stream. The user has to type the input and end it with the return key.</p>
</div>
<div class="paragraph">
<p>The user input is stored to the respective variable value.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;input</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Now press enter:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput1}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">valid-answers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y/n</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput2}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">valid-answers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yes/no</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput3}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput4}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the input action is customizable with a prompt message that is displayed to the user and some valid answer possibilities. The user input is stored to a test variable for further use in the test case. In detail the input action offers following attributes:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>message displayed to the user</p>
</td>
</tr>
<tr>
<td class="hdlist1">
valid-answers
</td>
<td class="hdlist2">
<p>possible valid answers separated with '/' character</p>
</td>
</tr>
<tr>
<td class="hdlist1">
variable
</td>
<td class="hdlist2">
<p>result variable name holding the user input (default = ${userinput})</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same action in Java DSL now looks quite familiar to us although attribute naming is slightly different:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> inputActionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);

    input();
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput}</span><span class="delimiter">&quot;</span></span>);
    input().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now press enter:</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput1}</span><span class="delimiter">&quot;</span></span>);
    input().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput2}</span><span class="delimiter">&quot;</span></span>);
    input().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">no</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput3}</span><span class="delimiter">&quot;</span></span>);
    input().result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput4}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> inputActionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);

    input(action -&gt; {});
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now press enter:</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput1}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput2}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">no</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput3}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput4}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user input is restricted to a set of valid answers the input validation of course can fail due to mismatch. This is the case when the user provides some input not matching the valid answers given. In this case the user is again asked to provide valid input. The test action will continue to ask for valid input until a valid answer is given.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
User inputs may not fit to automatic testing in terms of continuous integration testing where no user is present to type in the correct answer over the keyboard. In this case you can always skip the user input in advance by specifying a variable that matches the user input variable name. As the user input variable is then already present the user input is missed out and the test proceeds automatically.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-load">Load</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You are able to load properties from external property files and store them as test variables. The action will require a file resource either from class path or file system in order to read the property values.</p>
</div>
<div class="paragraph">
<p>Let us look at an example to get an idea about this action:</p>
</div>
<div class="listingblock">
<div class="title">Content of load.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">username=Mickey Mouse
greeting.text=Hello Test Framework</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadPropertiesTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;load&gt;</span>
            <span class="tag">&lt;properties</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/resources/load.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/load&gt;</span>

        <span class="tag">&lt;trace-variables</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> loadPropertiesTest() {
    load(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/resources/load.properties</span><span class="delimiter">&quot;</span></span>);

    traceVariables();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Current value of variable username = Mickey Mouse
Current value of variable greeting.text = Hello Test Framework</code></pre>
</div>
</div>
<div class="paragraph">
<p>The action will load all available properties in the file load.properties and store them to the test case as local variables.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please be aware of the fact that existing variables are overwritten!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-wait">Wait</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With this action you can make your test wait until a certain condition is satisfied. The attribute <strong>seconds</strong> defines the amount of time to wait in seconds. You can also use the milliseconds attribute for a more fine grained time value. The attribute <strong>interval</strong> defines the amount of time to wait <strong>between</strong> each check. The interval is always specified as millisecond time interval.</p>
</div>
<div class="paragraph">
<p>If the check does not exceed within the defined overall waiting time then the test execution fails with an appropriate error message. There are different types of conditions to check.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
http
</td>
<td class="hdlist2">
<p>This condition is based on a Http request call on a server endpoint. Citrus will wait until the Http response is as defined (e.g. Http 200 OK). This is useful when you want to wait for a server to start.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
file
</td>
<td class="hdlist2">
<p>This condition checks for the existence of a file on the local file system. Citrus will wait until the file is present.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>This condition checks for the existence of a message in the local message store of the current test case. Citrus will wait until the message with the given name is present.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next let us have a look at a simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">waitTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;wait</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
          <span class="tag">&lt;http</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://sample.org/resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statusCode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;wait</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> waitTest() {
    waitFor().http(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://sample.org/resource</span><span class="delimiter">&quot;</span></span>).seconds(<span class="integer">10L</span>).interval(<span class="integer">2000L</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example waits for some Http server resource to be available with <strong>Http 200 OK</strong> response. Citrus will use <strong>HEAD</strong> request method by default. You can set the request method with the <strong>method</strong> attribute on the Http condition.</p>
</div>
<div class="paragraph">
<p>Next let us have a look at the file condition usage:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">waitTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;wait</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
          <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/resource/file.txt</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;wait</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> waitTest() {
    waitFor().file(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/resource/file.txt</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus checks for the file to exist under the given path. Only if the file exists the test will continue with further test actions.</p>
</div>
<div class="paragraph">
<p>Next let us have a look at the message condition usage:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">waitTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;wait</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
          <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;wait</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> waitTest() {
    waitFor().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus checks for the message with the name <strong>helloRequest</strong> in the local message store. Only if the message with the given name is found the test will continue with further test actions. The local message
store is automatically filled with all exchanged messages (send or receive) in a test case. The message names are defined in the respective send or receive operations in the test.</p>
</div>
<div class="paragraph">
<p>When should somebody use this action? This action is very useful when you want your test to wait for a certain event to occur before continuing with the test execution. For example if you wish that your test waits until a Docker container is started or for an application to create a log file before continuing, then use this action. You can also create your own condition statements and bind it to the test action.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-purging-jms-destinations">Purging JMS destinations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Purging JMS destinations during the test run is quite essential. Different test cases can influence each other when sending messages to the same JMS destinations. A test case should only receive those messages that actually belong to it. Therefore it is a good idea to purge all JMS queue destinations between the test cases. Obsolete messages that are stuck in a JMS queue for some reason are then removed so that the following test case is not offended.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Citrus provides special support for JMS related features. We have to activate those JMS features in our test case by adding a special "jms" namespace and schema definition location to the test case XML.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jms/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/jms/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/jms/testcase/citrus-jms-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to use the JMS features in our test case in order to purge some JMS queues. This can be done with following action definition:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>

      <span class="tag">&lt;jms:purge-jms-queues</span> <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we have referenced the <strong>jms</strong> namespace when using the <strong>purge-jms-queues</strong> test action.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> ConnectionFactory connectionFactory;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues()
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>);

    purgeQueues(connectionFactory)
        .timeout(<span class="integer">150L</span>) <span class="comment">// custom timeout in ms</span>
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> ConnectionFactory connectionFactory;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues(action -&gt;
        action.queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
            .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>));

    purgeQueues(action -&gt; action.connectionFactory(connectionFactory)
            .timeout(<span class="integer">150L</span>) <span class="comment">// custom timeout in ms</span>
            .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
            .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Purging the JMS queues in every test case is quite exhausting because every test case needs to define a purging action at the very beginning of the test. Fortunately the test suite definition offers tasks to run before, between and after the test cases which should ease up this tasks a lot. The test suite offers a very simple way to purge the destinations between the tests. See <a href="#before-suite">testsuite-before-test</a>for more information about this.</p>
</div>
<div class="paragraph">
<p>As you can see in the next example it is quite easy to specify a group of destinations in the Spring configuration that get purged before a test is executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please keep in mind that the JMS related configuration components in Citrus belong to a separate XML namespace <strong>jms:</strong> . We have to add this namespace declaration to each test case XML and Spring bean XML configuration file as described at the very beginning of this section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The syntax for purging the destinations is the same as we used it inside the test case. So now we are able to purge JMS destinations with given destination names. But sometimes we do not want to rely on queue or topic names as we retrieve destinations over JNDI for instance. We can deal with destinations coming from JNDI lookup like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We just use the attribute <strong>'ref'</strong> instead of <strong>'name'</strong> and Citrus is looking for a bean reference for that identifier that resolves to a JMS destination. You can use the JNDI bean references inside a test case, too.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can use queue object references also in Java DSL test cases. Here we easily can use Spring&#8217;s dependency injection with autowiring to get the object references from the IoC container.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloRequestIn;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloResponseOut;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues()
        .queue(jmsQueueHelloRequestIn)
        .queue(jmsQueueHelloResponseOut);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloRequestIn;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloResponseOut;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues(action -&gt;
        action.queue(jmsQueueHelloRequestIn)
            .queue(jmsQueueHelloResponseOut));
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can mix queue name and queue object references as you like within one single purge queue test action.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-purging-message-channels">Purging message channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Message channels define central messaging destinations in Citrus. These are namely in memory message queues holding messages for test cases. These messages may become obsolete during a test run, especially when test cases fail and stop in their message consumption. Purging these message channel destinations is essential in these scenarios in order to not influence upcoming test cases. Each test case should only receive those messages that actually refer to the test model. Therefore it is a good idea to purge all message channel destinations between the test cases. Obsolete messages that get stuck in a message channel destination for some reason are then removed so that upcoming test case are not broken.</p>
</div>
<div class="paragraph">
<p>Following action definition purges all messages from a list of message channels:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeChannelTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;purge-channel&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-channel&gt;</span>

      <span class="tag">&lt;purge-channel&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-channel&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the test action supports channel names as well as channel references to Spring bean instances. When using channel references you refer to the Spring bean id or name in your application context.</p>
</div>
<div class="paragraph">
<p>The Java DSL works quite similar as you can read from next examples:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channelResolver</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> DestinationResolver&lt;MessageChannel&gt; channelResolver;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels()
        .channelResolver(channelResolver)
        .channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
        .channel(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch4</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channelResolver</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> DestinationResolver&lt;MessageChannel&gt; channelResolver;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels(action -&gt;
        action.channelResolver(channelResolver)
                .channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
                .channel(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch4</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel resolver reference is optional. By default Citrus will automatically use a Spring application context channel resolver so you just have to use the respective Spring bean names that are configured in the Spring application context. However setting a custom channel resolver may be adequate for you in some special cases.</p>
</div>
<div class="paragraph">
<p>While speaking of Spring application context bean references the next example uses such bean references for channels to purge.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels()
        .channels(channel1, channel2)
        .channel(channel3);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels(action -&gt;
        action.channels(channel1, channel2)
                .channel(channel3));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Message selectors enable you to selectively remove messages from the destination. All messages that pass the message selection logic get deleted the other messages will remain unchanged inside the channel destination. The message selector is a Spring bean that implements a special message selector interface. A possible implementation could be a selector deleting all messages that are older than five seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.messaging.Message</span>;
<span class="keyword">import</span> <span class="include">org.springframework.integration.core.MessageSelector</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TimeBasedMessageSelector</span> <span class="directive">implements</span> MessageSelector {

    <span class="directive">public</span> <span class="type">boolean</span> accept(Message&lt;?&gt; message) {
        <span class="keyword">if</span> (<span class="predefined-type">System</span>.currentTimeMillis() - message.getHeaders().getTimestamp() &gt; <span class="integer">5000</span>) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The message selector returns <strong>false</strong> for those messages that should be deleted from the channel!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You simply define the message selector as a new Spring bean in the Citrus application context and reference it in your test action property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.special.TimeBasedMessageSelector</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let us have a look at how you reference the selector in your test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;purge-channels</span> <span class="attribute-name">message-selector</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/purge-channels&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageSelector specialMessageSelector;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels()
        .channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
        .selector(specialMessageSelector);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageSelector specialMessageSelector;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels(action -&gt;
        action.channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
                .selector(specialMessageSelector));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the examples above we use a message selector implementation that gets injected via Spring IoC container.</p>
</div>
<div class="paragraph">
<p>Purging channels in each test case every time is quite exhausting because every test case needs to define a purging action at the very beginning of the test. A more straight forward approach would be to introduce some purging action which is automatically executed before each test. Fortunately the Citrus test suite offers a very simple way to do this. It is described in <a href="#before-suite">testsuite-before-test</a>.</p>
</div>
<div class="paragraph">
<p>When using the special action sequence before test cases we are able to purge channel destinations every time a test case executes. See the upcoming example to find out how the action is defined in the Spring configuration application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;purge-channel&gt;</span>
            <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/purge-channel&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just use this before-test bean in the Spring bean application context and the purge channel action is active. Obsolete messages that are waiting on the message channels for consumption are purged before the next test in line is executed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Purging message channels becomes also very interesting when working with server instances in Citrus. Each server component automatically has an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message channel. The message channel follows a naming convention <strong>{serverName}.inbound</strong> where <strong>{serverName}</strong> is the Spring bean name of the Citrus server endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-purging-endpoints">Purging endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus works with message endpoints when sending and receiving messages. In general endpoints can also queue messages. This is especially the case when using JMS message endpoints or any server endpoint component in Citrus. These are in memory message queues holding messages for test cases. These messages may become obsolete during a test run, especially when a test case that would consume the messages fails. Deleting all messages from a message endpoint is therefore a useful task and is essential in such scenarios so that upcoming test cases are not influenced. Each test case should only receive those messages that actually refer to the test model. Therefore it is a good idea to purge all message endpoint destinations between the test cases. Obsolete messages that get stuck in a message endpoint destination for some reason are then removed so that upcoming test case are not broken.</p>
</div>
<div class="paragraph">
<p>Following action definition purges all messages from a list of message endpoints:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeEndpointTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;purge-endpoint&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-endpoint&gt;</span>

      <span class="tag">&lt;purge-endpoint&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-endpoint&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the test action supports endpoint names as well as endpoint references to Spring bean instances. When using endpoint references you refer to the Spring bean name in your application context.</p>
</div>
<div class="paragraph">
<p>The Java DSL works quite similar - have a look:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints()
        .endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
        .endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint4</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints(action -&gt;
        action.endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
                .endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint4</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the Java DSL we can inject endpoint objects with Spring bean container IoC. The next example uses such bean references for endpoints in a purge action.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints()
        .endpoints(endpoint1, endpoint2)
        .endpoint(endpoint3);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints(action -&gt;
        action.endpoints(endpoint1, endpoint2)
                .endpoint(endpoint3));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Message selectors enable you to selectively remove messages from an endpoint. All messages that meet the message selector condition get deleted and the other messages remain inside the endpoint destination. The message selector is either a normal String name-value representation or a map of key value pairs:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;purge-endpoints&gt;</span>
  <span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;value&gt;</span>operation = 'sayHello'<span class="tag">&lt;/value&gt;</span>
  <span class="tag">&lt;/selector&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/purge-endpoints&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints()
        .endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
        .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">operation = 'sayHello'</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints(action -&gt;
        action.endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
                .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">operation = 'sayHello'</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the examples above we use a String to represent the message selector expression. In general the message selector operates on the message header. So following on from that we remove all messages selectively that have a message header <strong>operation</strong> with its value <strong>sayHello</strong> .</p>
</div>
<div class="paragraph">
<p>Purging endpoints in each test case every time is quite exhausting because every test case needs to define a purging action at the very beginning of the test. A more straight forward approach would be to introduce some purging action which is automatically executed before each test. Fortunately the Citrus test suite offers a very simple way to do this. It is described in <a href="#before-suite">testsuite-before-test</a>.</p>
</div>
<div class="paragraph">
<p>When using the special action sequence before test cases we are able to purge endpoint destinations every time a test case executes. See the upcoming example to find out how the action is defined in the Spring configuration application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;purge-endpoint&gt;</span>
            <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/purge-endpoint&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just use this before-test bean in the Spring bean application context and the purge endpoint action is active. Obsolete messages that are waiting on the message endpoints for consumption are purged before the next test in line is executed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Purging message endpoints becomes also very interesting when working with server instances in Citrus. Each server component automatically has an inbound message endpoint where incoming messages are stored to internally. Citrus will automatically use this incoming message endpoint as target for the purge action so you can just use the server instance as you know it from your configuration in any purge action.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-assert-failure">Assert failure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus test actions fail with Java exceptions and error messages. This gives you the opportunity to expect an action to fail during test execution. You can simple assert a Java exception to be thrown during execution. See the example for an assert action definition in a test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assertFailureTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;assert</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.exceptions.CitrusRuntimeException</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Unknown variable ${date}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;when&gt;</span>
                <span class="tag">&lt;echo&gt;</span>
                    <span class="tag">&lt;message&gt;</span>Current date is: ${date}<span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;/echo&gt;</span>
            <span class="tag">&lt;/when&gt;</span>
        <span class="tag">&lt;/assert&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> assertTest() {
    assertException().exception(com.consol.citrus.exceptions.CitrusRuntimeException.class)
                     .message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unknown variable ${date}</span><span class="delimiter">&quot;</span></span>)
                .when(echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current date is: ${date}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the assert action requires an exception. In case no exception is thrown by the embedded test action the assertion and the test case will fail!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The assert action always wraps a single test action, which is then monitored for failure. In case the nested test action fails with error you can validate the error in its type and error message (optional). The failure has to fit the expected one exactly otherwise the assertion fails itself.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Important to notice is the fact that asserted exceptions do not cause failure of the test case. As you except the failure to happen the test continues with its work once the assertion is done successfully.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-catch-exceptions">Catch exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous chapter we have seen how to expect failures in Citrus with assert action. Now the assert action is designed for single actions to be monitored and for failures to be expected in any case. The <strong>'catch'</strong> action in contrary can hold several nested test actions and exception failure is optional.</p>
</div>
<div class="paragraph">
<p>The nested actions are error proof for the chosen exception type. This means possible exceptions are caught and ignored - the test case will not fail for this exception type. But only for this particular exception type! Other exception types that occur during execution do cause the test to fail as usual.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">catchExceptionTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;catch</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.exceptions.CitrusRuntimeException</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>Current date is: ${date}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/catch&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> catchTest() {
    catchException().exception(CitrusRuntimeException.class)
                    .when(echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current date is: ${date}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that there is no validation available in a catch block. So catching exceptions is just to make a test more stable towards errors that can occur. The caught exception does not cause any failure in the test. The test case may continue with execution as if there was not failure. Also notice that the catch action is also happy when no exception at all is raised. In contrary to that the assert action requires the exception and an assert action is failing in positive processing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Catching exceptions like this may only fit to very error prone action blocks where failures do not harm the test case success. Otherwise a failure in a test action should always reflect to the whole test case to fail with errors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java developers might ask why not use try-catch Java block instead? The answer is simple yet very important to understand. The test method is called by the Java DSL test case builder for building the Citrus test. This can be referred to as the design time of the test. After the building test method was processed the test gets executed, which can be called the runtime of the test. This means that a try-catch block within the design time method will never perform during the test run. The only reliable way to add the catch capability to the test as part of the test case runtime is to use the Citrus test action which gets executed during test runtime.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-ant-build">Apache Ant build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The &lt;ant&gt; action loads a build.xml Ant file and executes one or more targets in the Ant project. The target is executed with optional build properties passed to the Ant run. The Ant build output is logged with Citrus logger and the test case success is bound to the Ant build success. This means in case the Ant build fails for some reason the test case will also fail with build exception accordingly.</p>
</div>
<div class="paragraph">
<p>See this basic Ant run example to see how it works within your test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AntRunTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">build-file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;execute</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/ant&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
        .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>)
        .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">$Hello!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(action -&gt; action.buildFilePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
                .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>)
                .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">$Hello!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The respective build.xml Ant file must provide the target to call. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-build</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome to Citrus!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>

    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${welcomeText} - Today is ${date}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>

    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayGoodbye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Goodbye everybody!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you can pass custom build properties to the Ant build execution. Existing Ant build properties are replaced and you can use the properties in your build file as usual.</p>
</div>
<div class="paragraph">
<p>You can also call multiple targets within one single build run by using a comma separated list of target names:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AntRunTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">build-file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;execute</span> <span class="attribute-name">targets</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello,sayGoodbye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/ant&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
        .targets(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayGoodbye</span><span class="delimiter">&quot;</span></span>)
        .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(action -&gt; action.buildFilePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
                .targets(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayGoodbye</span><span class="delimiter">&quot;</span></span>)
                .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build properties can live in external file resource as an alternative to the inline property definitions. You just have to use the respective file resource path and all nested properties get loaded as build properties.</p>
</div>
<div class="paragraph">
<p>In addition to that you can also define a custom build listener. The build listener must implement the Ant API interface <strong>org.apache.tools.ant.BuildListener</strong> . During the Ant build run the build listener is called with several callback methods (e.g. buildStarted(), buildFinished(), targetStarted(), targetFinished(), …). This is how you can add additional logic to the Ant build run from Citrus. A custom build listener could manage the fail state of your test case, in particular by raising some exception forcing the test case to fail accordingly.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AntRunTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">build-file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">build-listener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customBuildListener</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;execute</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;properties</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ant&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> BuildListener customBuildListener;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    antrun(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
        .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .propertyFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.properties</span><span class="delimiter">&quot;</span></span>)
        .listener(customBuildListener);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> BuildListener customBuildListener;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    antrun(action -&gt; action.buildFilePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
            .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
            .propertyFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.properties</span><span class="delimiter">&quot;</span></span>)
            .listener(customBuildListener));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>customBuildListener</strong> used in the example above should reference a Spring bean in the Citrus application context. The bean implements the interface <strong>org.apache.tools.ant.BuildListener</strong> and controls the Ant build run.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-start-stop">Start/Stop server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus is working with server components that are started and stopped within a test run. This can be a Http server or some SMTP mail server for instance. Usually the Citrus server components are automatically started when Citrus is starting and respectively stopped when Citrus is shutting down. Sometimes it might be helpful to explicitly start and stop a server instance within your test case. Here you can use special start and stop test actions inside your test. This is a good way to test downtime scenarios of interface partners with respective error handling when connections to servers are lost</p>
</div>
<div class="paragraph">
<p>Let me explain with a simple sample test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sleepTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;start</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>

        <span class="tag">&lt;stop</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The start and stop server test action receive a server name which references a Spring bean component of type <strong>com.consol.citrus.server.Server</strong> in your basic Spring application context. The server instance is started or stopped within the test case. As you can see in the next listing we can also start and stop multiple server instances within a single test action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sleepTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;start&gt;</span>
            <span class="tag">&lt;servers&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFtpServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/servers&gt;</span>
        <span class="tag">&lt;/start&gt;</span>

        <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>

        <span class="tag">&lt;stop&gt;</span>
            <span class="tag">&lt;servers&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFtpServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/servers&gt;</span>
        <span class="tag">&lt;/stop&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the Java DSL the best way to reference a server instance is to autowire the Spring bean via dependency injection. The Spring framework takes case on injecting the proper Spring bean component defined in the Spring application context. This way you can easily start and stop server instances within Java DSL test cases.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myFtpServer</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> FtpServer myFtpServer;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> startStopServerTest() {
    start(myFtpServer);

    sleep();

    stop(myFtpServer);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting and stopping server instances is a synchronous test action. This means that your test case is waiting for the server to start before other test actions take place. Startup times and shut down of server instances may delay your test accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see starting and stopping Citrus server instances is very easy. You can also write your own server implementations by implementing the interface <strong>com.consol.citrus.server.Server</strong> . All custom server implementations can then be started and stopped during a test case.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-stop-timer">Stop Timer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The &lt;stop-timer&gt; action can be used for stopping either a specific timer (<a href="#containers-timer">containers-timer</a>) or all timers running within a test. This action is useful when timers are started in the background (using parallel or fork=true) and you wish to stop these timers at the end of the test. Some examples of using this action are provided below:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;timer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/timer&gt;</span>

      <span class="tag">&lt;timer</span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/timer&gt;</span>

      <span class="tag">&lt;timer</span> <span class="attribute-name">repeatCount</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/timer&gt;</span>

      <span class="tag">&lt;stop-timer</span> <span class="attribute-name">timerId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;finally&gt;</span>
      <span class="tag">&lt;stop-timer</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/finally&gt;</span>
  <span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
  <span class="directive">public</span> <span class="type">void</span> timerTest() {

    timer()
      .timerId(<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span>)
      .fork(<span class="predefined-constant">true</span>)
      .actions(sleep(<span class="integer">50L</span>)
    );

    timer()
      .fork(<span class="predefined-constant">true</span>)
      .actions(sleep(<span class="integer">50L</span>)
    );

    timer()
      .repeatCount(<span class="integer">5</span>)
      .actions(sleep(<span class="integer">50L</span>));

    stopTimer(<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span>)

    doFinally().actions(
      stopTimer()
    );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example 3 timers are started, the first 2 in the background and the third in the test execution thread. Timer #3 has a repeatCount set to 5 so it will terminate automatically after 5 runs. Timer #1 and #2 however have no repeatCount set so they will execute until they are told to stop.</p>
</div>
<div class="paragraph">
<p>Timer #1 is stopped explicitly using the first stopTimer action. Here the stopTimer action includes the name of the timer to stop. This is convenient when you wish to terminate a specific timer. However since no timerId was set for timer #2, you can terminate this (and all other timers) using the 'stopTimer' action with no explicit timerId set.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions-custom">Custom test actions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we have a look at the opportunity to add custom test actions to the test case flow. Let us start this section with an example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ActionReferenceTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">reference</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanUpDatabase</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">reference</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialAction</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic &lt;action&gt; element references Spring beans that implement the Java interface <strong><em>com.consol.citrus.TestAction</em></strong> . This is a very fast way to add your own action implementations to a Citrus test case. This way you can easily implement your own actions in Java and include them into the test case.</p>
</div>
<div class="paragraph">
<p>In the example above the called actions are special database cleanup implementations. The actions are defined as Spring beans in the Citrus configuration and get referenced by their bean name or id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanUpDatabase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.domain.citrus.actions.SpecialDatabaseCleanupAction</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring application context holds your custom bean implementations. You can set properties and use the full Spring power while implementing your custom test action in Java. Let us have a look on how such a Java class may look like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.actions.AbstractTestAction</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.context.TestContext</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SpecialDatabaseCleanupAction</span> <span class="directive">extends</span> AbstractTestAction {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doExecute(TestContext context) {
        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);

        jdbcTemplate.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All you need to do in your Java class is to implement the Citrus <strong><em>com.consol.citrus.TestAction</em></strong> interface. The abstract class <strong><em>com.consol.citrus.actions.AbstractTestAction</em></strong> may help you to start with your custom test action implementation as it provides basic method implementations so you just have to implement the <strong><em>doExecute()</em></strong> method.</p>
</div>
<div class="paragraph">
<p>When using the Java test case DSL you are also quite comfortable with including your custom test actions.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> SpecialDatabaseCleanupAction cleanUpDatabaseAction;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> genericActionTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now let's include our special test action</span><span class="delimiter">&quot;</span></span>);

    action(cleanUpDatabaseAction);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">That's it!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using anonymous class implementations is also possible.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> genericActionTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now let's call our special test action anonymously</span><span class="delimiter">&quot;</span></span>);

    action(<span class="keyword">new</span> AbstractTestAction() {
        <span class="directive">public</span> <span class="type">void</span> doExecute(TestContext context) {
            <span class="comment">// do something</span>
        }
    });

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">That's it!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-05 15:28:59 MESZ
</div>
</div>
</body>
</html>